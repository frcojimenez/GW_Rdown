(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[    481835,      11286]
NotebookOptionsPosition[    472487,      11129]
NotebookOutlinePosition[    472915,      11146]
CellTagsIndexPosition[    472872,      11143]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["RDown Package", "Title",
 CellChangeTimes->{{3.747969475841448*^9, 3.747969478495125*^9}, 
   3.7479695552006407`*^9, {3.7999761494035053`*^9, 
   3.7999761534214697`*^9}},ExpressionUUID->"412e446d-949d-4a39-ab8f-\
2e74aab963be"],

Cell["XJ 2020", "Subtitle",
 CellChangeTimes->{{3.523020346046398*^9, 3.523020387550603*^9}, {
  3.7479695097873077`*^9, 3.747969513767797*^9}, {3.799118844355177*^9, 
  3.799118844758204*^9}},
 FontSize->18,ExpressionUUID->"03c7a68d-9296-477d-858e-f28f41a96ef7"],

Cell["\<\
Provide functions to compute Ringdown related quantities in GR:\
\>", "Subsubtitle",
 CellChangeTimes->{{3.5230204030134068`*^9, 3.523020425030308*^9}, {
  3.5230265395509644`*^9, 3.523026547108094*^9}, {3.747969524970929*^9, 
  3.747969552823316*^9}, {3.799118855009379*^9, 
  3.799118862349341*^9}},ExpressionUUID->"1dd49449-a8ac-466f-9155-\
195dee63ff9f"],

Cell[CellGroupData[{

Cell["Compute frequencies and damping times.. ", "Item",
 CellChangeTimes->{{3.522998382463629*^9, 3.5229984147045593`*^9}, {
  3.523020439792676*^9, 3.523020517729113*^9}, {3.747969559579624*^9, 
  3.7479695758881598`*^9}, {3.747969685164095*^9, 3.7479697066498737`*^9}, {
  3.799118866559821*^9, 
  3.799118871846408*^9}},ExpressionUUID->"5790c103-deb7-4616-bb6c-\
3201fb52dcfe"],

Cell["Compute RDown models.", "Item",
 CellChangeTimes->{{3.522998382463629*^9, 3.5229984147045593`*^9}, 
   3.523020439792676*^9, {3.523020524113278*^9, 3.523020543890162*^9}, {
   3.747969712073694*^9, 3.7479697210241117`*^9}, {3.799118874899969*^9, 
   3.799118881800928*^9}},ExpressionUUID->"44de3030-71f6-405b-999e-\
75aa76f5f611"]
}, Open  ]],

Cell["still incomplete", "Text",
 CellChangeTimes->{{3.5230265802866173`*^9, 3.5230265869424953`*^9}},
 FontWeight->"Bold",ExpressionUUID->"9611da95-c63f-4174-ad5e-d05a8caf1d44"],

Cell["TODO: Improve and improve", "Text",
 CellChangeTimes->{{3.525272085056192*^9, 3.52527217803032*^9}, {
  3.747969747116612*^9, 
  3.7479697512991533`*^9}},ExpressionUUID->"d61a9f74-a8b4-4661-9a96-\
0aec3ba57e56"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"NotebookDirectory", "[", "]"}]], "Input",
 CellChangeTimes->{{3.827472130809943*^9, 3.827472137790476*^9}},
 CellLabel->
  "In[1233]:=",ExpressionUUID->"a1f69d5a-b9e3-4ac3-bb4b-3dd65921ebf2"],

Cell[BoxData["\<\"/Users/xisco/git/ah-overtones-project/codes/RDownCode/\"\>"]\
, "Output",
 CellChangeTimes->{3.827472139484585*^9},
 CellLabel->
  "Out[1233]=",ExpressionUUID->"e52ecc04-dd93-44fa-bf04-eba729865c06"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Begin Package", "Section",
 CellChangeTimes->{{3.526304277369893*^9, 
  3.526304293712488*^9}},ExpressionUUID->"d1f4fc7b-0fc3-4dfa-87e1-\
5cab3334f1ef"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Probably", " ", "not", " ", "all", " ", "the", " ", "extra", " ", 
    "packages", " ", "are", " ", "really", " ", "needed"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{"BeginPackage", "[", "\"\<RDown`\>\"", "]"}], ";"}]}]], "Code",
 CellChangeTimes->{{3.526314579837529*^9, 3.526314746283765*^9}, {
   3.526314906743479*^9, 3.526314927567987*^9}, {3.5265719878947163`*^9, 
   3.526571995104267*^9}, {3.7479693011702957`*^9, 3.7479693395418663`*^9}, {
   3.751977582079381*^9, 3.7519775867970133`*^9}, {3.795343151330058*^9, 
   3.795343151662513*^9}, {3.799118908111803*^9, 3.799118912156425*^9}, {
   3.799119869643715*^9, 3.799119869915152*^9}, 3.799978302275337*^9, {
   3.807269163571548*^9, 3.807269164088099*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"73646baf-e1d8-48be-b891-b1d31c1d0092"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Print", "[", 
    RowBox[{"\"\<Starting Python session.\>\"", " ", ",", 
     RowBox[{"session", " ", "=", " ", 
      RowBox[{"StartExternalSession", "[", "\"\<Python\>\"", "]"}]}]}], "]"}],
    ";", "\n", 
   RowBox[{"ExternalEvaluate", "[", 
    RowBox[{"session", ",", " ", "\"\<import qnm; import numpy as np\>\""}], 
    "]"}], ";"}], "*)"}]], "Code",
 CellChangeTimes->{{3.805808013504369*^9, 3.805808016899122*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"828ec0b2-1cf2-4758-bcca-85b82aa6f9c9"]
}, Closed]],

Cell[CellGroupData[{

Cell["Definitions", "Section",
 CellChangeTimes->{{3.797832428103478*^9, 
  3.797832433936167*^9}},ExpressionUUID->"62bc7e4c-e5f8-44b8-8aaf-\
b650c91c7ebe"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"EasyMatchT", "::", "usage"}], "=", 
   "\"\<EasyMatchT[h1_,h2_,tMin_,tMax_]. Time domain version of the match as \
in eq. (2) of 1903.08284. tMin and tMax are the time interval where to \
compute the match.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PlanckTaper", "::", "usage"}], "=", 
   "\"\<PlanckTaper[t,t1,t2] is the one-sided version of the tapering \
function described in CQG27:084020, arXiv:1003.2939 [gr-qc].\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TimeOfMaximum", "::", "usage"}], "=", 
   "\"\<TimeOfMaximum[list_?ListQ] determines the time at which a time series \
reaches the absolute maximum of the modulus.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GetAsymptoticMultiMode", "::", "usage"}], "=", 
   "\"\<GetAsymptoticMode[h5file_,order_,modes_list,OptionsPattern[{\\\"\
Verbose\\\"\[Rule]False}]].\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"EradUIB2017", "::", "usage"}], "=", 
   "\"\<EradUIB2017[\[Eta]_,\[Chi]1_,\[Chi]2_] is fit for the energy radiated \
of the coalescence of 2 non-precessing quasicurcular BHs as in \
PRD:DY11536\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FinalSpinUIB2017", "::", "usage"}], "=", 
   "\"\<FinalSpinUIB2017[\[Eta]_,\[Chi]1_,\[Chi]2_] is fit for the final spin \
of the coalescence of 2 non-precessing quasicurcular BHs as in \
PRD:DY11536\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"IsFPNumberQ", "::", "usage"}], "=", 
   "\"\<IsFPNumberQ[str_String] checks whether a string represents a real \
Number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ReadFloatingPointNumbers", "::", "usage"}], "=", 
   "\"\<ReadFloatingPointNumbers[line_String, matchAnyFP_:True] converts \
string that contains a Fortran or C-style floating point number to a \
Mathematica Number.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"StringToNumber", "::", "usage"}], "=", 
   "\"\<StringToNumber[x_] converts a String x to a number, allowing more \
general number formats than ToExpression.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SXSMetaFilesToRules", "::", "usage"}], "=", 
   "\"\<SXSMetaFilesToRules[filename_String] converts a SXS metadata.txt file \
to a list of rules.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SXSParClassification", "::", "usage"}], "=", 
   "\"\<SXSParClassification[sxsdir_,ClassStr_]. Given a list of SXS NR. data \
folders 'sxsdir', it returns all the cases that match a certain criterion \
'ClassStr' (MassRatio range, Precessing or not, Initial Distance, Orbits \
Number)taking as reference the SXS metadata.txt files. If it is used \
iteratively, one could do different classifications \>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"SphericalHarmonic", "::", "usage"}], "=", 
   "\"\<SphericalHarmonic[s_,l_,m_]\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TakeColumn", "::", "usage"}], "=", 
   "\"\<TakeColumn[list1_?ListQ,columns]. Given a list, take the columns \
specified by 'columns'. \>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ReSampleTD", "::", "usage"}], "=", 
   "\"\<ReSampleTD[data_,sample_]. Resample your data with step-size \
'sample'.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AtomsList", "::", "usage"}], "=", 
   "\"\<AtomsList[expr_]. Split your expression in elements\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"InterpolationDomain", "::", "usage"}], "=", 
   "\"\<InterpolationDomain[IntFunction]. Outputs the domain of your \
interpolated function IntFunction\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"positionDuplicates", "::", "usage"}], "=", 
   "\"\<positionDuplicates[list_]. Finds the duplicate elements in your \
list\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Omega]lmn", "::", "usage"}], "=", 
   "\"\<\[Omega]lmn[l_,m_,n_,Mf_,af_,ModesData\[Rule]{}]. It computes the lmn \
frequency and damping time for a BBH with parameters {Mf,af}. ModesData can \
be feed with a datafile containing the modes data, which it speeds up the \
computation. An optional SpinWeight (by default -2) can be given. Warning: a \
negative spin weight - |s| is always assumed for any input SpinWeight s, and \
m is always replaced by |m|.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"\[Omega]lmnPy", "::", "usage"}], "=", 
  "\"\<\[Omega]lmnPy[l_,m_,n_,Mf_,af_]. It computes the lmn frequency and \
damping time for a BBH with parameters {Mf,af} from the python qnm package. \
An optional SpinWeight (by default -2) can be given, and its sign is \
accounted for.\>\""}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DetectConvergence", "::", "usage"}], "=", 
   "\"\<DetectConvergence[dampsignal_,\[Tau]_,OptionsPattern[{Test\[Rule]\
FindMaximum}]]. Given a damped signal and a damping time, it estimaes a time \
t0 where the decay is order 1%\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OvertoneModel", "::", "usage"}], "=", 
   "\"\<OvertoneModelV[overtones_,pars_,ti_,OptionsPattern[]]. It provides a \
RDown ansatz for the desired number 'overtones' with parameters \
{Mf,af}.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FitRingdown", "::", "usage"}], "=", 
   "\"\<FitRingdown[data_,nmax_,truepars_]\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OvertoneFromReImToComplex", "::", "usage"}], "=", 
   "\"\<OvertoneFromReImToComplex[{xi}, {xi,yi}]. It converts a {xi,yi} \
ansatz to an xi ansatz. xi are the variables and {xi, yi} the numeric \
values\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AICcRes", "::", "usage"}], "=", 
   "\"\<AICRes[residuals_,coeff_]. It computes the AICc value from the \
residuals given the number of coefficients 'coeff' \>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"BICRes", "::", "usage"}], "=", 
   "\"\<BICRes[residuals_,coeff_]. It computes the BIC value from the \
residuals given the number of coefficients 'coeff' \>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"PValueTest", "::", "usage"}], "=", 
   "\"\<PValueTest[residuals_,coeff_]. It computes the P value from the \
residuals given the number of coefficients 'coeff' \>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CNMinimize", "::", "usage"}], "=", 
   "\"\<CNMinimize[data_,ansatz_,coeffs_,{x_,xlist_},OptionsPattern[]]. \
Minimizator for complex data where coeffs are the free coefficients to \
adjust, x is coordinate variable and x_list its values\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Arg0DStructs", "::", "usage"}], "=", 
   "\"\<Arg0DStructs[re_,im_] and Arg0DStructs[reim_] computes the phase \
angle of complex data. the two-argument version is significantly slower, the \
one-argument version is just a  backwards compatibility interface to \
UnwrappedPhase.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Abs0DStructs", "::", "usage"}], "=", 
   "\"\<Abs0DStructs[re_,im_] computes the absolute value of complex \
data.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"UnwrapPhaseVector", "::", "usage"}], "=", 
   "\"\<UnwrapPhaseVector[x_?VectorQ] unwraps the phase of a real vector \
representing a phase angle.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"UnwrapPhaseMatrix", "::", "usage"}], "=", 
   "\"\<UnwrapPhaseMatrix[x_?MatrixQ] unwraps the phase of a real time series \
where the values represent a phase angle.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"UnwrappedPhase", "::", "usage"}], "=", 
   "\"\<UnwrapPhase[x_?VectorQ] computes the unwrapped phase of a complex \
vector representing time series values; UnwrapPhase[x_?MatrixQ] computes the \
unwrapped phase of a complex time series.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CombineColumns", "::", "usage"}], "=", 
   "\"\<CombineColumns[list1_,list2_] combines columns from two lists in into \
a single list, e.g. CombineColumns[{1,2,3},{4,5,6}] will yield \
{{1,4},{2,5},{3,6}}.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"fH", "::", "usage"}], "=", "\"\<fH[f,M]\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"fNU", "::", "usage"}], "=", "\"\<fNU[f,M]\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"HessianH", "::", "usage"}], "=", 
  "\"\<HessianH[f_,t_List?VectorQ]. f is the function you want to compute the \
Hessian and t the list of parameters.\>\""}], "\n", 
 RowBox[{
  RowBox[{"CovarianceMatrix", "::", "usage"}], "=", 
  "\"\<CovarianceMatrix[res_,vars_,pars_]. It computes the convarianc:e \
matrix from the residuals and the list of parameters.\>\""}], "\n", 
 RowBox[{
  RowBox[{"CovarianceMatrixFromLikelihood", "::", "usage"}], "=", 
  "\"\<CovarianceMatrixFromLikelihood[data_]. It computes the convariance \
matrix from the likelihood distribution and the list of parameters.\>\""}], "\
\n", 
 RowBox[{
  RowBox[{"CorrelationMatrix", "::", "usage"}], "=", 
  "\"\<CovarianceMatrix[res_,vars_,pars]. It computes the correlation matrix \
from the residuals and the list of parameters.\>\""}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FisherMatrix", "::", "usage"}], "=", 
   "\"\<FisherMatrix[f_,par_List?VectorQ,truepars_List?VectorQ,OptionsPattern[\
]]\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{"LogLikelihoodDist", "::", "usage"}], "=", 
  "\"\<Likelihood[data_,ansatz_,vars_,x_]. It computes the \
likelihood.\>\""}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ComputeFitBands", "::", "usage"}], "=", 
   "\"\<ComputeFitBands[data_,ansatz_,vars_,pars_,ConfidenceLevel\[Rule]val]. \
It computes the fit ConfidentBands at the val confidence level.\>\""}], "\n", 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tPhys", "::", "usage"}], "=", "\"\<tPhys[t,M]\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tNR", "::", "usage"}], "=", "\"\<tNR[t,M]\>\""}], ";"}]}], "Code",\

 CellChangeTimes->{{3.799119367757831*^9, 3.799119370727601*^9}, {
   3.799119425119421*^9, 3.799119468059894*^9}, {3.799119540306013*^9, 
   3.7991195410743237`*^9}, {3.7991195943946466`*^9, 3.799119615858921*^9}, {
   3.7991196598152943`*^9, 3.7991196880685*^9}, {3.79911977377913*^9, 
   3.799119773989429*^9}, {3.7991199640273333`*^9, 3.799120400863236*^9}, {
   3.7991204569861593`*^9, 3.79912047055744*^9}, {3.799120536430793*^9, 
   3.799120848554914*^9}, 3.799120881845118*^9, {3.799123121037919*^9, 
   3.799123156521628*^9}, {3.7991232269158897`*^9, 3.799123284155274*^9}, {
   3.799978488566208*^9, 3.799978497181219*^9}, {3.799978607022449*^9, 
   3.799978607292985*^9}, {3.799978881613402*^9, 3.799978889625503*^9}, {
   3.7999789536495247`*^9, 3.799978955112865*^9}, {3.7999873901986847`*^9, 
   3.799987390449601*^9}, {3.801737971474408*^9, 3.801737993071816*^9}, {
   3.801738079190743*^9, 3.801738086587009*^9}, {3.801738621770132*^9, 
   3.80173862243893*^9}, {3.805787919335709*^9, 3.805787949383876*^9}, {
   3.8076095115272627`*^9, 3.807609582517907*^9}, {3.807609873921892*^9, 
   3.807609875505107*^9}, 3.80761036816432*^9, {3.807619106122518*^9, 
   3.807619304800062*^9}, {3.807620531075672*^9, 3.807620540283662*^9}, 
   3.825557056614049*^9, {3.826274410932641*^9, 3.826274427490596*^9}, {
   3.826274496338128*^9, 3.826274496740703*^9}, {3.826946661915986*^9, 
   3.826946662079143*^9}, {3.8272863101696033`*^9, 3.8272863114981823`*^9}, {
   3.827287689174634*^9, 3.827287790421536*^9}, {3.8274721555989428`*^9, 
   3.827472155817287*^9}, {3.8275612362419033`*^9, 3.82756124869645*^9}, {
   3.829798008407433*^9, 
   3.829798045140991*^9}},ExpressionUUID->"efab591e-4b89-4ab2-bcfe-\
eef66d3d6303"],

Cell[BoxData["\<\"\[Omega]lmn[l_,m_,n_,Mf_,af_]. It computes the lmn \
frequency and damping time for a BBH with parameters {Mf,af} from the python \
qnm package\"\>"], "Output",
 CellChangeTimes->{3.807608705966158*^9, 3.8076095076376266`*^9},
 CellLabel->
  "Out[121]=",ExpressionUUID->"0be03423-29ca-4271-846a-5cb15f96b4ee"]
}, Closed]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]], "Code",
 CellChangeTimes->{{3.7991222310109053`*^9, 3.799122239994329*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"ee552dc2-de40-46d1-94d7-658affe7b6fa"],

Cell[BoxData["\<\"RDown`Private`\"\>"], "Output",
 CellChangeTimes->{3.807608705981628*^9},
 CellLabel->"Out[37]=",ExpressionUUID->"bf129224-bf14-4b14-aa95-527577db3c7e"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions", "Section",
 CellChangeTimes->{{3.717145410089053*^9, 3.71714541312827*^9}, {
   3.7172172325438833`*^9, 3.71721723694738*^9}, 3.717232740150098*^9, {
   3.762577892524047*^9, 3.7625778953915577`*^9}, {3.762578513931449*^9, 
   3.76257851577108*^9}, 
   3.7625796797321777`*^9},ExpressionUUID->"ce20086e-e551-498e-b1a1-\
dd3723b02cc4"],

Cell[CellGroupData[{

Cell["Match function", "Subsection",
 CellChangeTimes->{{3.7625779093082952`*^9, 3.7625779171097937`*^9}, {
  3.799119165688805*^9, 
  3.799119168368228*^9}},ExpressionUUID->"964e5ea4-c776-451f-948b-\
bb9802afe3ef"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "EasyMatchT", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"PadRight", "->", "7"}], ",", " ", 
     RowBox[{"Listable", "->", "True"}], ",", " ", 
     RowBox[{"FreqFormat", "->", 
      RowBox[{"{", 
       RowBox[{"\"\<Mf\>\"", ",", "\"\<Index\>\"", ",", "\"\<Index\>\""}], 
       "}"}]}], ",", 
     RowBox[{"DisableChecks", "->", "False"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "EasyMatchT", "]"}], "=", 
   RowBox[{"Options", "[", "EasyMatchT", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"EasyMatchT", "[", 
    RowBox[{
     RowBox[{"h1_", "?", "ListQ"}], ",", 
     RowBox[{"h2_", "?", "ListQ"}], ",", "tMin_", ",", "tMax_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "fHz", ",", "scale", ",", "h1red", ",", "h2red", ",", 
       "tableS", ",", "norm1", ",", "norm2", ",", "myTable", ",", "myTable2", 
       ",", "prod", ",", "psddat", ",", "fMinInd", ",", "fMaxInd", ",", 
       "dt"}], "}"}], ",", "\n", "\n", 
     RowBox[{
      RowBox[{"h1red", "=", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"h1", ",", 
          RowBox[{
           RowBox[{"tMin", "<=", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "<=", "tMax"}], "&"}]}], "]"}], 
        "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", "\n", 
      RowBox[{"h2red", "=", 
       RowBox[{
        RowBox[{"Select", "[", 
         RowBox[{"h2", ",", 
          RowBox[{
           RowBox[{"tMin", "<=", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "<=", "tMax"}], "&"}]}], "]"}], 
        "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", "\n", "\n", 
      RowBox[{"norm1", "=", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Abs", "@", "h1red"}], ")"}], "^", "2"}], "]"}]}], ";", 
      "\n", 
      RowBox[{"norm2", "=", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Abs", "@", "h2red"}], ")"}], "^", "2"}], "]"}]}], ";", 
      "\n", "\n", 
      RowBox[{"myTable", "=", 
       RowBox[{"h1red", " ", 
        RowBox[{"Conjugate", "@", "h2red"}]}]}], ";", "\n", 
      RowBox[{
       RowBox[{"Re", "@", 
        RowBox[{"Total", "[", "myTable", "]"}]}], "/", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"norm1", " ", "norm2"}], "]"}]}]}]}], "\n", "]"}]}], 
  ";"}]}], "Code",
 CellChangeTimes->{{3.7991141779587927`*^9, 3.799114180293796*^9}, {
   3.799118956311602*^9, 3.7991189618936243`*^9}, {3.8018936598100243`*^9, 
   3.8018936683482437`*^9}, 3.801893715281794*^9},
 CellLabel->"In[38]:=",ExpressionUUID->"acd9a80b-e291-43b4-8ff4-1cf9230d8178"]
}, Closed]],

Cell[CellGroupData[{

Cell["Auxiliary functions", "Subsection",
 CellChangeTimes->{{3.7625779093082952`*^9, 3.7625779171097937`*^9}, {
  3.799119165688805*^9, 
  3.799119185871924*^9}},ExpressionUUID->"356b8483-9e89-4e97-a126-\
f1f283137492"],

Cell[BoxData[
 RowBox[{
  RowBox[{"IsFPNumberQ", "[", "str_String", "]"}], ":=", 
  RowBox[{
   RowBox[{"StringMatchQ", "[", 
    RowBox[{
     RowBox[{"StringTrim", "@", "str"}], ",", 
     RowBox[{
     "RegularExpression", "[", "\"\<[+-]?\\\\d+\\\\.?\\\\d*$\>\"", "]"}]}], 
    "]"}], " ", "||", " ", "\n", "                         ", 
   RowBox[{"StringMatchQ", "[", 
    RowBox[{
     RowBox[{"StringTrim", "@", "str"}], ",", 
     RowBox[{
     "RegularExpression", "[", 
      "\"\<[-+]?\\\\d*\\\\.\\\\d+([eE][-+]?\\\\d+)?\>\"", "]"}]}], 
    "]"}]}]}]], "Code",
 CellLabel->"In[41]:=",ExpressionUUID->"1d7c374f-07e5-4e30-96cb-5384d03c28d7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TimeOfMaximum", "[", 
    RowBox[{
     RowBox[{"list_", "?", "ListQ"}], ",", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{"\"\<MinTime\>\"", "->", "\"\<\>\""}], "}"}], "]"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "reducedList", ",", "vals", ",", "maxval", ",", "maxpos", ",", 
       "mintime"}], "}"}], ",", "\n", "\n", 
     RowBox[{
      RowBox[{"mintime", "=", 
       RowBox[{"OptionValue", "[", "\"\<MinTime\>\"", "]"}]}], ";", "\n", 
      "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"NumberQ", "@", "mintime"}], ",", "\n", " ", 
        RowBox[{
         RowBox[{"reducedList", "=", 
          RowBox[{"Select", "[", 
           RowBox[{"list", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ">=", " ", "mintime"}], 
             "&"}]}], "]"}]}], ";"}], ",", "\n", " ", 
        RowBox[{
         RowBox[{"reducedList", "=", "list"}], ";"}]}], "\n", "]"}], ";", 
      "\n", "\n", 
      RowBox[{"vals", "=", 
       RowBox[{"Abs", "@", 
        RowBox[{"TakeColumn", "[", 
         RowBox[{"reducedList", ",", "2"}], "]"}]}]}], ";", "\n", 
      RowBox[{"maxval", "=", 
       RowBox[{"Max", "@", "vals"}]}], ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", 
          RowBox[{"Union", "@", "vals"}]}], ">", "1"}], ",", "\n", 
        RowBox[{
         RowBox[{"maxpos", "=", 
          RowBox[{"First", "@", 
           RowBox[{"First", "@", 
            RowBox[{"Position", "[", 
             RowBox[{"vals", ",", "maxval"}], "]"}]}]}]}], ";", "\n", 
         RowBox[{"First", "[", 
          RowBox[{"reducedList", "[", 
           RowBox[{"[", "maxpos", "]"}], "]"}], "]"}]}], ",", "\n", 
        "\"\<NOMAX\>\""}], "]"}]}]}], "\n", "]"}]}], ";"}]], "Code",
 CellLabel->"In[42]:=",ExpressionUUID->"44421514-cbe3-43d9-a22a-ae2f79f87679"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PlanckTaper", "[", 
    RowBox[{
     RowBox[{"t_", "?", "VectorQ"}], ",", "t1_", ",", "t2_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tmid", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"t", ",", 
         RowBox[{
          RowBox[{"t1", "<", "#", "<", "t2"}], "&"}]}], "]"}]}], "}"}], ",", 
     RowBox[{"Join", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Length", "@", 
          RowBox[{"Select", "[", 
           RowBox[{"t", ",", 
            RowBox[{
             RowBox[{"#", "\[LessEqual]", "t1"}], "&"}]}], "]"}]}]}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"1", "/", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"t2", "-", "t1"}], ")"}], "/", 
             RowBox[{"(", 
              RowBox[{"tmid", "-", "t1"}], ")"}]}], "+", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"t2", "-", "t1"}], ")"}], "/", 
             RowBox[{"(", 
              RowBox[{"tmid", "-", "t2"}], ")"}]}]}], "]"}], "+", "1"}], 
         ")"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"1", ",", 
         RowBox[{"Length", "@", 
          RowBox[{"Select", "[", 
           RowBox[{"t", ",", 
            RowBox[{
             RowBox[{"#", "\[GreaterEqual]", "t2"}], "&"}]}], "]"}]}]}], 
        "]"}]}], "\[IndentingNewLine]", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PlanckTaper", "[", 
    RowBox[{
     RowBox[{"t_", "?", "NumberQ"}], ",", "t1_", ",", "t2_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Piecewise", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"t", "\[LessEqual]", "t1"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"t2", "-", "t1"}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{"t", "-", "t1"}], ")"}]}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"t2", "-", "t1"}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{"t", "-", "t2"}], ")"}]}]}], "]"}], "+", "1"}], 
          ")"}]}], ",", 
        RowBox[{"t1", "<", "t", "<", "t2"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"t", "\[GreaterEqual]", " ", "t2"}]}], "}"}]}], 
     "\[IndentingNewLine]", "}"}], "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.509442978376423*^9, 3.509443097806379*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"2c5ed9b6-4222-400a-b38f-6974d610d5ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"StringToNumber", "[", "y_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"temp", ",", "x"}], "}"}], ",", "\n", "\n", 
    RowBox[{
     RowBox[{"x", " ", "=", " ", 
      RowBox[{"ToString", "@", "y"}]}], ";", "\n", "\n", 
     RowBox[{"temp", " ", "=", " ", 
      RowBox[{"StringReplace", "[", 
       RowBox[{"x", ",", 
        RowBox[{"\"\< \>\"", "->", "\"\<\>\""}]}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"StringMatchQ", "[", 
        RowBox[{"temp", ",", "NumberString"}], "]"}], ",", "\n", "  ", 
       RowBox[{"ToExpression", "@", "temp"}], ",", "\n", "  ", 
       RowBox[{
        RowBox[{"temp", " ", "=", " ", 
         RowBox[{"ReadFloatingPointNumbers", "[", "temp", "]"}]}], ";", " ", 
        "\n", "  ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ListQ", "@", "temp"}], " ", "&&", " ", 
           RowBox[{
            RowBox[{"Length", "@", "temp"}], " ", ">", " ", "0"}]}], ",", 
          "\n", "    ", 
          RowBox[{"First", "@", "temp"}], ",", "\n", "    ", 
          "Indeterminate"}], "\n", "  ", "]"}]}]}], "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->"In[45]:=",ExpressionUUID->"4d6816fc-0043-4b06-b78b-bf0c073e819b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReadFloatingPointNumbers", "[", 
    RowBox[{"lineIn_String", ",", 
     RowBox[{"matchAnyFP_:", "True"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"line", ",", "fpregex", ",", "simpleHackRule", ",", "temp"}], 
      "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"temp", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"ToString", ",", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "9"}], "]"}]}], "]"}]}], ";", "\n", "\n", 
      RowBox[{"simpleHackRule", "=", 
       RowBox[{"temp", "/.", 
        RowBox[{
         RowBox[{"xx_", "/;", 
          RowBox[{"StringQ", "@", "xx"}]}], ":>", 
         RowBox[{"xx", "->", 
          RowBox[{"xx", "<>", "\"\<.0\>\""}]}]}]}]}], ";", "\n", 
      RowBox[{"line", "=", 
       RowBox[{"lineIn", "/.", "simpleHackRule"}]}], ";", "\n", "\n", 
      RowBox[{"simpleHackRule", "=", 
       RowBox[{"temp", "/.", 
        RowBox[{
         RowBox[{"xx_", "/;", 
          RowBox[{"StringQ", "@", "xx"}]}], ":>", 
         RowBox[{
          RowBox[{"xx", "<>", "\"\<.\>\""}], "->", 
          RowBox[{"xx", "<>", "\"\<.0\>\""}]}]}]}]}], ";", "\n", 
      RowBox[{"line", "=", 
       RowBox[{"line", "/.", "simpleHackRule"}]}], ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{"matchAnyFP", ",", 
        RowBox[{
         RowBox[{
         "fpregex", "=", "\"\<[-+]?\\\\d*\\\\.\\\\d+([eE][-+]?\\\\d+)?\>\""}],
          ";"}], 
        RowBox[{"(*", 
         RowBox[{
         "matches", " ", "any", " ", "floating", " ", "point", " ", 
          "number"}], "*)"}], ",", 
        RowBox[{
         RowBox[{
         "fpregex", "=", "\"\<[-+]?\\\\d*\\\\.?\\\\d+[eE][-+]?\\\\d+\>\""}], 
         ";"}]}], 
       RowBox[{"(*", 
        RowBox[{
        "matches", " ", "only", " ", "floating", " ", "point", " ", "numbers",
          " ", "in", " ", "exponential", " ", "format"}], "*)"}], "]"}], ";", 
      "\n", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Read", "[", 
          RowBox[{
           RowBox[{"StringToStream", "[", "#", "]"}], ",", "Number"}], "]"}], 
         "&"}], ",", 
        RowBox[{"StringCases", "[", 
         RowBox[{"line", ",", 
          RowBox[{"RegularExpression", "[", "fpregex", "]"}]}], "]"}]}], 
       "]"}]}]}], "\n", "]"}]}], ";"}]], "Code",
 CellLabel->"In[46]:=",ExpressionUUID->"eb6e4d3b-ad4a-48e6-bb7d-c0810255f29d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReSampleTD", "[", 
   RowBox[{"data_", ",", "sample_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"dataInt", ",", "domain", ",", "times"}], "}"}], ",", "\n", "\n", 
    RowBox[{
     RowBox[{"dataInt", "=", 
      RowBox[{"Interpolation", "@", "data"}]}], ";", "\n", 
     RowBox[{"domain", "=", 
      RowBox[{"InterpolationDomain", "@", "dataInt"}]}], ";", "\n", 
     RowBox[{"times", "=", 
      RowBox[{"Range", "[", 
       RowBox[{
        RowBox[{"domain", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"domain", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", "sample"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"times", ",", 
        RowBox[{"dataInt", "@", "times"}]}], "}"}], "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellLabel->"In[47]:=",ExpressionUUID->"f6f26bfb-56ea-4ac2-93fe-b97ba55f21e4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"AtomsList", "[", "expr_", "]"}], ":=", 
   RowBox[{"Union", "@", 
    RowBox[{"Select", "[", 
     RowBox[{
      RowBox[{"Level", "[", 
       RowBox[{"expr", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}]}], "]"}], ",", "AtomQ"}], 
     "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"InterpolationDomain", "[", "fun_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"min", ",", "max"}], "}"}], ",", 
     RowBox[{"fun", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TakeColumn", "[", 
    RowBox[{
     RowBox[{"list1_", "?", "ListQ"}], ",", 
     RowBox[{"list2_", "?", "ListQ"}]}], "]"}], ":=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Part", "[", 
       RowBox[{"#", ",", "list2"}], "]"}], "&"}], ",", "list1"}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"TakeColumn", "[", 
    RowBox[{
     RowBox[{"list1_", "?", "ListQ"}], ",", 
     RowBox[{"n_", "?", "IntegerQ"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"list1", "//", "Transpose"}], ")"}], "[", 
    RowBox[{"[", "n", "]"}], "]"}]}], ";"}]}], "Code",
 InitializationCell->True,
 CellChangeTimes->{{3.44498826260142*^9, 3.44498826434814*^9}, 
   3.658227791974455*^9, {3.7953436164167747`*^9, 3.795343616684309*^9}, {
   3.795343704168097*^9, 3.795343718396523*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"e92bdec3-aab4-44bb-9eb8-e8593dedbc5d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"positionDuplicates", "[", "listaux_", "]"}], ":=", 
   RowBox[{"GatherBy", "[", 
    RowBox[{
     RowBox[{"Range", "@", 
      RowBox[{"Length", "[", "listaux", "]"}]}], ",", 
     RowBox[{
      RowBox[{"listaux", "[", 
       RowBox[{"[", "#", "]"}], "]"}], "&"}]}], "]"}]}], ";"}]], "Code",
 CellLabel->"In[52]:=",ExpressionUUID->"468673e1-1d1a-410f-9fbc-3a840631d046"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Arg0DStructs", "[", 
   RowBox[{"reim_", "?", "MatrixQ"}], "]"}], ":=", 
  RowBox[{"UnwrappedPhase", "[", "reim", "]"}]}]], "Code",
 CellLabel->"In[53]:=",ExpressionUUID->"66e2ce9e-8bca-4f1a-be52-019a85583e21"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Arg0DStructs", "[", 
   RowBox[{
    RowBox[{"reim_", "?", "MatrixQ"}], ",", 
    RowBox[{"thresh_", "?", "NumberQ"}]}], "]"}], ":=", 
  RowBox[{"Arg0DStructs", "[", "reim", "]"}]}]], "Code",
 CellLabel->"In[54]:=",ExpressionUUID->"eb24db11-1413-4288-bb86-fd01706cab41"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Arg0DStructs", "[", 
    RowBox[{
     RowBox[{"re_", "?", "MatrixQ"}], ",", 
     RowBox[{"im_", "?", "MatrixQ"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "revals", ",", "imvals", ",", "reim", ",", "reimvals", ",", "times", 
       ",", "i", ",", "j", ",", "diff", ",", "\n", "tmp", ",", "twopi", ",", 
       "zero", ",", "test", ",", 
       RowBox[{"thresh", "=", 
        RowBox[{"N", "@", "\[Pi]"}]}]}], "}"}], ",", "\n", "\n", 
     RowBox[{
      RowBox[{"times", "=", 
       RowBox[{"TakeColumn", "[", 
        RowBox[{"re", ",", "1"}], "]"}]}], ";", "\n", 
      RowBox[{"revals", "=", 
       RowBox[{"TakeColumn", "[", 
        RowBox[{"re", ",", "2"}], "]"}]}], ";", "\n", 
      RowBox[{"imvals", "=", 
       RowBox[{"TakeColumn", "[", 
        RowBox[{"im", ",", "2"}], "]"}]}], ";", "\n", 
      RowBox[{"reim", " ", "=", " ", 
       RowBox[{"revals", " ", "+", " ", 
        RowBox[{"I", " ", "imvals"}]}]}], ";", "\n", "\n", 
      RowBox[{"reimvals", "=", 
       RowBox[{"Arg", "@", 
        RowBox[{"TakeColumn", "[", 
         RowBox[{"reim", ",", "2"}], "]"}]}]}], ";", "\n", "\n", 
      RowBox[{"tmp", "=", 
       RowBox[{"N", "[", 
        RowBox[{"2", " ", "\[Pi]"}], "]"}]}], ";", "\n", 
      RowBox[{"twopi", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"tmp", ",", 
         RowBox[{"Length", "@", "times"}]}], "]"}]}], ";", "\n", 
      RowBox[{"zero", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"Length", "@", "times"}]}], "]"}]}], ";", "\n", "\n", 
      RowBox[{"Do", "[", "\n", 
       RowBox[{
        RowBox[{
         RowBox[{"test", "=", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"reimvals", "[", 
             RowBox[{"[", 
              RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", 
            RowBox[{"reimvals", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}], ";", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"test", ">", "thresh"}], ")"}], ",", "\n", 
           RowBox[{
            RowBox[{"reimvals", "=", 
             RowBox[{"reimvals", "-", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"zero", "[", 
                 RowBox[{"[", 
                  RowBox[{";;", "i"}], "]"}], "]"}], ",", 
                RowBox[{"twopi", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"i", "+", "1"}], ";;"}], "]"}], "]"}]}], "]"}]}]}],
             ";"}]}], "\n", "]"}], ";", "\n", "\n", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"test", "<", 
             RowBox[{"-", "thresh"}]}], ")"}], ",", "\n", 
           RowBox[{
            RowBox[{"reimvals", "=", 
             RowBox[{"reimvals", "+", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"zero", "[", 
                 RowBox[{"[", 
                  RowBox[{";;", "i"}], "]"}], "]"}], ",", 
                RowBox[{"twopi", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"i", "+", "1"}], ";;"}], "]"}], "]"}]}], "]"}]}]}],
             ";"}]}], "\n", "]"}], ";"}], ",", "\n", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{
           RowBox[{"Length", "@", "reimvals"}], "-", "1"}]}], "}"}]}], "\n", 
       "]"}], ";", "\n", 
      RowBox[{"CombineColumns", "[", 
       RowBox[{"times", ",", "reimvals"}], "]"}]}]}], "\n", "]"}]}], 
  ";"}]], "Code",
 CellLabel->"In[55]:=",ExpressionUUID->"e0b2f90b-4851-4681-a707-93dfa51b950f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Abs0DStructs", "[", 
    RowBox[{"re_", ",", "im_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "revals", ",", "imvals", ",", "reimvals", ",", "times", ",", "dt", ",", 
       "result"}], "}"}], ",", "\n", "\n", 
     RowBox[{
      RowBox[{"times", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"First", ",", "re"}], "]"}]}], ";", "\n", 
      RowBox[{"revals", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"Last", ",", "re"}], "]"}]}], ";", "\n", 
      RowBox[{"imvals", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"Last", ",", "im"}], "]"}]}], ";", "\n", "\n", 
      RowBox[{"reimvals", "=", 
       RowBox[{"revals", " ", "+", " ", 
        RowBox[{"I", " ", "imvals"}]}]}], ";", "\n", 
      RowBox[{"reimvals", "=", 
       RowBox[{"Abs", "@", "reimvals"}]}], ";", "\n", "\n", 
      RowBox[{"result", "=", 
       RowBox[{"CombineColumns", "[", 
        RowBox[{"times", ",", "reimvals"}], "]"}]}]}]}], "\n", "]"}]}], 
  ";"}]], "Code",
 CellLabel->"In[56]:=",ExpressionUUID->"bc53afdf-e943-48c2-86c7-f6061351661a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Abs0DStructs", "[", "reim_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"reimvals", ",", "times", ",", "dt", ",", "result"}], "}"}], 
     ",", "\n", "\n", 
     RowBox[{
      RowBox[{"times", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"First", ",", "reim"}], "]"}]}], ";", "\n", "\n", 
      RowBox[{"reimvals", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"Last", ",", "reim"}], "]"}]}], ";", "\n", 
      RowBox[{"reimvals", "=", 
       RowBox[{"Abs", "@", "reimvals"}]}], ";", "\n", "\n", 
      RowBox[{"result", "=", 
       RowBox[{"CombineColumns", "[", 
        RowBox[{"times", ",", "reimvals"}], "]"}]}]}]}], "\n", "]"}]}], 
  ";"}]], "Code",
 CellLabel->"In[57]:=",ExpressionUUID->"85473fd6-6758-42ab-b08c-9603b15a8b4c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"UnwrapPhaseVector", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"data", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Juergen", " ", "Tischer"}], ",", "\n", 
       RowBox[{
        RowBox[{"http", ":"}], "//", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"forums", ".", "wolfram", ".", "com"}], "/", 
             "mathgroup"}], "/", "archive"}], "/", "1998"}], "/", "May"}], 
         "/", 
         RowBox[{"msg00105", ".", "html"}]}]}]}], "*)"}], "\n", 
     RowBox[{"FoldList", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Round", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"#1", "-", "#2"}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{"2", "Pi"}], ")"}]}], "]"}], " ", "2", "Pi"}], "+", 
         "#2"}], "&"}], ",", 
       RowBox[{"First", "[", "data", "]"}], ",", 
       RowBox[{"Rest", "[", "data", "]"}]}], "]"}]}], "\n", "]"}]}], 
  ";"}]], "Code",
 CellLabel->"In[58]:=",ExpressionUUID->"e7ae596b-deb7-4f84-9610-9a11170e29df"],

Cell[BoxData[
 RowBox[{
  RowBox[{"UnwrappedPhase", "[", 
   RowBox[{"data_", "?", "VectorQ"}], "]"}], ":=", 
  RowBox[{"UnwrapPhaseVector", "[", 
   RowBox[{"Arg", "@", "data"}], "]"}]}]], "Code",
 CellLabel->"In[59]:=",ExpressionUUID->"ac162a9f-c8ea-4b77-b9dd-33728f284915"],

Cell[BoxData[
 RowBox[{
  RowBox[{"UnwrappedPhase", "[", 
   RowBox[{"data_", "?", "MatrixQ"}], "]"}], ":=", 
  RowBox[{"CombineColumns", "[", 
   RowBox[{
    RowBox[{"TakeColumn", "[", 
     RowBox[{"data", ",", "1"}], "]"}], ",", 
    RowBox[{"UnwrapPhaseVector", "[", 
     RowBox[{"Arg", "@", 
      RowBox[{"TakeColumn", "[", 
       RowBox[{"data", ",", "2"}], "]"}]}], "]"}]}], "]"}]}]], "Code",
 CellLabel->"In[60]:=",ExpressionUUID->"a7650f1d-49ea-409d-b201-4e28f33d8f17"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"CombineColumns", "[", 
    RowBox[{"list1_", ",", "list2_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "@", "list1"}], "==", 
      RowBox[{"Length", "@", "list2"}]}], ",", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"list1", ",", "list2"}], "}"}], "//", "Transpose"}], ",", 
     RowBox[{
      RowBox[{"0", 
       RowBox[{"{", 
        RowBox[{"list1", ",", "list1"}], "}"}]}], "//", "Transpose"}]}], 
    "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"CombineColumns", "[", "list_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "@", 
      RowBox[{"Union", "@", 
       RowBox[{"(", 
        RowBox[{"Length", " ", "/@", " ", "list"}], ")"}]}]}], " ", "==", " ",
      "1"}], ",", " ", 
    RowBox[{"list", "//", "Transpose"}], ",", 
    RowBox[{"{", "}"}]}], "]"}]}]}], "Code",
 CellLabel->"In[61]:=",ExpressionUUID->"3c2acbf4-48c7-465c-8286-93552b4d3531"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fH", "[", 
     RowBox[{"f_", ",", "M_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"c", ",", "G", ",", "MS"}], "}"}], ",", "\n", 
      RowBox[{
       RowBox[{"c", "=", 
        RowBox[{"2.99792458", " ", 
         RowBox[{"10", "^", "8"}]}]}], ";", 
       RowBox[{"G", "=", 
        RowBox[{"6.67259", "*", 
         RowBox[{"10", "^", 
          RowBox[{"-", "11"}]}]}]}], ";", 
       RowBox[{"MS", "=", 
        RowBox[{"1.9885", "*", 
         RowBox[{"10", "^", "30"}]}]}], ";", "\n", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", "c", ")"}], "^", "3"}], "/", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", "M", ")"}], "MS", 
           RowBox[{"(", "G", ")"}]}], ")"}]}], " ", "f"}]}]}], "]"}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"in", " ", "Solar", " ", "mass", " ", "units"}], " ", 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"fNU", "[", 
    RowBox[{"f_", ",", "M_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"c", ",", "G", ",", "MS"}], "}"}], ",", 
     RowBox[{
      RowBox[{"c", "=", 
       RowBox[{"2.99792458", " ", 
        RowBox[{"10", "^", "8"}]}]}], ";", 
      RowBox[{"G", "=", 
       RowBox[{"6.67259", "*", 
        RowBox[{"10", "^", 
         RowBox[{"-", "11"}]}]}]}], ";", 
      RowBox[{"MS", "=", 
       RowBox[{"1.9885", "*", 
        RowBox[{"10", "^", "30"}]}]}], ";", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", "M", ")"}], "MS", 
          RowBox[{"(", "G", ")"}]}], ")"}], "/", 
        RowBox[{
         RowBox[{"(", "c", ")"}], "^", "3"}]}], " ", "f"}]}]}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"tPhys", "[", 
    RowBox[{"t_", ",", "M_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"c", ",", "G", ",", "MS"}], "}"}], ",", 
     RowBox[{
      RowBox[{"c", "=", 
       RowBox[{"2.99792458", " ", 
        RowBox[{"10", "^", "8"}]}]}], ";", 
      RowBox[{"G", "=", 
       RowBox[{"6.67259", "*", 
        RowBox[{"10", "^", 
         RowBox[{"-", "11"}]}]}]}], ";", 
      RowBox[{"MS", "=", 
       RowBox[{"1.9885", "*", 
        RowBox[{"10", "^", "30"}]}]}], ";", "\n", "                     ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"(", "M", ")"}], "MS", 
          RowBox[{"(", "G", ")"}]}], ")"}], "/", 
        RowBox[{
         RowBox[{"(", "c", ")"}], "^", "3"}]}], " ", "t"}]}]}], "]"}]}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{"tNR", "[", 
   RowBox[{"t_", ",", "M_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c", ",", "G", ",", "MS"}], "}"}], ",", 
    RowBox[{
     RowBox[{"c", "=", 
      RowBox[{"2.99792458", " ", 
       RowBox[{"10", "^", "8"}]}]}], ";", 
     RowBox[{"G", "=", 
      RowBox[{"6.67259", "*", 
       RowBox[{"10", "^", 
        RowBox[{"-", "11"}]}]}]}], ";", 
     RowBox[{"MS", "=", 
      RowBox[{"1.9885", "*", 
       RowBox[{"10", "^", "30"}]}]}], ";", "\n", "                      ", 
     RowBox[{
      RowBox[{"1", "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", "M", ")"}], "MS", 
           RowBox[{"(", "G", ")"}]}], ")"}], "/", 
         RowBox[{
          RowBox[{"(", "c", ")"}], "^", "3"}]}], ")"}]}], " ", "t"}]}]}], 
   "]"}]}]}], "Code",
 CellLabel->"In[63]:=",ExpressionUUID->"1410a7ff-128b-4a76-b41a-a0f54f55ac65"]
}, Closed]],

Cell[CellGroupData[{

Cell["CNMinimise", "Subsection",
 CellChangeTimes->{{3.799123097832287*^9, 3.799123100017612*^9}, 
   3.800858891083128*^9},ExpressionUUID->"c6bb24a7-12f8-4cda-bce0-\
4aa336c33174"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "CNMinimize", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Options", "@", "NMinimize"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<Bounds\>\"", "\[Rule]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"\"\<Weights\>\"", "\[Rule]", 
        RowBox[{"{", "}"}]}]}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"CNMinimize", "[", 
    RowBox[{"data_", ",", "ansatz_", ",", "vars_", ",", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "xlist_"}], "}"}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "accgoal", ",", "ansatzlist", ",", "bounds", ",", "likelihood", ",", 
       "maxit", ",", "method", ",", "precgoal", ",", "weights"}], "}"}], ",", 
     "\n", 
     RowBox[{
      RowBox[{"method", "=", 
       RowBox[{"OptionValue", "[", "\"\<Method\>\"", "]"}]}], ";", "\n", 
      RowBox[{"maxit", "=", 
       RowBox[{"OptionValue", "[", "\"\<MaxIterations\>\"", "]"}]}], ";", 
      "\n", 
      RowBox[{"bounds", "=", 
       RowBox[{"OptionValue", "[", "\"\<Bounds\>\"", "]"}]}], ";", "\n", 
      RowBox[{"accgoal", "=", 
       RowBox[{"OptionValue", "[", "\"\<AccuracyGoal\>\"", "]"}]}], ";", "\n", 
      RowBox[{"precgoal", "=", 
       RowBox[{"OptionValue", "[", "\"\<PrecisionGoal\>\"", "]"}]}], ";", 
      "\n", 
      RowBox[{"weights", "=", 
       RowBox[{"OptionValue", "[", "\"\<Weights\>\"", "]"}]}], ";", "\n", 
      "\n", 
      RowBox[{"ansatzlist", "=", 
       RowBox[{"ansatz", "/.", 
        RowBox[{"x", "->", "xlist"}]}]}], ";", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "weights"}], ">", "0"}], ",", "\n", "\t", 
        RowBox[{"likelihood", "=", 
         RowBox[{"{", 
          RowBox[{"Total", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Re", "[", 
                RowBox[{"ansatzlist", "-", "data"}], "]"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"Im", "[", 
                RowBox[{"ansatzlist", "-", "data"}], "]"}], "^", "2"}]}], 
             ")"}], "/", 
            RowBox[{"(", 
             RowBox[{"2", " ", "weights"}], ")"}]}], "]"}], "}"}]}], ",", 
        "\n", "\t", 
        RowBox[{"likelihood", "=", 
         RowBox[{"{", 
          RowBox[{"Total", "[", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Re", "[", 
               RowBox[{"ansatzlist", "-", "data"}], "]"}], "^", "2"}], "+", 
             RowBox[{
              RowBox[{"Im", "[", 
               RowBox[{"ansatzlist", "-", "data"}], "]"}], "^", "2"}]}], 
            ")"}], "]"}], "}"}]}]}], "\n", "\t", "]"}], ";", "\n", "\t", "\n", 
      RowBox[{"likelihood", "=", 
       RowBox[{"Join", "[", 
        RowBox[{"likelihood", ",", "bounds"}], "]"}]}], ";", "\n", 
      RowBox[{"NMinimize", "[", 
       RowBox[{"likelihood", ",", "vars", ",", 
        RowBox[{"Method", "\[Rule]", "method"}], ",", 
        RowBox[{"MaxIterations", "\[Rule]", "maxit"}], ",", 
        RowBox[{"AccuracyGoal", "\[Rule]", "accgoal"}], ",", 
        RowBox[{"PrecisionGoal", "\[Rule]", "accgoal"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Code",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQBGIQHWLKzVlq+Mbxx8y/AiBahe+yPIiuS4pQAtFXlSZ/
qADSDgfOfgbRU6JMvSuB9LXSSYEgeoJ/dTqIPrsnIANE72JlywPRZyxvtoDo
R/xli0D0vQ33loLosqDV20C0iumB7SA6al/cXhDNFHZmH4j+zPT+Koj+Jlpw
B0Qf3M7/GEQX2Z95DTbHzfArmN6n+xNEV/RvY6gC0sIWiowgupcrc72D3xvH
pWc8t4Do+K5fu0F0A2/MHhB9aGMEr0TAG8d9FdVCIPpK7g0ZEH3rYpIciJb5
NvXU6oY3jpOuNVwC0Qs8Fr0E0d/nFbwC0UzpS9+BaJX8mZ9AdOVz9b8guuHx
CzC9w36z1BogvWjjbGkQvc+J3WMTkE6z/RkEou2mXb99s/GN416Nnncg+kvw
KdZbQHqfbwM3iAYAAGLN6g==
  
  "],ExpressionUUID->"5de50ab8-e5be-4535-9354-434de2836834"]
}, Closed]],

Cell[CellGroupData[{

Cell["Load and classify SXS data", "Subsection",
 CellChangeTimes->{{3.7625779093082952`*^9, 3.7625779171097937`*^9}, {
  3.799119165688805*^9, 
  3.7991192225189257`*^9}},ExpressionUUID->"306aaf72-c2ea-46d3-b394-\
84934dd4014f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetAsymptoticMultiMode", "[", 
   RowBox[{"h5file_", ",", "order_", ",", "list_", ",", 
    RowBox[{"OptionsPattern", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<Verbose\>\"", "->", "False"}], ",", 
       RowBox[{"\"\<TiReIm\>\"", "->", "True"}], ",", 
       RowBox[{"\"\<ZeroAlign\>\"", "->", "False"}], ",", 
       RowBox[{"\"\<ReSample\>\"", "->", "True"}], ",", 
       RowBox[{"\"\<Sampling\>\"", "->", "0.5"}]}], "}"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "datasets", ",", "targetstring", ",", "pos", ",", "VPrint", ",", "\n", 
      "l", ",", "m", ",", "positions", ",", "timreim", ",", "tt", ",", "re", 
      ",", "im", ",", "import", ",", "zeroalign", ",", "tmax", ",", 
      "resample", ",", "wave", ",", "sampling"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{
      RowBox[{"VPrint", "[", "expr___", "]"}], ":=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<Verbose\>\"", "]"}], ",", 
        RowBox[{"Print", "[", "expr", "]"}]}], "]"}]}], ";", "\n", 
     RowBox[{"timreim", "=", 
      RowBox[{"OptionValue", "[", "\"\<TiReIm\>\"", "]"}]}], ";", "\n", 
     RowBox[{"zeroalign", "=", 
      RowBox[{"OptionValue", "[", "\"\<ZeroAlign\>\"", "]"}]}], ";", "\n", 
     RowBox[{"resample", "=", 
      RowBox[{"OptionValue", "[", "\"\<ReSample\>\"", "]"}]}], ";", "\n", 
     RowBox[{"sampling", "=", 
      RowBox[{"OptionValue", "[", "\"\<Sampling\>\"", "]"}]}], ";", "\n", 
     "                                                        ", "\n", 
     RowBox[{"datasets", "=", 
      RowBox[{"Import", "[", 
       RowBox[{"h5file", ",", "\"\<Datasets\>\""}], "]"}]}], ";", "\n", "\n", 
     
     RowBox[{"positions", "=", 
      RowBox[{"Table", "[", "\n", "                 ", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"NumberQ", "[", "order", "]"}], ",", 
           RowBox[{
            RowBox[{"l", "=", 
             RowBox[{"list", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
            "                  ", 
            RowBox[{"m", "=", 
             RowBox[{"list", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "2"}], "]"}], "]"}]}], ";", "\n", 
            "                  ", 
            RowBox[{"targetstring", "=", 
             RowBox[{"\"\</Extrapolated_N\>\"", "<>", 
              RowBox[{"ToString", "[", "order", "]"}], "<>", 
              "\"\<.dir/Y_l\>\"", "<>", 
              RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<_m\>\"", "<>", 
              RowBox[{"ToString", "[", "m", "]"}], "<>", "\"\<.dat\>\""}]}], 
            ";"}], "\n", "                      ", ",", "\n", 
           "                  ", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"order", "===", "\"\<outermost\>\""}], ",", 
             RowBox[{
              RowBox[{"targetstring", "=", 
               RowBox[{"\"\</OutermostExtraction.dir/Y_l\>\"", "<>", 
                RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<_m\>\"", "<>", 
                RowBox[{"ToString", "[", "m", "]"}], "<>", "\"\<.dat\>\""}]}],
               ";"}]}], "]"}]}], "\n", "                 ", "]"}], ";", "\n", 
         
         RowBox[{"VPrint", "[", 
          RowBox[{"\"\<Targeting entry: \>\"", ",", "targetstring"}], "]"}], 
         ";", "\n", 
         RowBox[{"pos", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"datasets", ",", "targetstring"}], "]"}], "]"}]}], ";", 
         RowBox[{"Switch", "[", 
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], ",", "\n", "0", ",", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<Data not found\>\"", "]"}], ";", 
            RowBox[{"Return", "[", "Null", "]"}], ";"}], ",", "\n", "1", ",", 
           
           RowBox[{
            RowBox[{"pos", "=", 
             RowBox[{"pos", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";"}], ",", "\n", "_", ",", 
           RowBox[{
            RowBox[{
            "Print", "[", "\"\<Error, two entries with this name\>\"", "]"}], 
            ";", "\n", 
            RowBox[{"Return", "[", "Null", "]"}], ";"}]}], "]"}], ";", "\n", 
         RowBox[{"VPrint", "[", 
          RowBox[{"\"\<Annotations: \>\"", ",", 
           RowBox[{"Import", "[", 
            RowBox[{"h5file", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<Annotations\>\"", ",", "pos"}], "}"}]}], "]"}]}], 
          "]"}], ";", "\n", 
         RowBox[{"VPrint", "[", 
          RowBox[{"\"\<Data Format: \>\"", ",", 
           RowBox[{"Import", "[", 
            RowBox[{"h5file", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<DataFormat\>\"", ",", "pos"}], "}"}]}], "]"}]}], 
          "]"}], ";", "\n", 
         RowBox[{"VPrint", "[", 
          RowBox[{"\"\<Data dimensions: \>\"", ",", 
           RowBox[{"Import", "[", 
            RowBox[{"h5file", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<Dimensions\>\"", ",", "pos"}], "}"}]}], "]"}]}], 
          "]"}], ";", "\n", 
         RowBox[{"VPrint", "[", 
          RowBox[{"\"\<Data encoding: \>\"", ",", 
           RowBox[{"Import", "[", 
            RowBox[{"h5file", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<DataEncoding\>\"", ",", "pos"}], "}"}]}], "]"}]}], 
          "]"}], ";", "\n", "pos"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "list", "]"}]}], "}"}]}], "]"}]}], ";", "\n",
      "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "list", "]"}], "==", "1"}], ",", "\n", 
       "                 ", 
       RowBox[{
        RowBox[{"import", "=", 
         RowBox[{"{", 
          RowBox[{"Import", "[", 
           RowBox[{"h5file", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<Data\>\"", ",", "positions"}], "}"}]}], "]"}], 
          "}"}]}], ";"}], ",", "\n", "                 ", 
       RowBox[{
        RowBox[{"import", "=", 
         RowBox[{"Import", "[", 
          RowBox[{"h5file", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<Data\>\"", ",", "positions"}], "}"}]}], "]"}]}], 
        ";"}]}], "\n", "]"}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{"timreim", ",", 
       RowBox[{
        RowBox[{"wave", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#1", "/.", " ", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"tt_", ",", "re_", ",", "im_"}], "}"}], "->", 
              RowBox[{"{", 
               RowBox[{"tt", ",", 
                RowBox[{"re", "+", 
                 RowBox[{"I", " ", "im"}]}]}], "}"}]}]}], "&"}], ")"}], "/@", 
          "import"}]}], ";"}], ",", 
       RowBox[{"wave", "=", "import"}]}], "]"}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{"resample", ",", 
       RowBox[{
        RowBox[{"wave", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"ReSampleTD", "[", 
            RowBox[{"#", ",", "sampling"}], "]"}], "&"}], "/@", "wave"}]}], 
        ";"}]}], "]"}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{"zeroalign", ",", 
       RowBox[{
        RowBox[{"tmax", "=", 
         RowBox[{"TimeOfMaximum", "[", 
          RowBox[{"wave", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"Round", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Length", "@", 
                   RowBox[{"wave", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", "2"}], 
                "]"}]}], ";;", 
              RowBox[{"-", "1"}]}]}], "]"}], "]"}], "]"}]}], ";", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"wave", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "All", ",", "1"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"wave", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "All", ",", "1"}], "]"}], "]"}], "-", 
            "tmax"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "import"}]}], "}"}]}], "]"}]}]}], "]"}], 
     ";", "\n", "wave"}]}], "\n", "]"}]}]], "Code",
 CellLabel->"In[69]:=",ExpressionUUID->"c03ad841-0c13-4803-9638-d5c9b3a75ca4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SXSMetaFilesToRules", "[", "filePath_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "filepath", ",", "fileList", ",", "meta1", ",", "pos1", ",", "meta2", 
      ",", "meta3", ",", "meta4", ",", "value", ",", "var", ",", "list"}], 
     "}"}], ",", "\n", "\n", "\n", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ListQ", "@", "filePath"}], ",", 
       RowBox[{"filepath", "=", 
        RowBox[{"filePath", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", 
       RowBox[{"filepath", "=", "filePath"}]}], "]"}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", 
        RowBox[{"FileExistsQ", "@", "filepath"}]}], ",", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<File not found\>\"", "]"}], ";", 
        RowBox[{"Return", "[", "]"}]}]}], "]"}], ";", "\n", "\n", 
     RowBox[{"(*", 
      RowBox[{"Reading", " ", "the", " ", "file"}], "*)"}], "\n", 
     RowBox[{"fileList", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{"filepath", ",", "String"}], "]"}]}], ";", "\n", 
     RowBox[{"(*", 
      RowBox[{"Delete", " ", "comments"}], "*)"}], "\n", "\n", 
     RowBox[{"meta1", "=", 
      RowBox[{"Delete", "[", 
       RowBox[{"fileList", ",", 
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"StringMatchQ", "[", 
           RowBox[{"fileList", ",", "\"\<#*\>\""}], "]"}], ",", "True"}], 
         "]"}]}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"(*", 
      RowBox[{"Fix", " ", "eccentricity"}], "*)"}], "\n", 
     RowBox[{
      RowBox[{"meta1", "[", 
       RowBox[{"[", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"StringMatchQ", "[", 
            RowBox[{"meta1", ",", "\"\<*<*e-*\>\""}], "]"}], ",", "True"}], 
          "]"}]}], "]"}], "]"}], "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{
        RowBox[{"meta1", "[", 
         RowBox[{"[", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"StringMatchQ", "[", 
              RowBox[{"meta1", ",", "\"\<*<*e-*\>\""}], "]"}], ",", "True"}], 
            "]"}]}], "]"}], "]"}], ",", 
        RowBox[{"\"\<<\>\"", "->", "\"\<\>\""}]}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"(*", 
      RowBox[{"Find", " ", "="}], " ", "*)"}], "\n", 
     RowBox[{"meta2", "=", 
      RowBox[{"meta1", "[", 
       RowBox[{"[", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"StringMatchQ", "[", 
            RowBox[{"meta1", ",", "\"\<*=*\>\""}], "]"}], ",", "True"}], 
          "]"}]}], "]"}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"meta3", "=", 
      RowBox[{"StringSplit", "[", 
       RowBox[{"meta2", ",", "\"\<=\>\""}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Select", " ", "non"}], "-", 
       RowBox[{"empty", " ", "fields"}]}], "*)"}], "\n", 
     RowBox[{"meta3", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"meta3", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", "#"}], ">", "1"}], "&"}]}], "]"}]}], ";", 
     "\n", "\n", 
     RowBox[{"(*", 
      RowBox[{"Delete", " ", "spaces"}], "*)"}], "\n", 
     RowBox[{"meta4", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"StringReplace", "[", 
          RowBox[{
           RowBox[{"meta3", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"\"\< \>\"", "->", "\"\<\>\""}]}], "]"}], ",", 
         RowBox[{"StringReplace", "[", 
          RowBox[{
           RowBox[{"meta3", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"\"\< \>\"", "->", "\"\<\>\""}]}], "]"}]}], "}"}], "]"}]}],
      ";", "\n", "\n", 
     RowBox[{"var", "=", 
      RowBox[{"meta4", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{"value", "=", 
      RowBox[{"meta4", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"value", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"StringSplit", "[", 
         RowBox[{"#", ",", "\"\<,\>\""}], "]"}], "&"}], "/@", "value"}]}], 
     ";", "\n", 
     RowBox[{"(*", 
      RowBox[{"Delete", " ", "empty", " ", "elements"}], "*)"}], "\n", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"value", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"value", ",", " ", 
          RowBox[{
           RowBox[{"UnsameQ", "[", 
            RowBox[{"#", ",", " ", 
             RowBox[{"{", "}"}]}], "]"}], " ", "&"}]}], "]"}]}], ";"}], 
      "*)"}], "\n", "\n", 
     RowBox[{"list", "=", 
      RowBox[{"{", "}"}]}], ";", "\n", 
     RowBox[{"Do", "[", "\n", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", 
            RowBox[{"value", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "==", "0"}], ",", "\n", 
          "      ", 
          RowBox[{"{", "}"}], "\n", "     ", ",", "\n", "      ", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"IsFPNumberQ", "@", 
              RowBox[{"value", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ",", "\n", "\t  ", 
             RowBox[{
              RowBox[{
               RowBox[{"value", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"StringToNumber", "@", "#"}], ")"}], "&"}], "/@", 
                RowBox[{"value", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}]}], ";"}]}], "\n", 
            "        ", "]"}], ";", "\n", "      ", 
           RowBox[{"list", "=", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"list", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"var", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "->", 
                RowBox[{"value", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ";"}]}], 
         "\n", "     ", "]"}], ";"}], "\n", ",", "\n", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "@", "value"}]}], "}"}]}], "]"}], ";", "\n", "\n", 
     
     RowBox[{"Flatten", "@", "list"}]}]}], "\n", "\n", "]"}]}]], "Code",
 CellLabel->"In[70]:=",ExpressionUUID->"924831b0-9d8f-411c-aba6-db1145813b58"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SXSParClassification", "[", 
   RowBox[{
    RowBox[{"sxsdir_", "?", "ListQ"}], ",", 
    RowBox[{"ClassStr_", "?", "ListQ"}], ",", 
    RowBox[{"OptionsPattern", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<\[Epsilon]\>\"", "->", "0.001"}], ",", 
       RowBox[{"\"\<HighSpin\>\"", "->", "0.8"}], ",", 
       RowBox[{"\"\<UnRepeated\>\"", "->", "False"}], ",", 
       RowBox[{"\"\<Verbose\>\"", "->", "False"}], ",", 
       RowBox[{"\"\<Mass1-Str\>\"", "->", "\"\<initial_mass1\>\""}], ",", 
       RowBox[{"\"\<Mass2-Str\>\"", "->", "\"\<initial_mass2\>\""}], ",", 
       RowBox[{"\"\<MetadataType\>\"", "\[Rule]", "\"\<json\>\""}], ",", 
       RowBox[{"\"\<CBCType\>\"", "\[Rule]", "\"\<BHBH\>\""}]}], "}"}], 
     "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"metafiles", ",", "metadata", ",", 
      RowBox[{"orbitStr", "=", "\"\<number-of-orbits\>\""}], ",", 
      RowBox[{"dStr", "=", "\"\<initial-separation\>\""}], ",", "mass1Str", 
      ",", "mass2Str", ",", 
      RowBox[{"spin1Str", "=", "\"\<reference_dimensionless_spin1\>\""}], ",",
       "\n", 
      RowBox[{"spin2Str", "=", "\"\<reference_dimensionless_spin2\>\""}], ",", 
      RowBox[{"eccStr", "=", "\"\<reference_eccentricity\>\""}], ",", "cbc", 
      ",", "cbctype", ",", 
      RowBox[{"cbctypestr", "=", "\"\<object_types\>\""}], ",", "spin1Dim", 
      ",", "spin2Dim", ",", "mass1", ",", "mass2", ",", "massratio", ",", 
      "meta", ",", "eccentricity", ",", "dist", ",", "orbit", ",", "select", 
      ",", "pos", ",", "condition", ",", "A1", ",", "A2", ",", "precvalue", 
      ",", "precvalueNorm", ",", "\[Epsilon]", ",", "\n", "spin1Norm", ",", 
      "spin2Norm", ",", "highspin", ",", "spintest", ",", "\[Chi]eff", ",", 
      "sxsdirout", ",", "spinz", ",", "spinzDiff", ",", "auxDist", ",", 
      "posdup", ",", "posdupDist", ",", "posdistecc", ",", "unrepeated", ",", 
      "verbose", ",", "sxsdiroutaux", ",", "precvalue1", ",", "precvalue2", 
      ",", "precvalueNorm1", ",", "precvalueNorm2"}], "}"}], ",", "\n", "\n", 
    
    RowBox[{
     RowBox[{
     "Print", "[", 
      "\"\<Classification Input Variables. Examples: {{'MassRatio', \
'0.99<#<1.1'}},{{'Distance', '#>16'}},{{'Orbits', '#>25'}},{{'Precessing'}},\n\
{{'CBCType','BHBH'},{'Non-Precessing'}},{{'High-Spin'}},{{'\[Chi]eff','#>0.6'}\
},{{'\[Chi]1','#>0.6'}},{{'\[Chi]2','#>0.6'}},{{'Unequal'}}\>\"", "]"}], ";", 
     "\n", 
     RowBox[{
     "Print", "[", 
      "\"\<Take care! Some of the sxs file names are not consistent with the \
metadata files\>\"", "]"}], ";", "\n", 
     RowBox[{
     "Print", "[", 
      "\"\<The spin definition is consitent with 'initial-spin' values and \
not relaxed ones\>\"", "]"}], ";", "\n", 
     RowBox[{
     "Print", "[", 
      "\"\<The mass definition is consitent with 'initial-mass' values and \
not relaxed ones\>\"", "]"}], ";", "\n", "\n", 
     RowBox[{"mass1Str", "=", 
      RowBox[{"OptionValue", "[", "\"\<Mass1-Str\>\"", "]"}]}], ";", "\n", 
     RowBox[{"mass2Str", "=", 
      RowBox[{"OptionValue", "[", "\"\<Mass2-Str\>\"", "]"}]}], ";", "\n", 
     RowBox[{"meta", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<MetadataType\>\"", "]"}]}], ";", "\n", 
     
     RowBox[{"cbctype", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<CBCType\>\"", "]"}]}], ";", "\n", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Kill", " ", "the", " ", "loop", " ", "if", " ", "the", " ", "root", 
       " ", "directory", " ", "is", " ", "wrong"}], " ", "*)"}], "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"And", "@@", 
        RowBox[{"(", 
         RowBox[{"Not", "/@", 
          RowBox[{"DirectoryQ", "/@", "sxsdir"}]}], ")"}]}], ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"Style", "[", 
          RowBox[{"\"\<Directory not found\>\"", ",", "Red"}], "]"}], "]"}], 
        ";", 
        RowBox[{"Return", "[", 
         RowBox[{"{", "}"}], "]"}]}]}], "]"}], ";", "\n", "\n", 
     RowBox[{"sxsdirout", "=", "sxsdir"}], ";", "\n", "\n", 
     RowBox[{"\[Epsilon]", "=", 
      RowBox[{"OptionValue", "[", "\"\<\[Epsilon]\>\"", "]"}]}], ";", "\n", 
     RowBox[{"highspin", "=", 
      RowBox[{"OptionValue", "[", "\"\<HighSpin\>\"", "]"}]}], ";", "\n", 
     RowBox[{"unrepeated", "=", 
      RowBox[{"OptionValue", "[", "\"\<UnRepeated\>\"", "]"}]}], ";", "\n", 
     RowBox[{"verbose", "=", 
      RowBox[{"OptionValue", "[", "\"\<Verbose\>\"", "]"}]}], ";", "\n", "\n", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{"meta", "==", "\"\<txt\>\""}], ",", "\n", 
       RowBox[{
        RowBox[{"metafiles", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"FileNames", "[", 
              RowBox[{"\"\<metadata.txt\>\"", ",", "#", ",", "4"}], "]"}], 
             "&"}], "/@", "sxsdirout"}], ",", "1"}], "]"}]}], ";", "\n", 
        RowBox[{"metadata", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"SXSMetaFilesToRules", "[", "#", "]"}], "&"}], "/@", 
          "metafiles"}]}], ";"}], ",", "\n", 
       RowBox[{"meta", "==", "\"\<json\>\""}], ",", " ", 
       RowBox[{
        RowBox[{"metafiles", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"FileNames", "[", 
              RowBox[{"\"\<metadata.json\>\"", ",", "#", ",", "4"}], "]"}], 
             "&"}], "/@", "sxsdirout"}], ",", "1"}], "]"}]}], ";", " ", 
        RowBox[{"metadata", "=", 
         RowBox[{"Import", "/@", "metafiles"}]}]}]}], "]"}], ";", "\n", "\n", 
     
     RowBox[{"cbc", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"cbctypestr", "/.", "#"}], ")"}], "&"}], "/@", 
         "metadata"}], ")"}]}]}], ";", "\n", 
     RowBox[{"pos", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"Position", "[", 
        RowBox[{"cbc", ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "==", "cbctype"}], "&"}], ")"}]}]}], "]"}]}]}], ";", 
     "\n", 
     RowBox[{"metadata", "=", 
      RowBox[{"metadata", "[", 
       RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"cbc", "=", 
      RowBox[{"cbc", "[", 
       RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"mass1", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"mass1Str", "/.", "#"}], ")"}], "&"}], "/@", "metadata"}], 
        ")"}]}]}], ";", "\n", 
     RowBox[{"mass2", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"mass2Str", "/.", "#"}], ")"}], "&"}], "/@", "metadata"}], 
        ")"}]}]}], ";", "\n", 
     RowBox[{"massratio", "=", 
      RowBox[{"mass1", "/", "mass2"}]}], ";", "\n", 
     RowBox[{"dist", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"dStr", "/.", "#"}], ")"}], "&"}], "/@", "metadata"}], 
        ")"}]}]}], ";", "\n", 
     RowBox[{"orbit", "=", 
      RowBox[{"Flatten", "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"orbitStr", "/.", "#"}], ")"}], "&"}], "/@", "metadata"}], 
        ")"}]}]}], ";", "\n", 
     RowBox[{"spin1Dim", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"spin1Str", "/.", "#"}], ")"}], "&"}], "/@", "metadata"}], 
       ")"}]}], ";", "\n", 
     RowBox[{"spin2Dim", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"spin2Str", "/.", "#"}], ")"}], "&"}], "/@", "metadata"}], 
       ")"}]}], ";", "\n", 
     RowBox[{"A1", "=", 
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{"3", " ", 
         RowBox[{"massratio", "/", 
          RowBox[{"(", "4.", ")"}]}]}]}], ")"}]}], ";", "\n", 
     RowBox[{"A2", "=", 
      RowBox[{"(", 
       RowBox[{"1", "+", 
        RowBox[{"3", " ", "/", 
         RowBox[{"(", 
          RowBox[{"4.", "*", "massratio"}], ")"}]}]}], " ", ")"}]}], ";", 
     "\n", 
     RowBox[{"\[Chi]eff", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"massratio", "/", 
         RowBox[{"(", 
          RowBox[{"1.", "+", "massratio"}], ")"}]}], "*", "spin1Dim"}], " ", 
       "+", 
       RowBox[{
        RowBox[{"1.", "/", 
         RowBox[{"(", 
          RowBox[{"1", "+", "massratio"}], ")"}]}], "*", "spin2Dim"}]}]}], 
     ";", "\n", "\n", 
     RowBox[{"eccentricity", "=", 
      RowBox[{"StringReplace", "[", 
       RowBox[{
        RowBox[{"ToString", "/@", 
         RowBox[{"(", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"eccStr", "/.", "#"}], ")"}], "&"}], "/@", "metadata"}],
            "]"}], ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\<<\>\"", "->", "\"\<\>\""}], ",", 
          RowBox[{"\"\<NaN\>\"", "->", "\"\<0\>\""}]}], "}"}]}], "]"}]}], ";",
      "\n", 
     RowBox[{"eccentricity", "=", 
      RowBox[{"ToExpression", "/@", 
       RowBox[{"StringReplace", "[", 
        RowBox[{"eccentricity", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<e+\>\"", " ", ":>", " ", "\"\<*^\>\""}], ",", " ", 
           RowBox[{"\"\<e-\>\"", " ", ":>", " ", "\"\<*^-\>\""}]}], "}"}]}], 
        "]"}]}]}], ";", "\n", "\n", 
     RowBox[{"spinz", "=", 
      RowBox[{"Chop", "/@", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"TakeColumn", "[", 
           RowBox[{"spin1Dim", ",", "3"}], "]"}], ",", 
          RowBox[{"TakeColumn", "[", 
           RowBox[{"spin2Dim", ",", "3"}], "]"}]}], "}"}], "]"}]}]}], ";", 
     "\n", 
     RowBox[{"spinzDiff", "=", 
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "-", 
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "&"}], "/@", "spinz"}], 
       "]"}]}], ";", "\n", 
     RowBox[{"condition", "=", 
      RowBox[{"ClassStr", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
     RowBox[{"select", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", 
            RowBox[{"ClassStr", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "==", "2"}], ",", 
          RowBox[{"ToExpression", "@", 
           RowBox[{"(", 
            RowBox[{"ClassStr", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}], ")"}]}], ",", 
          "\"\<Null\>\""}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "@", "ClassStr"}]}], "}"}]}], "]"}]}], ";", "\n", 
     
     RowBox[{"pos", "=", 
      RowBox[{"Table", "[", 
       RowBox[{"i", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "sxsdirout"}]}], "}"}]}], "]"}]}], ";", "\n",
      "\n", 
     RowBox[{"Do", "[", "\n", "\n", 
      RowBox[{
       RowBox[{
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", "\"\<CBCType\>\""}], ",", 
          "\n", 
          RowBox[{"Null", ";"}], "\n", ",", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", "\"\<MassRatio\>\""}], ",", 
          "\n", "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", 
               RowBox[{"ClassStr", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "!=", " ", "2"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Wrong input\>\"", "]"}], ";", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\n", "\n", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{"massratio", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"select", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], "&"}], ")"}]}]}], 
              "]"}]}]}], ";", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", "\n", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", " ", "\"\<Distance\>\""}], 
          ",", "\n", "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", 
               RowBox[{"ClassStr", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "!=", " ", "2"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Wrong input\>\"", "]"}], ";", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\n", "\n", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"sxsdirout", "=", 
                 RowBox[{"sxsdirout", "[", 
                  RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"select", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], "&"}], ")"}]}]}], 
              "]"}]}]}], ";", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", "\n", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", " ", "\"\<Orbits\>\""}], 
          ",", "\n", "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", 
               RowBox[{"ClassStr", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "!=", " ", "2"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Wrong input\>\"", "]"}], ";", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\n", "\n", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{"orbit", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"select", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], "&"}], ")"}]}]}], 
              "]"}]}]}], ";", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", "\n", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", " ", 
           "\"\<Non-Precessing\>\""}], ",", "\n", "\n", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"precvalue", "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"(", "#", ")"}], "\[Cross]", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "&"}], "/@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", "spin1Dim", ")"}], "A1"}], "+", 
                RowBox[{
                 RowBox[{"(", "spin2Dim", ")"}], "A2"}]}], ")"}]}]}], ";"}], 
           "*)"}], "\n", 
          RowBox[{
           RowBox[{"precvalue1", "=", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", "#", ")"}], "\[Cross]", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", "spin1Dim", ")"}], "A1"}], ")"}]}]}], ";", "\n", 
           RowBox[{"precvalue2", "=", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", "#", ")"}], "\[Cross]", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", "spin2Dim", ")"}], "A2"}], ")"}]}]}], ";", "\n", 
           RowBox[{"precvalueNorm1", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"Norm", "[", "#", "]"}], "&"}], "/@", "precvalue1"}]}], 
           ";", "\n", 
           RowBox[{"precvalueNorm2", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"Norm", "[", "#", "]"}], "&"}], "/@", "precvalue2"}]}], 
           ";", "\n", 
           RowBox[{"precvalueNorm", "=", 
            RowBox[{
             RowBox[{"precvalueNorm1", "^", "2"}], "+", 
             RowBox[{"precvalueNorm2", "^", "2"}]}]}], ";", "\n", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{"precvalueNorm", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"#", "<", "\[Epsilon]"}], " ", "&"}], ")"}]}]}], 
              "]"}]}]}], ";", "\n", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", "\n", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", " ", "\"\<Unequal\>\""}], 
          ",", "\n", "\n", 
          RowBox[{
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{"spinzDiff", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"#", ">", "\[Epsilon]"}], " ", "&"}], ")"}]}]}], 
              "]"}]}]}], ";", "\n", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", "\n", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", "\"\<Precessing\>\""}], ",",
           "\n", "\n", 
          RowBox[{
           RowBox[{"precvalue1", "=", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", "#", ")"}], "\[Cross]", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", "spin1Dim", ")"}], "A1"}], ")"}]}]}], ";", "\n", 
           RowBox[{"precvalue2", "=", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", "#", ")"}], "\[Cross]", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", "spin2Dim", ")"}], "A2"}], ")"}]}]}], ";", "\n", 
           RowBox[{"precvalueNorm1", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"Norm", "[", "#", "]"}], "&"}], "/@", "precvalue1"}]}], 
           ";", "\n", 
           RowBox[{"precvalueNorm2", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"Norm", "[", "#", "]"}], "&"}], "/@", "precvalue2"}]}], 
           ";", "\n", 
           RowBox[{"precvalueNorm", "=", 
            RowBox[{
             RowBox[{"precvalueNorm1", "^", "2"}], "+", 
             RowBox[{"precvalueNorm2", "^", "2"}]}]}], ";", "\n", "\n", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"precvalue", "=", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", "#", ")"}], "\[Cross]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", "spin1Dim", ")"}], "A1"}], "+", 
                 RowBox[{
                  RowBox[{"(", "spin2Dim", ")"}], "A2"}]}], ")"}]}]}], ";"}], 
            "*)"}], "\n", "\n", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{"precvalueNorm", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"#", ">", "\[Epsilon]"}], " ", "&"}], ")"}]}]}], 
              "]"}]}]}], ";", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", "\n", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", " ", "\"\<High-Spin\>\""}], 
          ",", "\n", "\n", 
          RowBox[{
           RowBox[{"spin1Norm", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"Norm", "[", "#", "]"}], "&"}], "/@", "spin1Dim"}]}], 
           ";", "\n", 
           RowBox[{"spin2Norm", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"Norm", "[", "#", "]"}], "&"}], "/@", "spin2Dim"}]}], 
           ";", "\n", "\n", 
           RowBox[{"spintest", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Abs", "@", 
                   RowBox[{"spin1Norm", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ">=", "highspin"}], " ",
                  "||", " ", 
                 RowBox[{
                  RowBox[{"Abs", "@", 
                   RowBox[{"spin2Norm", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ">=", "highspin"}]}], 
                ",", "True", ",", "False"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "@", "spin1Norm"}]}], "}"}]}], "]"}]}], ";",
            "\n", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{"spintest", ",", "True"}], "]"}]}]}], ";", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", "\n", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", " ", "\"\<\[Chi]eff\>\""}], 
          ",", "\n", "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", 
               RowBox[{"ClassStr", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "!=", " ", "2"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Wrong input\>\"", "]"}], ";", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\n", "\n", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Norm", "[", "#", "]"}], "&"}], "/@", "\[Chi]eff"}], 
               ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"select", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], " ", "&"}], 
                 ")"}]}]}], "]"}]}]}], ";", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", "\n", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", " ", "\"\<\[Chi]1\>\""}], 
          ",", "\n", "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", 
               RowBox[{"ClassStr", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "!=", " ", "2"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Wrong input\>\"", "]"}], ";", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\n", "\n", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Norm", "[", "#", "]"}], "&"}], "/@", "spin1Dim"}], 
               ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"select", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], " ", "&"}], 
                 ")"}]}]}], "]"}]}]}], ";", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", "\n", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", " ", "\"\<\[Chi]2\>\""}], 
          ",", "\n", "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", 
               RowBox[{"ClassStr", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "!=", " ", "2"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Wrong input\>\"", "]"}], ";", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\n", "\n", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Norm", "[", "#", "]"}], "&"}], "/@", "spin2Dim"}], 
               ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"select", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], " ", "&"}], 
                 ")"}]}]}], "]"}]}]}], ";", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", "\n", "\n", 
          RowBox[{
           RowBox[{"condition", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "==", " ", 
           "\"\<relaxed-eccentricity\>\""}], ",", "\n", "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", 
               RowBox[{"ClassStr", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "!=", " ", "2"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", "\"\<Wrong input\>\"", "]"}], ";", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ";", "\n", "\n", 
           RowBox[{"pos", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"Position", "[", 
              RowBox[{"eccentricity", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"select", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], " ", "&"}], 
                 ")"}]}]}], "]"}]}]}], ";", "\n", 
           RowBox[{"massratio", "=", 
            RowBox[{"massratio", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"dist", "=", 
            RowBox[{"dist", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"orbit", "=", 
            RowBox[{"orbit", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin1Dim", "=", 
            RowBox[{"spin1Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spin2Dim", "=", 
            RowBox[{"spin2Dim", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A1", "=", 
            RowBox[{"A1", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"A2", "=", 
            RowBox[{"A2", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"spinzDiff", "=", 
            RowBox[{"spinzDiff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"eccentricity", "=", 
            RowBox[{"eccentricity", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", 
           RowBox[{"\[Chi]eff", "=", 
            RowBox[{"\[Chi]eff", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";", "\n", "\n", 
           RowBox[{"sxsdirout", "=", 
            RowBox[{"sxsdirout", "[", 
             RowBox[{"[", "pos", "]"}], "]"}]}], ";"}], ",", "\n", " ", 
          "True", ",", "\n", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<Wrong input\>\"", ",", "Bold", ",", "Red", ",", "16"}], 
             "]"}], "]"}], ";", "\n", 
           RowBox[{"Break", "[", "]"}], ";"}]}], "\n", "]"}], ";"}], "\n", 
       ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "@", "ClassStr"}]}], "}"}]}], "]"}], ";", "\n", 
     "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{"unrepeated", ",", "\n", "\n", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<Taking among the repeated cases only those with lower \
eccentricity and larger D (just in case ei=ej)\>\"", "]"}], ";", "\n", "\n", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Selecting", " ", "Case", " ", "with", " ", "lower", " ", "e"}], " ",
          "*)"}], "\n", 
        RowBox[{"auxDist", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Round", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "&"}], "/@", "massratio"}], ",", "0.1"}], "]"}], 
            ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"Chop", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"10", "^", 
                   RowBox[{"(", 
                    RowBox[{"-", "2"}], ")"}]}]}], "]"}], ",", "0.01"}], 
               "]"}], "&"}], "/@", "spin1Dim"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"Chop", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"10", "^", 
                   RowBox[{"(", 
                    RowBox[{"-", "2"}], ")"}]}]}], "]"}], ",", "0.01"}], 
               "]"}], "&"}], "/@", "spin2Dim"}], ",", "dist", ",", 
            "eccentricity"}], "}"}], "]"}]}], ";", "\n", 
        RowBox[{"posdup", "=", 
         RowBox[{"positionDuplicates", "@", 
          RowBox[{"auxDist", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "3"}]}], "]"}], "]"}]}]}], ";", "\n", 
        RowBox[{"posdistecc", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"auxDist", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"posdup", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", "5"}], "]"}], "]"}], 
              ",", 
              RowBox[{"Min", "@", 
               RowBox[{"auxDist", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"posdup", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "5"}], "]"}], 
                "]"}]}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "@", "posdup"}]}], "}"}]}], "]"}]}]}], ";", 
        "\n", 
        RowBox[{"posdistecc", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"posdup", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", 
               RowBox[{"posdistecc", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "@", "posdup"}]}], "}"}]}], "]"}]}]}], ";", 
        "\n", 
        RowBox[{"sxsdirout", "=", 
         RowBox[{"sxsdirout", "[", 
          RowBox[{"[", "posdistecc", "]"}], "]"}]}], ";", "\n", "\n", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Selecting", " ", "Case", " ", "with", " ", "larger", " ", "D"}], 
         " ", "*)"}], "\n", 
        RowBox[{"auxDist", "=", 
         RowBox[{"auxDist", "[", 
          RowBox[{"[", "posdistecc", "]"}], "]"}]}], ";", "\n", 
        RowBox[{"posdup", "=", 
         RowBox[{"positionDuplicates", "@", 
          RowBox[{"auxDist", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", 
             RowBox[{"1", ";;", "3"}]}], "]"}], "]"}]}]}], ";", "\n", 
        RowBox[{"posdistecc", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"auxDist", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"posdup", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", "4"}], "]"}], "]"}], 
              ",", 
              RowBox[{"Max", "@", 
               RowBox[{"auxDist", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"posdup", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "4"}], "]"}], 
                "]"}]}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "@", "posdup"}]}], "}"}]}], "]"}]}]}], ";", 
        "\n", 
        RowBox[{"posdistecc", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"posdup", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", 
               RowBox[{"posdistecc", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "@", "posdup"}]}], "}"}]}], "]"}]}]}], ";", 
        "\n", "\n", 
        RowBox[{"auxDist", "=", 
         RowBox[{"auxDist", "[", 
          RowBox[{"[", "posdistecc", "]"}], "]"}]}], ";", "\n", 
        RowBox[{"sxsdirout", "=", 
         RowBox[{"sxsdirout", "[", 
          RowBox[{"[", "posdistecc", "]"}], "]"}]}], ";", "\n", 
        RowBox[{"sxsdiroutaux", "=", 
         RowBox[{"SortBy", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"sxsdirout", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "}"}], ",", 
               RowBox[{"auxDist", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "@", "sxsdirout"}]}], "}"}]}], "]"}], ",", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "&"}]}], "]"}]}], ";", "\n", 
        "\n", 
        RowBox[{"If", "[", 
         RowBox[{"verbose", ",", " ", "\n", 
          RowBox[{"Print", "[", 
           RowBox[{
            RowBox[{"Prepend", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"ToString", "@", "#"}], "&"}], "/@", 
                 RowBox[{"sxsdiroutaux", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "@", "sxsdiroutaux"}]}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Case\>\"", ",", "\"\<q\>\"", ",", "\"\<\[Chi]1\>\"", ",", 
                "\"\<\[Chi]2\>\"", ",", "\"\<D\>\"", ",", "\"\<e\>\""}], 
               "}"}]}], "]"}], "//", "TableForm"}], "]"}]}], "]"}], ";", "\n",
         "\n", 
        RowBox[{"sxsdiroutaux", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", "\n", "\n", 
       RowBox[{
        RowBox[{"auxDist", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Round", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "&"}], "/@", "massratio"}], ",", "0.1"}], "]"}], 
            ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"Chop", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"10", "^", 
                   RowBox[{"(", 
                    RowBox[{"-", "2"}], ")"}]}]}], "]"}], ",", "0.01"}], 
               "]"}], "&"}], "/@", "spin1Dim"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Round", "[", 
               RowBox[{
                RowBox[{"Chop", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"10", "^", 
                   RowBox[{"(", 
                    RowBox[{"-", "2"}], ")"}]}]}], "]"}], ",", "0.01"}], 
               "]"}], "&"}], "/@", "spin2Dim"}], ",", "dist", ",", 
            "eccentricity"}], "}"}], "]"}]}], ";", "\n", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"sxsdiroutaux", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"sxsdirout", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "}"}], ",", 
               RowBox[{"auxDist", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "@", "sxsdirout"}]}], "}"}]}], "]"}]}], 
          ";"}], "*)"}], "\n", 
        RowBox[{"sxsdiroutaux", "=", 
         RowBox[{"SortBy", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"sxsdirout", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "}"}], ",", 
               RowBox[{"auxDist", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "@", "sxsdirout"}]}], "}"}]}], "]"}], ",", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "&"}]}], "]"}]}], ";", "\n", 
        RowBox[{"If", "[", 
         RowBox[{"verbose", ",", " ", "\n", 
          RowBox[{"Print", "[", 
           RowBox[{
            RowBox[{"Prepend", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"ToString", "@", "#"}], "&"}], "/@", 
                 RowBox[{"sxsdiroutaux", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "@", "sxsdiroutaux"}]}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Case\>\"", ",", "\"\<q\>\"", ",", "\"\<\[Chi]1\>\"", ",", 
                "\"\<\[Chi]2\>\"", ",", "\"\<D\>\"", ",", "\"\<e\>\""}], 
               "}"}]}], "]"}], "//", "TableForm"}], "]"}]}], "]"}], ";", "\n",
         "\n", 
        RowBox[{"sxsdiroutaux", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "]"}]}]}], "\n", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.799113136734363*^9, 3.79911313895014*^9}, {
   3.829820385991981*^9, 3.829820386590106*^9}, {3.829820689521801*^9, 
   3.829820700373467*^9}, 3.8298207492838917`*^9, {3.829820791521554*^9, 
   3.829820822474772*^9}, {3.829820856464714*^9, 3.8298208598708344`*^9}, 
   3.829820916221373*^9, {3.8298210232485733`*^9, 3.829821161316608*^9}, {
   3.8298211957329283`*^9, 3.829821196066894*^9}, {3.829821537497633*^9, 
   3.829821640738596*^9}, {3.829821673049975*^9, 3.8298216820736322`*^9}, {
   3.8298217764591513`*^9, 3.829821796393515*^9}, 3.829821883463543*^9, {
   3.8298220219474783`*^9, 3.8298220871156073`*^9}, {3.829822121759975*^9, 
   3.829822147263884*^9}, {3.8298222988068457`*^9, 3.829822331322806*^9}, {
   3.829822383277646*^9, 3.829822385402829*^9}, {3.829823490919178*^9, 
   3.829823656753866*^9}, {3.82982371133321*^9, 3.829823735570547*^9}, {
   3.8298237718797827`*^9, 3.829823859652315*^9}, {3.829823900505849*^9, 
   3.829823902691965*^9}, {3.829823951149022*^9, 3.829823952282105*^9}, 
   3.829823996494733*^9, {3.829824066008716*^9, 3.8298240723220797`*^9}, {
   3.8298241338520203`*^9, 3.829824152053061*^9}, {3.8298242048710012`*^9, 
   3.829824252115347*^9}, {3.829824936948543*^9, 3.829824946770509*^9}, {
   3.82982497941894*^9, 3.829824982880064*^9}, {3.829825013500037*^9, 
   3.829825046496698*^9}, {3.829825098200527*^9, 
   3.829825110038806*^9}},ExpressionUUID->"53efc507-6a18-4eaf-b317-\
b615cf672bde"]
}, Closed]],

Cell[CellGroupData[{

Cell["RDown frequency and damping time", "Subsection",
 CellChangeTimes->{{3.717145410089053*^9, 3.71714541312827*^9}, {
   3.7172172325438833`*^9, 3.71721723694738*^9}, 3.717232740150098*^9, {
   3.719561185753558*^9, 3.71956118876759*^9}, {3.762579157516369*^9, 
   3.7625791630033073`*^9}, {3.762579322938787*^9, 3.7625793374944468`*^9}, {
   3.785052757811619*^9, 3.785052758228941*^9}, {3.799119235050438*^9, 
   3.79911926387778*^9}},ExpressionUUID->"f2291a02-b823-4df6-a581-\
4fcde9b9eb4e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "\[Omega]lmn", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<ModesData\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"\"\<ModesFile\>\"", "\[Rule]", "\"\<\>\""}], ",", 
     RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
      RowBox[{"-", "2"}]}], ",", 
     RowBox[{"\"\<CounterRotating\>\"", "\[Rule]", "False"}], ",", 
     RowBox[{"\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "False"}], ",", 
     RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "0.99"}], ",", 
     RowBox[{"\"\<N89Data\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"\[Omega]lmn", "[", 
   RowBox[{"l_", ",", "m_", ",", "n_", ",", "Mf_", ",", "af_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "counterrotating", ",", "file", ",", "data", ",", "modesdata", ",", 
      "modesfile", ",", "mstr", ",", "sp", ",", "spinweight", ",", "fmass", 
      ",", "f\[Chi]", ",", "\[Chi]\[Omega]\[Tau]", ",", "\[Omega]", ",", 
      "\[Tau]", ",", "llim", ",", "ulim"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"modesdata", "=", 
      RowBox[{"OptionValue", "[", "\"\<ModesData\>\"", "]"}]}], ";", "\n", 
     RowBox[{"modesfile", "=", 
      RowBox[{"OptionValue", "[", "\"\<ModesFile\>\"", "]"}]}], ";", "\n", 
     RowBox[{"spinweight", "=", 
      RowBox[{"Abs", "[", 
       RowBox[{"OptionValue", "[", "\"\<SpinWeight\>\"", "]"}], "]"}]}], ";", 
     "\n", 
     RowBox[{"counterrotating", "=", 
      RowBox[{"OptionValue", "[", "\"\<CounterRotating\>\"", "]"}]}], ";", 
     "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "modesdata", "]"}], "\[Equal]", "0"}], ",", 
       "\n", "    ", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"m", "\[GreaterEqual]", "0"}], ",", 
          RowBox[{"mstr", "=", "\"\<m\>\""}], ",", 
          RowBox[{"mstr", "=", "\"\<mm\>\""}]}], "]"}], ";", "\n", "    ", 
        RowBox[{"file", "=", 
         RowBox[{"modesfile", "<>", "\"\<s\>\"", "<>", 
          RowBox[{"ToString", "[", "spinweight", "]"}], "<>", "\"\</l\>\"", "<>", 
          RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\</n\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"n", "+", "1"}], "]"}], "<>", "\"\<l\>\"", "<>", 
          RowBox[{"ToString", "[", "l", "]"}], "<>", "mstr", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"Abs", "[", "m", "]"}], "]"}], "<>", "\"\<.dat\>\""}]}], 
        ";", "\n", "    ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", 
           RowBox[{"FileExistsQ", "[", "file", "]"}]}], ",", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<File not found\>\"", "]"}], ";", 
           RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", "\n", "    ", 
        RowBox[{"data", "=", 
         RowBox[{"Import", "[", "file", "]"}]}], ";"}], ",", "\n", "       ", 
       "\n", "    ", 
       RowBox[{
        RowBox[{"data", "=", "modesdata"}], ";"}]}], "\n", "       ", "]"}], 
     ";", "\n", "\n", 
     RowBox[{"\[Chi]\[Omega]\[Tau]", "=", 
      RowBox[{"TakeColumn", "[", 
       RowBox[{"data", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"fmass", "=", "Mf"}], ";", "\n", 
     RowBox[{"f\[Chi]", "=", "af"}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"af", ">", "0"}], ",", "\n", "   ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Take", " ", "the", " ", "neighbour", " ", "points", " ", "and", " ", 
         "interpolate", " ", "them"}], " ", "*)"}], "\n", "   ", 
       RowBox[{
        RowBox[{"ulim", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Select", "[", 
           RowBox[{"\[Chi]\[Omega]\[Tau]", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "\[GreaterEqual]", "f\[Chi]"}],
              "&"}], ",", "1"}], "]"}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"llim", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{"\[Chi]\[Omega]\[Tau]", ",", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "-", 
                RowBox[{"ulim", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "<", "0"}], "&"}]}], "]"}],
            "[", 
           RowBox[{"[", 
            RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"\[Omega]", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Mean", "[", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", "ulim", "}"}], ",", 
              RowBox[{"{", "llim", "}"}]}], "]"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], "/", "fmass"}]}], ";", "\n", "   ", 
        RowBox[{"\[Tau]", "=", 
         RowBox[{"Mean", "[", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Abs", "[", 
             RowBox[{"1", "/", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"ulim", "[", 
                  RowBox[{"[", 
                   RowBox[{"-", "1"}], "]"}], "]"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"llim", "[", 
                  RowBox[{"[", 
                   RowBox[{"-", "1"}], "]"}], "]"}], "}"}]}], "]"}]}], "]"}], 
            "*", "fmass"}], ")"}], "]"}]}], ";"}], ",", "\n", "   ", "\n", 
       "   ", 
       RowBox[{
        RowBox[{"ulim", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Select", "[", 
           RowBox[{"\[Chi]\[Omega]\[Tau]", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "\[GreaterEqual]", "f\[Chi]"}],
              "&"}], ",", "1"}], "]"}], "]"}]}], ";", "\n", "   ", 
        RowBox[{"\[Omega]", "=", 
         RowBox[{
          RowBox[{"ulim", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "/", "fmass"}]}], ";", "\n", "   ", 
        RowBox[{"\[Tau]", "=", 
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{"1", "/", 
            RowBox[{"ulim", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], "*", "fmass"}]}], 
        ";"}]}], "\n", "]"}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{"counterrotating", ",", 
       RowBox[{"\[Omega]", "=", 
        RowBox[{"-", "\[Omega]"}]}]}], "]"}], ";", "\n", 
     RowBox[{"{", 
      RowBox[{"\[Omega]", ",", "\[Tau]"}], "}"}]}]}], "\n", "]"}]}]}], "Code",\

 CellChangeTimes->{{3.7721985476927853`*^9, 3.772198575765624*^9}, {
   3.772198793153981*^9, 3.772198830047464*^9}, {3.7721988895906897`*^9, 
   3.772199562802928*^9}, {3.772199638377646*^9, 3.772200017819154*^9}, {
   3.77771649354319*^9, 3.777716502162915*^9}, {3.777716564048128*^9, 
   3.77771656695885*^9}, {3.7785552708514757`*^9, 3.778555308462579*^9}, {
   3.7785553469471817`*^9, 3.778555403730047*^9}, {3.7785577387693987`*^9, 
   3.778557738901156*^9}, {3.799113284272087*^9, 3.799113285169816*^9}, {
   3.799115766792492*^9, 3.7991157670850153`*^9}, {3.7991164547215643`*^9, 
   3.799116586199287*^9}, {3.799116618186366*^9, 3.7991166756249866`*^9}, {
   3.79911685538968*^9, 3.799116880268477*^9}, 3.799121006420978*^9, {
   3.7991210836378813`*^9, 3.799121172549109*^9}, {3.7991212170706882`*^9, 
   3.799121217898446*^9}, {3.7991213008580313`*^9, 3.7991213613184977`*^9}, {
   3.8012858331477957`*^9, 3.8012858942144833`*^9}, 3.801285933534213*^9, {
   3.801738063916472*^9, 3.801738066379343*^9}, {3.801738110405074*^9, 
   3.80173811392542*^9}, {3.801738336628878*^9, 3.801738363048201*^9}, {
   3.8017408609367323`*^9, 3.801740945225803*^9}, {3.80174105057705*^9, 
   3.801741076061083*^9}, {3.801741126897922*^9, 3.801741273530115*^9}, {
   3.801741315062377*^9, 3.8017414294414797`*^9}, {3.801741466421402*^9, 
   3.801741484312387*^9}, {3.805782060274537*^9, 3.805782082374318*^9}, {
   3.8057822392798367`*^9, 3.805782310483018*^9}, {3.805782404871436*^9, 
   3.8057824068406887`*^9}, {3.8057824374182587`*^9, 
   3.8057824404105186`*^9}, {3.805782588080059*^9, 3.805782588342947*^9}, {
   3.8057828723378477`*^9, 3.805782877203641*^9}, {3.805783363935945*^9, 
   3.805783396498816*^9}, {3.8057834790008593`*^9, 3.805783498951901*^9}, {
   3.8057837606612673`*^9, 3.805783768961171*^9}, 3.8057838390705338`*^9, {
   3.805783952860702*^9, 3.805783969196117*^9}, {3.805784004301193*^9, 
   3.80578400746351*^9}, {3.8057840456886797`*^9, 3.805784100955716*^9}, {
   3.805784522856874*^9, 3.8057845268605757`*^9}, {3.805787284015132*^9, 
   3.8057872841974*^9}, {3.80726931216039*^9, 3.807269357858901*^9}, {
   3.807611879083651*^9, 3.807611882953685*^9}, 3.807620502620368*^9, {
   3.8251458305573187`*^9, 3.825145852277193*^9}, {3.825488034439188*^9, 
   3.8254880427237453`*^9}, {3.826274978431983*^9, 3.8262749789463253`*^9}, {
   3.82791717767247*^9, 3.827917214641663*^9}, 
   3.827918900515122*^9},ExpressionUUID->"5a08c030-5e82-443d-af9e-\
2ce257b388db"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "\[Omega]lmnPy", "]"}], "=", 
   RowBox[{"Options", "[", "\[Omega]lmn", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"\[Omega]lmnPy", "[", 
   RowBox[{"l_", ",", "m_", ",", "n_", ",", "Mf_", ",", "af_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "data89", ",", "counterrotating", ",", "file", ",", "fmass", ",", "data",
       ",", "Global`a", ",", "intws", ",", "maxspin", ",", "modesdata", ",", 
      "modesfile", ",", "mstr", ",", "sp", ",", "spinweight", ",", "f\[Chi]", 
      ",", "\[Chi]\[Omega]\[Tau]", ",", "\[Omega]", ",", "\[Omega]1", ",", 
      "\[Omega]s", ",", "\[Omega]stab", ",", "\[Tau]", ",", "\[Tau]1", ",", 
      "llim", ",", "ulim", ",", "xx", ",", "yy", ",", "zz"}], "}"}], ",", 
    "\n", 
    RowBox[{
     RowBox[{"modesdata", "=", 
      RowBox[{"OptionValue", "[", "\"\<ModesData\>\"", "]"}]}], ";", "\n", 
     RowBox[{"modesfile", "=", 
      RowBox[{"OptionValue", "[", "\"\<ModesFile\>\"", "]"}]}], ";", "\n", 
     RowBox[{"spinweight", "=", 
      RowBox[{"OptionValue", "[", "\"\<SpinWeight\>\"", "]"}]}], ";", "\n", 
     RowBox[{"counterrotating", "=", 
      RowBox[{"OptionValue", "[", "\"\<CounterRotating\>\"", "]"}]}], ";", 
     "\n", 
     RowBox[{"intws", "=", 
      RowBox[{
      "OptionValue", "[", "\"\<Interpolate\[Omega]\[Tau]\>\"", "]"}]}], ";", 
     "\n", 
     RowBox[{"maxspin", " ", "=", 
      RowBox[{"OptionValue", "[", "\"\<MaxSpin\>\"", "]"}]}], ";", "\n", 
     RowBox[{"data89", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<N89Data\>\"", "]"}]}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{"intws", ",", "\n", 
       RowBox[{
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"l", "\[Equal]", "2"}], " ", "&&", " ", 
           RowBox[{"m", "\[Equal]", "2"}], " ", "&&", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"n", "\[Equal]", "8"}], "||", 
             RowBox[{"n", "==", "9"}]}], ")"}]}], ",", "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{"counterrotating", ",", "\n", 
             RowBox[{
              RowBox[{"\[Omega]s", "=", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"TakeColumn", "[", 
                  RowBox[{"data89", ",", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "]"}]}], "/.", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"xx_", ",", "yy_", ",", "zz_"}], "}"}], "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"xx", ",", 
                   RowBox[{"yy", "+", 
                    RowBox[{"I", " ", "zz"}]}]}], " ", "}"}]}]}]}], ";"}], 
             ",", "\n", 
             RowBox[{
              RowBox[{"\[Omega]s", "=", 
               RowBox[{
                RowBox[{"TakeColumn", "[", 
                 RowBox[{"data89", ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "]"}], "/.", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"xx_", ",", "yy_", ",", "zz_"}], "}"}], "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"xx", ",", 
                   RowBox[{"yy", "+", 
                    RowBox[{"I", " ", "zz"}]}]}], " ", "}"}]}]}]}], ";"}]}], 
            "\n", "]"}], ";"}], "\n", ",", 
          RowBox[{
           RowBox[{"l", "\[Equal]", "2"}], " ", "&&", " ", 
           RowBox[{"m", "\[Equal]", "2"}], " ", "&&", 
           RowBox[{"(", 
            RowBox[{"n", ">", "9"}], ")"}]}], " ", ",", "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{"counterrotating", ",", "\n", 
             RowBox[{
              RowBox[{"\[Omega]s", "=", 
               RowBox[{"-", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"a", ",", 
                    RowBox[{"ExternalEvaluate", "[", 
                    RowBox[{"Global`session", ",", " ", 
                    RowBox[{"\"\<omegas=[];grav_220=qnm.modes_cache(s=\>\"", "<>", 
                    RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
                    "\"\<,l=\>\"", "<>", 
                    RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<,m=\>\"", 
                    "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"-", "m"}], "]"}], "<>", "\"\<,n=\>\"", " ", "<>",
                     " ", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"n", "-", "1"}], "]"}], " ", "<>", " ", 
                    "\"\<);(grav_220(a=\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"DecimalForm", "[", "a", "]"}], "]"}], "<>", 
                    "\"\<))[0]\>\""}]}], "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"a", ",", "0", ",", "0.99", ",", "0.01"}], "}"}]}],
                  "]"}]}]}], ";"}], ",", "\n", 
             RowBox[{
              RowBox[{"\[Omega]s", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"a", ",", 
                   RowBox[{"ExternalEvaluate", "[", 
                    RowBox[{"Global`session", ",", " ", 
                    RowBox[{"\"\<omegas=[];grav_220=qnm.modes_cache(s=\>\"", "<>", 
                    RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
                    "\"\<,l=\>\"", "<>", 
                    RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<,m=\>\"", 
                    "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"Abs", "@", "m"}], "]"}], "<>", "\"\<,n=\>\"", 
                    " ", "<>", " ", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"n", "-", "1"}], "]"}], " ", "<>", " ", 
                    "\"\<);(grav_220(a=\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"DecimalForm", "[", "a", "]"}], "]"}], "<>", 
                    "\"\<))[0]\>\""}]}], "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"a", ",", "0", ",", "0.99", ",", "0.01"}], "}"}]}], 
                "]"}]}], ";"}]}], "\n", "]"}], ";"}], "\n", ",", "True", ",", 
          "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{"counterrotating", ",", "\n", 
             RowBox[{
              RowBox[{"\[Omega]s", "=", 
               RowBox[{"-", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"a", ",", 
                    RowBox[{"ExternalEvaluate", "[", 
                    RowBox[{"Global`session", ",", " ", 
                    RowBox[{"\"\<omegas=[];grav_220=qnm.modes_cache(s=\>\"", "<>", 
                    RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
                    "\"\<,l=\>\"", "<>", 
                    RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<,m=\>\"", 
                    "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"-", "m"}], "]"}], "<>", "\"\<,n=\>\"", " ", "<>",
                     " ", 
                    RowBox[{"ToString", "[", "n", "]"}], " ", "<>", " ", 
                    "\"\<);(grav_220(a=\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"DecimalForm", "[", "a", "]"}], "]"}], "<>", 
                    "\"\<))[0]\>\""}]}], "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"a", ",", "0", ",", "0.99", ",", "0.01"}], "}"}]}],
                  "]"}]}]}], ";"}], ",", "\n", 
             RowBox[{
              RowBox[{"\[Omega]s", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"a", ",", 
                   RowBox[{"ExternalEvaluate", "[", 
                    RowBox[{"Global`session", ",", " ", 
                    RowBox[{"\"\<omegas=[];grav_220=qnm.modes_cache(s=\>\"", "<>", 
                    RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
                    "\"\<,l=\>\"", "<>", 
                    RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<,m=\>\"", 
                    "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"Abs", "@", "m"}], "]"}], "<>", "\"\<,n=\>\"", 
                    " ", "<>", " ", 
                    RowBox[{"ToString", "[", "n", "]"}], " ", "<>", " ", 
                    "\"\<);(grav_220(a=\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"DecimalForm", "[", "a", "]"}], "]"}], "<>", 
                    "\"\<))[0]\>\""}]}], "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"a", ",", "0", ",", "0.99", ",", "0.01"}], "}"}]}], 
                "]"}]}], ";"}]}], "\n", "]"}], ";"}]}], "\n", "]"}], ";", 
        "\n", 
        RowBox[{"\[Omega]1", "=", 
         RowBox[{"Re", "@", "\[Omega]s"}]}], ";", "\n", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"m", "<", "0"}], ",", 
          RowBox[{
           RowBox[{"\[Omega]1", "=", 
            RowBox[{"Re", "@", 
             RowBox[{"(", 
              RowBox[{"\[Omega]s", "/.", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"xx_", ",", "yy_"}], "}"}], "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"xx", ",", 
                  RowBox[{"-", "yy"}]}], "}"}]}]}], ")"}]}]}], ";"}], ",", 
          RowBox[{
           RowBox[{"\[Omega]1", "=", 
            RowBox[{"Re", "@", "\[Omega]s"}]}], ";"}]}], "]"}], ";", "\n", 
        RowBox[{"Quiet", "[", 
         RowBox[{"\[Tau]1", "=", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Omega]s", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"-", "1"}], "/", 
              RowBox[{"Im", "@", 
               RowBox[{"\[Omega]s", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}]}], "}"}], 
           "]"}]}], "]"}], ";", "\n", "\n", 
        RowBox[{"\[Omega]", "=", 
         RowBox[{"Interpolation", "@", "\[Omega]1"}]}], ";", "\n", 
        RowBox[{"\[Tau]", "=", 
         RowBox[{"Interpolation", "@", "\[Tau]1"}]}], ";"}], "\n", ",", "\n", 
       
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"af", " ", "==", " ", "0"}], " ", "&&", " ", 
            RowBox[{"m", " ", "\[Equal]", " ", "0"}]}], ")"}], ",", " ", "\n", 
          RowBox[{
           RowBox[{"\[Omega]s", "=", " ", 
            RowBox[{"ExternalEvaluate", "[", 
             RowBox[{"Global`session", ",", " ", 
              RowBox[{"\"\<omseq = schw(s=\>\"", "<>", 
               RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
               "\"\<,l=\>\"", "<>", 
               RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<, n_max=\>\"", 
               " ", "<>", " ", 
               RowBox[{"ToString", "[", "n", "]"}], " ", "<>", " ", 
               "\"\<); omseq.find_sequence(); (omseq.omega)[-1]\>\""}]}], 
             "]"}]}], ";", "\n", 
           RowBox[{"\[Omega]", "=", 
            RowBox[{
             RowBox[{"Re", "[", "\[Omega]s", "]"}], "/", "Mf"}]}], ";", "\n", 
           
           RowBox[{"\[Tau]", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "1"}], "/", 
              RowBox[{"Im", "[", "\[Omega]s", "]"}]}], "*", "Mf"}]}], ";"}], 
          ",", " ", "\n", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{"counterrotating", ",", "\n", 
             RowBox[{"\[Omega]s", "=", 
              RowBox[{"-", 
               RowBox[{"ExternalEvaluate", "[", 
                RowBox[{"Global`session", ",", " ", 
                 RowBox[{"\"\<omegas=[];grav_220=qnm.modes_cache(s=\>\"", "<>", 
                  RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
                  "\"\<,l=\>\"", "<>", 
                  RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<,m=\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"-", "m"}], "]"}], "<>", "\"\<,n=\>\"", " ", "<>", 
                  " ", 
                  RowBox[{"ToString", "[", "n", "]"}], " ", "<>", " ", 
                  "\"\<);(grav_220(a=\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"DecimalForm", "[", "af", "]"}], "]"}], "<>", 
                  "\"\<))[0]\>\""}]}], "]"}]}]}], ",", "\n", 
             RowBox[{
              RowBox[{"\[Omega]s", "=", 
               RowBox[{"ExternalEvaluate", "[", 
                RowBox[{"Global`session", ",", " ", 
                 RowBox[{"\"\<omegas=[];grav_220=qnm.modes_cache(s=\>\"", "<>", 
                  RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
                  "\"\<,l=\>\"", "<>", 
                  RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<,m=\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"Abs", "@", "m"}], "]"}], "<>", "\"\<,n=\>\"", " ",
                   "<>", " ", 
                  RowBox[{"ToString", "[", "n", "]"}], " ", "<>", " ", 
                  "\"\<);(grav_220(a=\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"DecimalForm", "[", "af", "]"}], "]"}], "<>", 
                  "\"\<))[0]\>\""}]}], "]"}]}], ";"}]}], "]"}], ";", "\n", 
           RowBox[{"\[Omega]", "=", 
            RowBox[{
             RowBox[{"Re", "[", "\[Omega]s", "]"}], "/", "Mf"}]}], ";", "\n", 
           
           RowBox[{"\[Tau]", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "1"}], "/", 
              RowBox[{"Im", "[", "\[Omega]s", "]"}]}], "*", "Mf"}]}], ";", 
           "\n", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"m", "<", "0"}], ",", 
             RowBox[{"\[Omega]", "=", 
              RowBox[{"-", "\[Omega]"}]}]}], "]"}], ";"}], "\n", ",", "\n", 
          RowBox[{
           RowBox[{"\[Omega]", "=", 
            RowBox[{
             RowBox[{"Re", "[", "\[Omega]s", "]"}], "/", "Mf"}]}], ";", "\n", 
           
           RowBox[{"\[Tau]", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "1"}], "/", 
              RowBox[{"Im", "[", "\[Omega]s", "]"}]}], "*", "Mf"}]}], ";", 
           "\n", 
           RowBox[{"If", "[", 
            RowBox[{"counterrotating", ",", "\n", 
             RowBox[{"\[Omega]s", "=", 
              RowBox[{"-", 
               RowBox[{"ExternalEvaluate", "[", 
                RowBox[{"Global`session", ",", " ", 
                 RowBox[{"\"\<omegas=[];grav_220=qnm.modes_cache(s=\>\"", "<>", 
                  RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
                  "\"\<,l=\>\"", "<>", 
                  RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<,m=\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"-", "m"}], "]"}], "<>", "\"\<,n=\>\"", " ", "<>", 
                  " ", 
                  RowBox[{"ToString", "[", "n", "]"}], " ", "<>", " ", 
                  "\"\<);(grav_220(a=\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"DecimalForm", "[", "af", "]"}], "]"}], "<>", 
                  "\"\<))[0]\>\""}]}], "]"}]}]}], ",", "\n", 
             RowBox[{
              RowBox[{"\[Omega]s", "=", 
               RowBox[{"ExternalEvaluate", "[", 
                RowBox[{"Global`session", ",", " ", 
                 RowBox[{"\"\<omegas=[];grav_220=qnm.modes_cache(s=\>\"", "<>", 
                  RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
                  "\"\<,l=\>\"", "<>", 
                  RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<,m=\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"Abs", "@", "m"}], "]"}], "<>", "\"\<,n=\>\"", " ",
                   "<>", " ", 
                  RowBox[{"ToString", "[", "n", "]"}], " ", "<>", " ", 
                  "\"\<);(grav_220(a=\>\"", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"DecimalForm", "[", "af", "]"}], "]"}], "<>", 
                  "\"\<))[0]\>\""}]}], "]"}]}], ";"}]}], "]"}], ";", "\n", 
           RowBox[{"\[Omega]", "=", 
            RowBox[{
             RowBox[{"Re", "[", "\[Omega]s", "]"}], "/", "Mf"}]}], ";", "\n", 
           
           RowBox[{"\[Tau]", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "1"}], "/", 
              RowBox[{"Im", "[", "\[Omega]s", "]"}]}], "*", "Mf"}]}], ";", 
           "\n", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"m", "<", "0"}], ",", 
             RowBox[{"\[Omega]", "=", 
              RowBox[{"-", "\[Omega]"}]}]}], "]"}], ";"}]}], "\n", "]"}], 
        ";"}]}], "\n", "]"}], ";", "\n", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"l", "\[Equal]", "2"}], " ", "&&", " ", 
        RowBox[{"m", "\[Equal]", "2"}], " ", "&&", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"n", "\[Equal]", "8"}], "||", 
          RowBox[{"n", "==", "9"}]}], ")"}], "&&", 
        RowBox[{"Not", "[", "intws", "]"}]}], ",", "\n", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{"counterrotating", ",", "\n", 
          RowBox[{
           RowBox[{"\[Omega]s", "=", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"TakeColumn", "[", 
               RowBox[{"data89", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "]"}]}], "/.", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"xx_", ",", "yy_", ",", "zz_"}], "}"}], "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"xx", ",", 
                RowBox[{"yy", "+", 
                 RowBox[{"I", " ", "zz"}]}]}], " ", "}"}]}]}]}], ";"}], ",", 
          "\n", 
          RowBox[{
           RowBox[{"\[Omega]s", "=", 
            RowBox[{
             RowBox[{"TakeColumn", "[", 
              RowBox[{"data89", ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "]"}], "/.", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"xx_", ",", "yy_", ",", "zz_"}], "}"}], "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"xx", ",", 
                RowBox[{"yy", "+", " ", 
                 RowBox[{"I", " ", "zz"}]}]}], " ", "}"}]}]}]}], ";"}]}], 
         "\n", "]"}], ";", "\n", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"m", "<", "0"}], ",", 
          RowBox[{
           RowBox[{"\[Omega]1", "=", 
            RowBox[{"Re", "@", 
             RowBox[{"(", 
              RowBox[{"\[Omega]s", "/.", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"xx_", ",", "yy_"}], "}"}], "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"xx", ",", 
                  RowBox[{"-", "yy"}]}], "}"}]}]}], ")"}]}]}], ";"}], ",", 
          RowBox[{
           RowBox[{"\[Omega]1", "=", 
            RowBox[{"Re", "@", "\[Omega]s"}]}], ";"}]}], "]"}], ";", "\n", 
        RowBox[{"Quiet", "[", 
         RowBox[{"\[Tau]1", "=", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\[Omega]s", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"-", "1"}], "/", 
              RowBox[{"Im", "@", 
               RowBox[{"\[Omega]s", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}]}], "}"}], 
           "]"}]}], "]"}], ";", "\n", 
        RowBox[{"\[Omega]", "=", 
         RowBox[{"Interpolation", "@", "\[Omega]1"}]}], ";", "\n", 
        RowBox[{"\[Tau]", "=", 
         RowBox[{"Interpolation", "@", "\[Tau]1"}]}], ";", "\n", "\n", 
        RowBox[{"\[Omega]", "=", 
         RowBox[{
          RowBox[{"Re", "[", 
           RowBox[{"\[Omega]", "[", "af", "]"}], "]"}], "/", "Mf"}]}], ";", 
        "\n", 
        RowBox[{"\[Tau]", "=", 
         RowBox[{
          RowBox[{"\[Tau]", "[", "af", "]"}], "*", "Mf"}]}], ";"}], "\n", ",", 
       RowBox[{
        RowBox[{"l", "\[Equal]", "2"}], " ", "&&", " ", 
        RowBox[{"m", "\[Equal]", "2"}], " ", "&&", 
        RowBox[{"(", 
         RowBox[{"n", ">", "9"}], ")"}], "&&", 
        RowBox[{"Not", "[", "intws", "]"}]}], ",", "\n", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{"counterrotating", ",", "\n", 
          RowBox[{"\[Omega]s", "=", 
           RowBox[{"-", 
            RowBox[{"ExternalEvaluate", "[", 
             RowBox[{"Global`session", ",", " ", 
              RowBox[{"\"\<omegas=[];grav_220=qnm.modes_cache(s=\>\"", "<>", 
               RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
               "\"\<,l=\>\"", "<>", 
               RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<,m=\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"-", "m"}], "]"}], "<>", "\"\<,n=\>\"", " ", "<>", 
               " ", 
               RowBox[{"ToString", "[", 
                RowBox[{"n", "-", "1"}], "]"}], " ", "<>", " ", 
               "\"\<);(grav_220(a=\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"DecimalForm", "[", "af", "]"}], "]"}], "<>", 
               "\"\<))[0]\>\""}]}], "]"}]}]}], ",", "\n", 
          RowBox[{
           RowBox[{"\[Omega]s", "=", 
            RowBox[{"ExternalEvaluate", "[", 
             RowBox[{"Global`session", ",", " ", 
              RowBox[{"\"\<omegas=[];grav_220=qnm.modes_cache(s=\>\"", "<>", 
               RowBox[{"ToString", "[", "spinweight", "]"}], "<>", 
               "\"\<,l=\>\"", "<>", 
               RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<,m=\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"Abs", "@", "m"}], "]"}], "<>", "\"\<,n=\>\"", " ", "<>",
                " ", 
               RowBox[{"ToString", "[", 
                RowBox[{"n", "-", "1"}], "]"}], " ", "<>", " ", 
               "\"\<);(grav_220(a=\>\"", "<>", 
               RowBox[{"ToString", "[", 
                RowBox[{"DecimalForm", "[", "af", "]"}], "]"}], "<>", 
               "\"\<))[0]\>\""}]}], "]"}]}], ";"}]}], "]"}], ";", "\n", 
        RowBox[{"\[Omega]", "=", 
         RowBox[{
          RowBox[{"Re", "[", "\[Omega]s", "]"}], "/", "Mf"}]}], ";", "\n", 
        RowBox[{"\[Tau]", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"-", "1"}], "/", 
           RowBox[{"Im", "[", "\[Omega]s", "]"}]}], "*", "Mf"}]}], ";", "\n", 
        
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"m", "<", "0"}], ",", 
          RowBox[{"\[Omega]", "=", 
           RowBox[{"-", "\[Omega]"}]}]}], "]"}], ";"}]}], "\n", "]"}], ";", 
     "\n", 
     RowBox[{"{", 
      RowBox[{"\[Omega]", ",", "\[Tau]"}], "}"}]}]}], "\n", "]"}]}]}], "Code",\

 CellChangeTimes->{{3.7721985476927853`*^9, 3.772198575765624*^9}, {
   3.772198793153981*^9, 3.772198830047464*^9}, {3.7721988895906897`*^9, 
   3.772199562802928*^9}, {3.772199638377646*^9, 3.772200017819154*^9}, {
   3.77771649354319*^9, 3.777716502162915*^9}, {3.777716564048128*^9, 
   3.77771656695885*^9}, {3.7785552708514757`*^9, 3.778555308462579*^9}, {
   3.7785553469471817`*^9, 3.778555403730047*^9}, {3.7785577387693987`*^9, 
   3.778557738901156*^9}, {3.799113284272087*^9, 3.799113285169816*^9}, {
   3.799115766792492*^9, 3.7991157670850153`*^9}, {3.7991164547215643`*^9, 
   3.799116586199287*^9}, {3.799116618186366*^9, 3.7991166756249866`*^9}, {
   3.79911685538968*^9, 3.799116880268477*^9}, 3.799121006420978*^9, {
   3.7991210836378813`*^9, 3.799121172549109*^9}, {3.7991212170706882`*^9, 
   3.799121217898446*^9}, {3.7991213008580313`*^9, 3.7991213613184977`*^9}, {
   3.8012858331477957`*^9, 3.8012858942144833`*^9}, 3.801285933534213*^9, {
   3.801738063916472*^9, 3.801738066379343*^9}, {3.801738110405074*^9, 
   3.80173811392542*^9}, {3.801738336628878*^9, 3.801738363048201*^9}, {
   3.8017408609367323`*^9, 3.801740945225803*^9}, {3.80174105057705*^9, 
   3.801741076061083*^9}, {3.801741126897922*^9, 3.801741273530115*^9}, {
   3.801741315062377*^9, 3.8017414294414797`*^9}, {3.801741466421402*^9, 
   3.801741484312387*^9}, {3.8057817921735153`*^9, 3.805781793075128*^9}, {
   3.805787185274016*^9, 3.80578718831527*^9}, {3.8057873394494257`*^9, 
   3.805787395431929*^9}, {3.8057874570453978`*^9, 3.80578745718603*^9}, {
   3.805787504770913*^9, 3.805787576032873*^9}, {3.805787610746808*^9, 
   3.805787709868672*^9}, {3.805787752086793*^9, 3.805787907079916*^9}, {
   3.8057880704123774`*^9, 3.80578812568118*^9}, {3.8057888474049387`*^9, 
   3.805788864281674*^9}, {3.805808141904963*^9, 3.805808144532445*^9}, {
   3.807269362622817*^9, 3.8072693695192213`*^9}, {3.8076101962040863`*^9, 
   3.8076102530112467`*^9}, {3.8076102836277437`*^9, 3.807610294628788*^9}, 
   3.807610409070907*^9, {3.8076118958272877`*^9, 3.8076119085609627`*^9}, {
   3.8076119682256107`*^9, 3.8076119731931334`*^9}, {3.8076205608866577`*^9, 
   3.807620590030169*^9}, {3.8076227704859247`*^9, 3.807622792726449*^9}, 
   3.807622868327201*^9, 3.812792971095189*^9, {3.8251457954603567`*^9, 
   3.825145822434918*^9}, {3.825145866218637*^9, 3.8251459138853292`*^9}, {
   3.825145963805216*^9, 3.82514612489629*^9}, {3.8251463182328043`*^9, 
   3.825146365248868*^9}, {3.8251464016136627`*^9, 3.825146414786209*^9}, {
   3.825164237554667*^9, 3.825164303266779*^9}, {3.8251643520654173`*^9, 
   3.8251644106901293`*^9}, {3.825164452393202*^9, 3.8251644592531776`*^9}, {
   3.825164493988896*^9, 3.825164521006723*^9}, {3.8253991144629307`*^9, 
   3.8253991429614162`*^9}, {3.825488008540894*^9, 3.8254880269245653`*^9}, {
   3.826274637114016*^9, 3.8262746495462933`*^9}, {3.826275232518265*^9, 
   3.826275234822509*^9}, {3.8262752657229233`*^9, 3.8262752765046053`*^9}, {
   3.826275345808275*^9, 3.8262754621423073`*^9}, {3.8262755091100693`*^9, 
   3.8262755096098537`*^9}, {3.8262755940885153`*^9, 3.826275602494207*^9}, {
   3.826275643360239*^9, 3.826275645374886*^9}, {3.826279546377286*^9, 
   3.826279588556786*^9}, {3.826279666206327*^9, 3.8262796965574293`*^9}, {
   3.826279790640626*^9, 3.8262798112779303`*^9}, {3.8267174399132223`*^9, 
   3.826717441544058*^9}, {3.826717504256446*^9, 3.8267175050077057`*^9}, {
   3.826717554941762*^9, 3.826717618448763*^9}, 3.827916352804648*^9, {
   3.8279166355684566`*^9, 3.8279166766559896`*^9}, {3.827916871391241*^9, 
   3.827916912068321*^9}, {3.8279169704399567`*^9, 3.8279170307769737`*^9}, {
   3.827917091016588*^9, 3.827917091839818*^9}, {3.82791719495063*^9, 
   3.827917293434423*^9}, 3.8279173567461147`*^9, 3.827917387477265*^9, {
   3.827917896469718*^9, 3.8279179455224257`*^9}, {3.827918035990488*^9, 
   3.827918044954225*^9}, {3.827918131197743*^9, 3.827918261175373*^9}, {
   3.827918315913725*^9, 3.8279183342714357`*^9}, {3.827918884528664*^9, 
   3.827918912364951*^9}, {3.827918982454156*^9, 3.827919059252576*^9}, {
   3.8279722628144827`*^9, 3.827972276130714*^9}, {3.827972311184196*^9, 
   3.8279723811186447`*^9}, {3.827972440498128*^9, 3.8279724934474897`*^9}, {
   3.827972535621395*^9, 3.827972542596922*^9}, {3.827972577459166*^9, 
   3.827972588890802*^9}, {3.827972692844452*^9, 3.827972694088538*^9}, {
   3.827972756822345*^9, 3.827972782505722*^9}, {3.827972910307316*^9, 
   3.827972921459334*^9}, {3.828094326792308*^9, 3.828094403992508*^9}, {
   3.828094495415501*^9, 3.828094534488357*^9}, {3.8280945779644947`*^9, 
   3.82809462340055*^9}, {3.828695248964986*^9, 3.828695275098816*^9}, {
   3.828695378266561*^9, 3.8286953845621843`*^9}, {3.828695632602577*^9, 
   3.828695633902964*^9}, {3.828696181092964*^9, 3.828696186057761*^9}, {
   3.8286963680332823`*^9, 3.828696398129478*^9}, {3.828696453965086*^9, 
   3.8286965566827497`*^9}, {3.828696646099187*^9, 3.828696697607842*^9}, {
   3.8286969495661983`*^9, 3.82869698040196*^9}},
 CellLabel->
  "In[422]:=",ExpressionUUID->"92ed1598-7cbd-49f8-9f2d-8d923833e10d"]
}, Closed]],

Cell[CellGroupData[{

Cell["Final mass final spin", "Subsection",
 CellChangeTimes->{{3.717145410089053*^9, 3.71714541312827*^9}, {
   3.7172172325438833`*^9, 3.71721723694738*^9}, 3.717232740150098*^9, {
   3.719561185753558*^9, 3.71956118876759*^9}, {3.762579157516369*^9, 
   3.7625791630033073`*^9}, {3.762579322938787*^9, 3.7625793374944468`*^9}, {
   3.785052757811619*^9, 3.785052758228941*^9}, {3.799119235050438*^9, 
   3.799119273795376*^9}},ExpressionUUID->"4969b6f9-be82-4f3e-abc6-\
45d648828266"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EradUIB2017", "[", 
   RowBox[{"\[Eta]_", ",", "\[Chi]1_", ",", "\[Chi]2_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m1", ",", "m2", ",", "S"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"m1", "=", 
      RowBox[{
       RowBox[{"1", "/", "2"}], " ", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "-", 
           RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}]}]}], ";", "\n", 
     RowBox[{"m2", "=", 
      RowBox[{
       RowBox[{"1", "/", "2"}], " ", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "-", 
           RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}]}]}], ";", "\n", 
     "\n", 
     RowBox[{"S", "=", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"m1", "^", "2"}], " ", "\[Chi]1"}], " ", "+", " ", 
         RowBox[{
          RowBox[{"m2", "^", "2"}], " ", "\[Chi]2"}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m1", "^", "2"}], " ", "+", " ", 
         RowBox[{"m2", "^", "2"}]}], ")"}]}]}], ";", "\n", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "-", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"2", " ", 
                 RowBox[{"Sqrt", "[", "2", "]"}]}], ")"}], "/", "3"}]}], 
             ")"}], " ", "\[Eta]"}], "+", 
           RowBox[{"0.5609904135313374`", " ", 
            RowBox[{"\[Eta]", "^", "2"}]}], "-", 
           RowBox[{"0.84667563764404`", " ", 
            RowBox[{"\[Eta]", "^", "3"}]}], "+", 
           RowBox[{"3.145145224278187`", " ", 
            RowBox[{"\[Eta]", "^", "4"}]}]}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{
            RowBox[{"S", "^", "3"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "0.6320191645391563`"}], "+", " ", 
              RowBox[{"4.952698546796005`", " ", "\[Eta]"}], "-", 
              RowBox[{"10.023747993978121`", " ", 
               RowBox[{"\[Eta]", "^", "2"}]}]}], ")"}]}], "+", 
           RowBox[{
            RowBox[{"S", "^", "2"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "0.17762802148331427`"}], "+", " ", 
              RowBox[{"2.176667900182948`", " ", 
               RowBox[{"\[Eta]", "^", "2"}]}]}], ")"}]}], "+", 
           RowBox[{"S", " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "0.13084389181783257`"}], "-", " ", 
              RowBox[{"1.1387311580238488`", " ", "\[Eta]"}], "+", 
              RowBox[{"5.49074464410971`", " ", 
               RowBox[{"\[Eta]", "^", "2"}]}]}], ")"}]}]}], ")"}]}], ")"}], 
       "/", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"S", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "0.9919475346968611`"}], "+", " ", 
            RowBox[{"0.367620218664352`", " ", "\[Eta]"}], "+", 
            RowBox[{"4.274567337924067`", " ", 
             RowBox[{"\[Eta]", "^", "2"}]}]}], ")"}]}]}], ")"}]}], "\n", "-", 
      
      RowBox[{"0.01978238971523653`", " ", "S", " ", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"4.91667749015812`", " ", "\[Eta]"}]}], ")"}], " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"4", " ", "\[Eta]"}]}], ")"}], "^", "0.5`"}], " ", "\[Eta]",
        " ", 
       RowBox[{"(", 
        RowBox[{"\[Chi]1", "-", "\[Chi]2"}], ")"}]}], "-", 
      RowBox[{"0.09803730445895877`", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"4", " ", "\[Eta]"}]}], ")"}], "^", "0.5`"}], " ", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"3.2283713377939134`", " ", "\[Eta]"}]}], ")"}], " ", 
       RowBox[{"\[Eta]", "^", "2"}], " ", 
       RowBox[{"(", 
        RowBox[{"\[Chi]1", "-", "\[Chi]2"}], ")"}]}], "+", 
      RowBox[{"0.01118530335431078`", " ", 
       RowBox[{"\[Eta]", "^", "3"}], " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Chi]1", "-", "\[Chi]2"}], ")"}], "^", "2"}]}]}]}]}], 
   "]"}]}]], "Code",
 CellLabel->"In[78]:=",ExpressionUUID->"eda9a3bd-b2dd-4fe8-9fcb-bd728e8a287d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FinalSpinUIB2017", "[", 
   RowBox[{"\[Eta]_", ",", "\[Chi]1_", ",", "\[Chi]2_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m1", ",", "m2", ",", "S"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"m1", "=", 
      RowBox[{
       RowBox[{"1", "/", "2"}], " ", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "-", 
           RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}]}]}], ";", "\n", 
     RowBox[{"m2", "=", 
      RowBox[{
       RowBox[{"1", "/", "2"}], " ", 
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"1", "-", 
           RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}]}]}], ";", "\n", 
     "\n", 
     RowBox[{"S", "=", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"m1", "^", "2"}], " ", "\[Chi]1"}], " ", "+", " ", 
         RowBox[{
          RowBox[{"m2", "^", "2"}], " ", "\[Chi]2"}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m1", "^", "2"}], " ", "+", " ", 
         RowBox[{"m2", "^", "2"}]}], ")"}]}]}], ";", "\n", "\n", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"m1", "^", "2"}], " ", "\[Chi]1"}], " ", "+", " ", 
        RowBox[{
         RowBox[{"m2", "^", "2"}], " ", "\[Chi]2"}]}], ")"}], " ", "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", " ", 
          RowBox[{"Sqrt", "[", "3", "]"}], " ", "\[Eta]"}], "+", 
         RowBox[{"20.0830030082033`", " ", 
          RowBox[{"\[Eta]", "^", "2"}]}], "-", 
         RowBox[{"12.333573402277912`", " ", 
          RowBox[{"\[Eta]", "^", "3"}]}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"7.2388440419467335`", " ", "\[Eta]"}]}], ")"}]}], "+", "\n",
       " ", 
      RowBox[{"0.3223660562764661`", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"4", " ", "\[Eta]"}]}], ")"}], "^", "0.5`"}], " ", 
       RowBox[{"\[Eta]", "^", "2"}], " ", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"9.332575956437443`", " ", "\[Eta]"}]}], ")"}], " ", 
       RowBox[{"(", 
        RowBox[{"\[Chi]1", "-", "\[Chi]2"}], ")"}]}], "-", 
      RowBox[{"0.059808322561702126`", " ", 
       RowBox[{"\[Eta]", "^", "3"}], " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Chi]1", "-", "\[Chi]2"}], ")"}], "^", "2"}]}], "+", "\n", 
      
      RowBox[{
       RowBox[{"(", 
        RowBox[{"2.3170397514509933`", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", 
            RowBox[{"4", " ", "\[Eta]"}]}], ")"}], "^", "0.5`"}], " ", 
         RowBox[{"(", 
          RowBox[{"1", "-", 
           RowBox[{"3.2624649875884852`", " ", "\[Eta]"}]}], ")"}], " ", 
         RowBox[{"\[Eta]", "^", "3"}], " ", 
         RowBox[{"(", 
          RowBox[{"\[Chi]1", "-", "\[Chi]2"}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"1", "/", "4"}], " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "+", 
               RowBox[{"Sqrt", "[", 
                RowBox[{"1", "-", 
                 RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", "2"}], 
            " ", "\[Chi]1"}], "+", 
           RowBox[{
            RowBox[{"1", "/", "4"}], " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"Sqrt", "[", 
                RowBox[{"1", "-", 
                 RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", "2"}], 
            " ", "\[Chi]2"}]}], ")"}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"1", "/", "4"}], " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"1", "-", 
               RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", "2"}]}], 
         "+", 
         RowBox[{
          RowBox[{"1", "/", "4"}], " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"1", "-", 
               RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", "2"}]}]}],
         ")"}]}], "+", "\n", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"0.`", " ", "-", 
              RowBox[{"0.8561951310209386`", " ", "\[Eta]"}], "-", 
              RowBox[{"0.09939065676370885`", " ", 
               RowBox[{"\[Eta]", "^", "2"}]}], "+", 
              RowBox[{"1.668810429851045`", " ", 
               RowBox[{"\[Eta]", "^", "3"}]}]}], ")"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"1", "/", "4"}], " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"Sqrt", "[", 
                   RowBox[{"1", "-", 
                    RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
                "2"}], " ", "\[Chi]1"}], "+", 
              RowBox[{
               RowBox[{"1", "/", "4"}], " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{"Sqrt", "[", 
                   RowBox[{"1", "-", 
                    RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
                "2"}], " ", "\[Chi]2"}]}], ")"}]}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"1", "/", "4"}], " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"1", "-", 
                  RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
              "2"}]}], "+", 
            RowBox[{
             RowBox[{"1", "/", "4"}], " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "+", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"1", "-", 
                  RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
              "2"}]}]}], ")"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"0.`", " ", "+", 
              RowBox[{"0.5881660363307388`", " ", "\[Eta]"}], "-", 
              RowBox[{"2.149269067519131`", " ", 
               RowBox[{"\[Eta]", "^", "2"}]}], "+", 
              RowBox[{"3.4768263932898678`", " ", 
               RowBox[{"\[Eta]", "^", "3"}]}]}], ")"}], " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"1", "/", "4"}], " ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "+", 
                   RowBox[{"Sqrt", "[", 
                    RowBox[{"1", "-", 
                    RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
                 "2"}], " ", "\[Chi]1"}], "+", 
               RowBox[{
                RowBox[{"1", "/", "4"}], " ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "-", 
                   RowBox[{"Sqrt", "[", 
                    RowBox[{"1", "-", 
                    RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
                 "2"}], " ", "\[Chi]2"}]}], ")"}], "^", "2"}]}], ")"}], "/", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"1", "/", "4"}], " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "-", 
                 RowBox[{"Sqrt", "[", 
                  RowBox[{"1", "-", 
                   RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
               "2"}]}], "+", 
             RowBox[{
              RowBox[{"1", "/", "4"}], " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "+", 
                 RowBox[{"Sqrt", "[", 
                  RowBox[{"1", "-", 
                   RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
               "2"}]}]}], ")"}], "^", "2"}]}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"0.`", " ", "+", 
              RowBox[{"0.142443244743048`", " ", "\[Eta]"}], "-", 
              RowBox[{"0.9598353840147513`", " ", 
               RowBox[{"\[Eta]", "^", "2"}]}], "+", 
              RowBox[{"1.9595643107593743`", " ", 
               RowBox[{"\[Eta]", "^", "3"}]}]}], ")"}], " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"1", "/", "4"}], " ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "+", 
                   RowBox[{"Sqrt", "[", 
                    RowBox[{"1", "-", 
                    RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
                 "2"}], " ", "\[Chi]1"}], "+", 
               RowBox[{
                RowBox[{"1", "/", "4"}], " ", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "-", 
                   RowBox[{"Sqrt", "[", 
                    RowBox[{"1", "-", 
                    RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
                 "2"}], " ", "\[Chi]2"}]}], ")"}], "^", "3"}]}], ")"}], "/", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"1", "/", "4"}], " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "-", 
                 RowBox[{"Sqrt", "[", 
                  RowBox[{"1", "-", 
                   RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
               "2"}]}], "+", 
             RowBox[{
              RowBox[{"1", "/", "4"}], " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "+", 
                 RowBox[{"Sqrt", "[", 
                  RowBox[{"1", "-", 
                   RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
               "2"}]}]}], ")"}], "^", "3"}]}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "0.9142232693081653`"}], "+", " ", 
              RowBox[{"2.3191363426522633`", " ", "\[Eta]"}], "-", 
              RowBox[{"9.710576749140989`", " ", 
               RowBox[{"\[Eta]", "^", "3"}]}]}], ")"}], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"1", "/", "4"}], " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"Sqrt", "[", 
                   RowBox[{"1", "-", 
                    RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
                "2"}], " ", "\[Chi]1"}], "+", 
              RowBox[{
               RowBox[{"1", "/", "4"}], " ", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{"Sqrt", "[", 
                   RowBox[{"1", "-", 
                    RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
                "2"}], " ", "\[Chi]2"}]}], ")"}]}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"1", "/", "4"}], " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "-", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"1", "-", 
                  RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
              "2"}]}], "+", 
            RowBox[{
             RowBox[{"1", "/", "4"}], " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"1", "+", 
                RowBox[{"Sqrt", "[", 
                 RowBox[{"1", "-", 
                  RowBox[{"4", " ", "\[Eta]"}]}], "]"}]}], ")"}], "^", 
              "2"}]}]}], ")"}]}]}], ")"}]}]}]}]}], "]"}]}]], "Code",
 CellLabel->"In[79]:=",ExpressionUUID->"7c11673b-6e54-49ee-822b-64e19a8a50a6"]
}, Closed]],

Cell[CellGroupData[{

Cell["Spherical harmonics Yslm", "Subsection",
 CellChangeTimes->{{3.720858744971012*^9, 3.720858745401064*^9}, {
  3.7625786687006273`*^9, 
  3.762578677729886*^9}},ExpressionUUID->"150df7a9-0598-4dbe-b33a-\
3a640381122d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SphericalHarmonic", "[", 
   RowBox[{"s_", ",", "l_", ",", "m_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", ",", "Global`\[Theta]", ",", "Global`\[Phi]"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"res", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"-", "1"}], ")"}], "^", "i"}], "  ", 
         RowBox[{
          RowBox[{"Sqrt", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"l", "+", "m"}], ")"}], "!"}], " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"l", "-", "m"}], ")"}], "!"}], " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"l", "-", "s"}], ")"}], "!"}], " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"l", "+", "s"}], ")"}], "!"}]}], "]"}], " ", "/", " ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"l", "+", "m", "-", "i"}], ")"}], "!"}], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"l", "+", "s", "-", "i"}], ")"}], "!"}], 
            RowBox[{"i", "!"}], 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"i", "-", "s", "-", "m"}], ")"}], "!"}]}], ")"}]}], 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{"Global`\[Theta]", "/", "2"}], "]"}], "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", "l"}], "+", "m", "+", "s", "-", 
            RowBox[{"2", "i"}]}], ")"}]}], 
         RowBox[{
          RowBox[{"Sin", "[", 
           RowBox[{"Global`\[Theta]", "/", "2"}], "]"}], "^", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", "i"}], "-", "s", "-", "m"}], ")"}]}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Max", "[", 
           RowBox[{"0", ",", 
            RowBox[{"m", "+", "s"}]}], "]"}], ",", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{"l", "+", "m"}], ",", 
            RowBox[{"l", "+", "s"}]}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{"FullSimplify", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"-", "1"}], ")"}], "^", 
         RowBox[{"(", 
          RowBox[{"-", "s"}], ")"}]}], "  ", 
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"2", "l"}], "+", "1"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"4", "Pi"}], ")"}]}], "]"}], " ", "res", " ", 
        RowBox[{"E", "^", 
         RowBox[{"(", 
          RowBox[{"I", " ", "m", " ", "Global`\[Phi]"}], ")"}]}]}], "]"}]}], 
     ";", "\n", "\[IndentingNewLine]", "res"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.826274114821046*^9, 3.826274184006966*^9}, {
  3.8262742580560226`*^9, 3.826274318060251*^9}, {3.8262744382901087`*^9, 
  3.826274458452737*^9}, {3.8262745270445023`*^9, 
  3.8262745272977953`*^9}},ExpressionUUID->"2877951a-c369-4327-8c85-\
f23d758101fd"]
}, Closed]],

Cell[CellGroupData[{

Cell["Overtone Fit Functions", "Subsection",
 CellChangeTimes->{{3.719736912552854*^9, 3.719736913643588*^9}, {
  3.720334511498179*^9, 3.720334540714099*^9}, {3.7625796137552156`*^9, 
  3.762579627380604*^9}},ExpressionUUID->"ef40d02e-f487-40e1-b6da-\
592e7b6c3f02"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "DetectConvergence", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<Test\>\"", "\[Rule]", "FindMaximum"}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"DetectConvergence", "[", 
   RowBox[{"res_", ",", "\[Tau]_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "intres", ",", "mins", ",", "tmax", ",", "t", ",", "fits", ",", "a", ",",
       "tol", ",", "tt", ",", "yy", ",", "test"}], "}"}], ",", 
    "\[IndentingNewLine]", "\n", 
    RowBox[{
     RowBox[{"test", "=", 
      RowBox[{"OptionValue", "[", "\"\<Test\>\"", "]"}]}], ";", "\n", "\n", 
     RowBox[{"tmax", "=", " ", 
      RowBox[{"4", " ", "*", " ", "\[Tau]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"intres", "=", 
      RowBox[{"Interpolation", "@", "res"}]}], ";", "\n", 
     RowBox[{"mins", "=", 
      RowBox[{"Quiet", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"test", "[", 
           RowBox[{
            RowBox[{"intres", "@", "t"}], ",", 
            RowBox[{"{", 
             RowBox[{"t", ",", "i"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{
             RowBox[{"res", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", "5"}], ",", 
            RowBox[{
             RowBox[{"res", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", "5", " ", "+", 
             "tmax"}], ",", "10"}], "}"}]}], "]"}], "/.", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"yy_", ",", "tt_"}], "}"}], "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"t", "/.", "tt"}], ",", "yy"}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mins", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"mins", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], "<", 
          RowBox[{"#", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "<", 
          RowBox[{"res", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
      ";", "\n", 
     RowBox[{"SortBy", "[", 
      RowBox[{"mins", ",", "First"}], "]"}]}]}], "\n", "]"}]}]}], "Code",
 CellChangeTimes->{{3.720494067863076*^9, 3.720494208843604*^9}, {
   3.720494258516584*^9, 3.720494375002429*^9}, {3.720494525712131*^9, 
   3.72049452659192*^9}, {3.720494651968155*^9, 3.720494864315839*^9}, {
   3.7204949018671427`*^9, 3.7204949244598627`*^9}, {3.7204949958859386`*^9, 
   3.720495006018746*^9}, {3.720495050507967*^9, 3.720495050706203*^9}, {
   3.720495121489184*^9, 3.720495121665111*^9}, {3.720495190623155*^9, 
   3.720495191655134*^9}, {3.720495248928876*^9, 3.720495305263709*^9}, {
   3.7204953535754137`*^9, 3.7204953576205893`*^9}, {3.720495494637003*^9, 
   3.720495505404582*^9}, {3.720496198433455*^9, 3.720496205712208*^9}, {
   3.720496379919685*^9, 3.720496407690078*^9}, {3.76259463168292*^9, 
   3.762594632250791*^9}, {3.799120477600918*^9, 3.799120501971664*^9}, 
   3.800088857280878*^9},
 CellLabel->"In[88]:=",ExpressionUUID->"cb69a25b-ca49-41e1-ac39-61c32a4d9fb6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "OvertoneModel", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Options", "[", "\[Omega]lmn", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmn"}], ",", 
       RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"\"\<Fit\[Tau]\>\"", "\[Rule]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"\"\<AmpPhaseShift\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<CounterRotating\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<Mode\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], ",", 
       RowBox[{"\"\<Vary\[Omega]\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<AnsatzReal\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<Mixing\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"False", ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<AmpPhase\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<QualityFactor\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<\[Omega]val\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "0.05"}], ",", "0.05"}], "}"}]}], ",", 
       RowBox[{"\"\<Export_\[Omega]val\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<FitMassSpin\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<xLabel\>\"", "\[Rule]", "\"\<Default\>\""}], ",", 
       RowBox[{"\"\<yLabel\>\"", "\[Rule]", "\"\<Default\>\""}], ",", 
       RowBox[{"\"\<Tones\>\"", "\[Rule]", 
        RowBox[{"{", "}"}]}]}], "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"OvertoneModel", "[", 
   RowBox[{"overtones_", ",", "pars_", ",", "ti_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "af", ",", "Global`a", ",", "ansatz", ",", "ansatzreal", ",", 
      "ampansatz", ",", "amphase", ",", "amphaseshift", ",", 
      "counterrotating", ",", "data89", ",", "ex\[Omega]val", ",", 
      "fitmassspin", ",", "fit\[Alpha]", ",", "fit\[Tau]", ",", "im", ",", 
      "imm", ",", "intws", ",", "l", ",", "m", ",", "maxspin", ",", "Mfv", 
      ",", "Global`M", ",", "lm", ",", "modesdata", ",", "modesfile", ",", 
      "mm", ",", "mixing", ",", "mode", ",", "modto0", ",", "parvals", ",", 
      "phaseansatz", ",", "qfact", ",", "qfactm", ",", "qualfactorQ", ",", 
      "re", ",", "reim", ",", "rem", ",", "spinweight", ",", "tones", ",", 
      "Global`t", ",", "var", ",", "variablemass", ",", "varmassint", ",", 
      "vary\[Omega]", ",", "x", ",", "xlabel", ",", "xcoeffstr", ",", 
      "ycoeffstr", ",", "y", ",", "ylabel", ",", "\[Tau]s", ",", "\[Tau]sm", 
      ",", "\[Alpha]", ",", "\[Beta]", ",", "\[Omega]lmnfunction", ",", 
      "\[Omega]m", ",", "\[Omega]s", ",", "\[Omega]m\[Tau]sm", ",", "\[Eta]", 
      ",", "\[Chi]1", ",", "\[Chi]2", ",", "mixmode", ",", "\[Omega]val"}], 
     "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"fit\[Alpha]", "=", 
      RowBox[{"OptionValue", "[", "\"\<Fit\[Alpha]\>\"", "]"}]}], ";", "\n", 
     RowBox[{"fit\[Tau]", "=", 
      RowBox[{"OptionValue", "[", "\"\<Fit\[Tau]\>\"", "]"}]}], ";", "\n", 
     RowBox[{"mode", "=", 
      RowBox[{"OptionValue", "[", "\"\<Mode\>\"", "]"}]}], ";", "\n", 
     RowBox[{"vary\[Omega]", "=", 
      RowBox[{"OptionValue", "[", "\"\<Vary\[Omega]\>\"", "]"}]}], ";", "\n", 
     
     RowBox[{"mixing", "=", 
      RowBox[{"OptionValue", "[", "\"\<Mixing\>\"", "]"}]}], ";", "\n", 
     RowBox[{"reim", "=", 
      RowBox[{"OptionValue", "[", "\"\<ReIm\>\"", "]"}]}], ";", "\n", 
     RowBox[{"amphase", "=", 
      RowBox[{"OptionValue", "[", "\"\<AmpPhase\>\"", "]"}]}], ";", "\n", 
     RowBox[{"\[Omega]val", "=", 
      RowBox[{"OptionValue", "[", "\"\<\[Omega]val\>\"", "]"}]}], ";", "\n", 
     RowBox[{"ex\[Omega]val", "=", 
      RowBox[{"OptionValue", "[", "\"\<Export_\[Omega]val\>\"", "]"}]}], ";", 
     "\n", 
     RowBox[{"modesdata", "=", 
      RowBox[{"OptionValue", "[", "\"\<ModesData\>\"", "]"}]}], ";", "\n", 
     RowBox[{"modesfile", "=", 
      RowBox[{"OptionValue", "[", "\"\<ModesFile\>\"", "]"}]}], ";", "\n", 
     RowBox[{"ansatzreal", "=", 
      RowBox[{"OptionValue", "[", "\"\<AnsatzReal\>\"", "]"}]}], ";", "\n", 
     RowBox[{"qualfactorQ", "=", 
      RowBox[{"OptionValue", "[", "\"\<QualityFactor\>\"", "]"}]}], ";", "\n", 
     RowBox[{"spinweight", "=", 
      RowBox[{"OptionValue", "[", "\"\<SpinWeight\>\"", "]"}]}], ";", "\n", 
     RowBox[{"\[Omega]lmnfunction", "=", 
      RowBox[{"OptionValue", "[", "\"\<\[Omega]lmnFunction\>\"", "]"}]}], ";",
      "\n", 
     RowBox[{"amphaseshift", "=", 
      RowBox[{"OptionValue", "[", "\"\<AmpPhaseShift\>\"", "]"}]}], ";", "\n", 
     RowBox[{"counterrotating", "=", 
      RowBox[{"OptionValue", "[", "\"\<CounterRotating\>\"", "]"}]}], ";", 
     "\n", 
     RowBox[{"fitmassspin", "=", 
      RowBox[{"OptionValue", "[", "\"\<FitMassSpin\>\"", "]"}]}], ";", "\n", 
     RowBox[{"intws", "=", 
      RowBox[{
      "OptionValue", "[", "\"\<Interpolate\[Omega]\[Tau]\>\"", "]"}]}], ";", 
     "\n", 
     RowBox[{"maxspin", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<MaxSpin\>\"", "]"}]}], ";", "\n", 
     RowBox[{"xlabel", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<xLabel\>\"", "]"}]}], ";", "\n", 
     RowBox[{"ylabel", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<yLabel\>\"", "]"}]}], ";", "\n", 
     RowBox[{"tones", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<Tones\>\"", "]"}]}], ";", "\n", 
     RowBox[{"data89", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "\"\<N89Data\>\"", "]"}]}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "tones"}], "\[Equal]", "0"}], ",", 
       RowBox[{"tones", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"n", ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}]}], 
      "]"}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"xlabel", "\[Equal]", "\"\<Default\>\""}], ",", 
       RowBox[{"xcoeffstr", "=", "\"\<x\>\""}], ",", 
       RowBox[{"xcoeffstr", "=", "xlabel"}]}], "]"}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ylabel", "\[Equal]", "\"\<Default\>\""}], ",", 
       RowBox[{"ycoeffstr", "=", "\"\<y\>\""}], ",", 
       RowBox[{"ycoeffstr", "=", "ylabel"}]}], "]"}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", "intws"}], ",", 
       RowBox[{"Global`M", "=", "1"}]}], "]"}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Not", "@", "intws"}], " ", "&&", " ", 
        RowBox[{"\[Omega]lmnfunction", "\[NotEqual]", "\[Omega]lmnPy"}]}], 
       ",", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<If Interpolate\[Omega]\[Tau]->True, then you must set \
\[Omega]lmnfunction==\[Omega]lmnPy\>\"", "]"}], ";", " ", 
        RowBox[{"Return", "[", 
         RowBox[{"{", "}"}], "]"}]}]}], "]"}], ";", "\n", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"lm", ",", "mm"}], "}"}], "=", 
      RowBox[{"mixing", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"l", "=", 
      RowBox[{"mode", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"m", "=", 
      RowBox[{"mode", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Mfv", ",", "af"}], "}"}], "=", "pars"}], ";", "\n", "\n", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Freqs", "."}], " ", "&"}], " ", "damping", " ", "times"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "modesdata"}], "\[Equal]", "0"}], ",", "\n", 
       "\t", 
       RowBox[{
        RowBox[{"\[Omega]s", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Omega]lmnfunction", "[", 
             RowBox[{"l", ",", "m", ",", "n", ",", "Mfv", ",", "af", ",", 
              RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", "spinweight"}], ",", 
              RowBox[{"\"\<Interpolate\[Omega]\[Tau]\>\"", "->", "intws"}], 
              ",", 
              RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "maxspin"}], ",", 
              RowBox[{"\"\<CounterRotating\>\"", "->", "counterrotating"}], 
              ",", 
              RowBox[{"\"\<N89Data\>\"", "->", "data89"}], ",", 
              RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}]}], "]"}], "[", 
            
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "tones"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"var", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "overtones"}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"If", "[", 
         RowBox[{"vary\[Omega]", ",", 
          RowBox[{"\[Omega]s", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"n", ">", "0"}], ",", 
                RowBox[{
                 RowBox[{"var", "[", 
                  RowBox[{"[", 
                   RowBox[{"n", "+", "1"}], "]"}], "]"}], "=", 
                 RowBox[{"RandomReal", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"1", "+", 
                    RowBox[{"\[Omega]val", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"1", "+", 
                    RowBox[{"\[Omega]val", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{"var", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "=", "1"}]}], "]"}], ";", 
              RowBox[{
               RowBox[{"var", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "+", "1"}], "]"}], "]"}], "*", 
               RowBox[{
                RowBox[{"\[Omega]lmnfunction", "[", 
                 RowBox[{
                 "l", ",", "m", ",", "n", ",", "Mfv", ",", "af", ",", 
                  RowBox[{"\"\<ModesData\>\"", "->", 
                   RowBox[{"modesdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}]}], ",", 
                  RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", "spinweight"}], 
                  ",", 
                  RowBox[{
                  "\"\<Interpolate\[Omega]\[Tau]\>\"", "->", "intws"}], ",", 
                  RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "maxspin"}], ",", 
                  RowBox[{
                  "\"\<CounterRotating\>\"", "->", "counterrotating"}], ",", 
                  RowBox[{"\"\<N89Data\>\"", "->", "data89"}], ",", 
                  RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}]}], "]"}], 
                "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
             RowBox[{"{", 
              RowBox[{"n", ",", "tones"}], "}"}]}], "]"}]}]}], "]"}], ";", 
        "\n", "\t", 
        RowBox[{"\[Tau]s", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Omega]lmnfunction", "[", 
             RowBox[{"l", ",", "m", ",", "n", ",", "Mfv", ",", "af", ",", 
              RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", "spinweight"}], ",", 
              RowBox[{"\"\<Interpolate\[Omega]\[Tau]\>\"", "->", "intws"}], 
              ",", " ", 
              RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "maxspin"}], ",", 
              RowBox[{"\"\<CounterRotating\>\"", "->", "counterrotating"}], 
              ",", 
              RowBox[{"\"\<N89Data\>\"", "->", "data89"}], ",", 
              RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}]}], "]"}], "[", 
            
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "tones"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"qfact", "=", 
         RowBox[{"\[Omega]s", "*", "\[Tau]s"}]}], ";"}], "\n", "\t", ",", 
       "\n", "\t", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Omega]s", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Omega]lmnfunction", "[", 
              RowBox[{"l", ",", "m", ",", "n", ",", "Mfv", ",", "af", ",", 
               RowBox[{"\"\<ModesData\>\"", "->", 
                RowBox[{"modesdata", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", "+", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", "spinweight"}], ",", 
               RowBox[{"\"\<Interpolate\[Omega]\[Tau]\>\"", "->", "intws"}], 
               ",", 
               RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "maxspin"}], ",", 
               RowBox[{"\"\<CounterRotating\>\"", "->", "counterrotating"}], 
               ",", 
               RowBox[{"\"\<N89Data\>\"", "->", "data89"}], ",", 
               RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}]}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "tones"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
         RowBox[{"var", "=", 
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", "overtones"}], "]"}]}], ";", "\n", "\t", 
         RowBox[{"If", "[", 
          RowBox[{"vary\[Omega]", ",", 
           RowBox[{"\[Omega]s", "=", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"n", ">", "0"}], ",", 
                 RowBox[{
                  RowBox[{"var", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], "=", 
                  RowBox[{"RandomReal", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"1", "+", 
                    RowBox[{"\[Omega]val", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"1", "+", 
                    RowBox[{"\[Omega]val", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"var", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "=", "1"}]}], "]"}], ";", 
               RowBox[{
                RowBox[{"var", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", "+", "1"}], "]"}], "]"}], "*", 
                RowBox[{
                 RowBox[{"\[Omega]lmnfunction", "[", 
                  RowBox[{"l", ",", "m", ",", "n", ",", "Mfv", ",", "af", ",", 
                   RowBox[{"\"\<ModesData\>\"", "->", 
                    RowBox[{"modesdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}]}], ",", 
                   RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", "spinweight"}], 
                   ",", 
                   RowBox[{
                   "\"\<Interpolate\[Omega]\[Tau]\>\"", "->", "intws"}], ",", 
                   
                   RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "maxspin"}], ",", 
                   RowBox[{
                   "\"\<CounterRotating\>\"", "->", "counterrotating"}], ",", 
                   
                   RowBox[{"\"\<N89Data\>\"", "->", "data89"}]}], "]"}], "[", 
                 
                 RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "tones"}], "}"}]}], "]"}]}]}], "]"}], ";", 
         "\n", "\t", 
         RowBox[{"\[Tau]s", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Omega]lmnfunction", "[", 
              RowBox[{"l", ",", "m", ",", "n", ",", "Mfv", ",", "af", ",", 
               RowBox[{"\"\<ModesData\>\"", "->", 
                RowBox[{"modesdata", "[", 
                 RowBox[{"[", 
                  RowBox[{"n", "+", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", "spinweight"}], ",", 
               RowBox[{"\"\<Interpolate\[Omega]\[Tau]\>\"", "->", "intws"}], 
               ",", 
               RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "maxspin"}], ",", 
               RowBox[{"\"\<CounterRotating\>\"", "->", "counterrotating"}], 
               ",", 
               RowBox[{"\"\<N89Data\>\"", "->", "data89"}], ",", 
               RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}]}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "tones"}], "}"}]}], "]"}]}], ";", "\n", "\t", 
         RowBox[{"qfact", "=", 
          RowBox[{"\[Omega]s", "*", "\[Tau]s"}]}], ";"}], ";"}]}], "\t", "\n",
       "\t", "]"}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{"ansatzreal", ",", "\n", "\n", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{"intws", ",", "\n", 
          RowBox[{
           RowBox[{"ansatz", "=", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"x", "=", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"xcoeffstr", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
               " ", 
               RowBox[{"x", " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                  RowBox[{"(", 
                   RowBox[{"1", "/", 
                    RowBox[{"(", 
                    RowBox[{"Global`M", "*", 
                    RowBox[{"\[Tau]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}], ")"}]}], "]"}], " ", 
                RowBox[{"(", 
                 RowBox[{"Cos", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "[", "Global`a", "]"}], 
                    "/", "Global`M"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "+", 
                   RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Phi]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], "]"}], 
                 ")"}]}]}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", 
                RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
           ";"}], "\n", ",", "\n", 
          RowBox[{
           RowBox[{"ansatz", "=", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"x", "=", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"xcoeffstr", "<>", 
                  RowBox[{"ToString", "[", 
                   RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
               " ", 
               RowBox[{"x", " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                  RowBox[{"(", 
                   RowBox[{"1", "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Tau]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}], ")"}]}], "]"}], " ", 
                RowBox[{"(", 
                 RowBox[{"Cos", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "+", 
                   RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Phi]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], "]"}], 
                 ")"}]}]}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", 
                RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
           ";"}]}], "\n", "]"}], ";", "\n", 
        RowBox[{"modto0", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "tones"}], "}"}]}], "]"}], ",", 
           "fit\[Alpha]"}], "]"}]}], ";", "\n", 
        RowBox[{"modto0", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"ToExpression", "[", 
            RowBox[{"\"\<\[Alpha]\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"modto0", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}]}], ";", "\n", 
        RowBox[{"ansatz", "=", 
         RowBox[{"ansatz", "/.", 
          RowBox[{"(", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"modto0", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "->", "0"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}], ")"}]}]}],
         ";", "\n", "\n", 
        RowBox[{"modto0", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "tones"}], "}"}]}], "]"}], ",", "fit\[Tau]"}],
           "]"}]}], ";", "\n", 
        RowBox[{"modto0", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"ToExpression", "[", 
            RowBox[{"\"\<\[Beta]\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"modto0", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}]}], ";", "\n", 
        RowBox[{"ansatz", "=", 
         RowBox[{"ansatz", "/.", 
          RowBox[{"(", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"modto0", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "->", "0"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}], ")"}]}]}],
         ";", "\n", 
        RowBox[{"Return", "[", 
         RowBox[{"If", "[", 
          RowBox[{"ex\[Omega]val", ",", 
           RowBox[{"{", 
            RowBox[{"ansatz", ",", "var"}], "}"}], ",", "ansatz"}], "]"}], 
         "]"}], ";"}], "\n", ",", "\t", "\n", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"Not", "@", "amphase"}], ",", "\n", "    ", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{"qualfactorQ", ",", "\n", "    ", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{"intws", ",", "\n", "\t", 
                RowBox[{
                 RowBox[{"ansatz", "=", 
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "@", "reim"}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], ")"}], "]"}], 
                    "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"ycoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], ")"}], 
                    "]"}]}]}]}]}], "]"}], ";", " ", 
                    RowBox[{"x", " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "[", "Global`a", "]"}], 
                    "/", "Global`M"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfact", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}]}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "[", "Global`a", "]"}], 
                    "/", "Global`M"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "[", "Global`a", "]"}], 
                    "/", "Global`M"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", 
                    ")"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", 
                    RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
                 ";"}], "\n", "\t", ",", "\n", "\t", 
                RowBox[{"ansatz", "=", 
                 RowBox[{"Sum", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "@", "reim"}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], ")"}], "]"}], 
                    "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"ycoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], ")"}], 
                    "]"}]}]}]}]}], "]"}], ";", " ", 
                    RowBox[{"x", " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfact", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}]}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", 
                    ")"}]}]}], ",", 
                   RowBox[{"{", 
                    RowBox[{"n", ",", 
                    RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], 
                  "]"}]}]}], "]"}], ";", "\n", "\t\t", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"mixing", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
                RowBox[{
                 RowBox[{"\[Omega]m\[Tau]sm", "=", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"\[Omega]lmnfunction", "[", 
                    RowBox[{
                    "lm", ",", "mm", ",", "n", ",", "Mfv", ",", "af", ",", 
                    RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
                    RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", "spinweight"}], 
                    ",", 
                    RowBox[{
                    "\"\<Interpolate\[Omega]\[Tau]\>\"", "->", "intws"}], ",", 
                    RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "maxspin"}], ",", 
                    RowBox[{
                    "\"\<CounterRotating\>\"", "->", "counterrotating"}], ",", 
                    RowBox[{"\"\<N89Data\>\"", "->", "data89"}], ",", 
                    RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}]}], "]"}],
                     ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "tones"}], "}"}]}], "]"}]}], ";", "\n", 
                 "\t\t", 
                 RowBox[{"\[Omega]m", "=", 
                  RowBox[{
                   RowBox[{"\[Omega]m\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "/", 
                   "Global`M"}]}], ";", "\n", "\t\t", 
                 RowBox[{"\[Tau]sm", "=", 
                  RowBox[{
                   RowBox[{"\[Omega]m\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "*", 
                   "Global`M"}]}], ";", "\n", "\t\t", 
                 RowBox[{"qfactm", "=", 
                  RowBox[{"\[Omega]m", "*", "\[Tau]sm"}]}], ";", "\n", "\t\t", 
                 RowBox[{"ansatz", "=", 
                  RowBox[{"ansatz", "+", 
                   RowBox[{"Sum", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "@", "reim"}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<xm\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<xm\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<ym\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}]}]}]}], 
                    "]"}], ";", 
                    RowBox[{"x", " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "/", "Global`M"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfactm", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}]}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "/", "Global`M"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", 
                    ")"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", 
                    RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], 
                    "]"}]}]}]}]}], "]"}], ";"}], "\n", "\t", ",", "\n", "\t", 
             
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"Not", "@", "intws"}], ",", "\n", "\t", 
                RowBox[{
                 RowBox[{"ansatz", "=", 
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "@", "reim"}], ",", 
                    RowBox[{
                    RowBox[{"x", "=", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ";"}], 
                    ",", 
                    RowBox[{"x", "=", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], ")"}], "]"}], 
                    "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"ycoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], ")"}], 
                    "]"}]}]}]}]}], "]"}], ";", " ", 
                    RowBox[{"x", " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{"1", "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Tau]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", 
                    ")"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", 
                    RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
                 ";"}], "\n", "\t", ",", "\n", "\t", 
                RowBox[{
                 RowBox[{"ansatz", "=", 
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "@", "reim"}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], ")"}], "]"}], 
                    "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"ycoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], ")"}], 
                    "]"}]}]}]}]}], "]"}], ";", " ", 
                    RowBox[{"x", " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{"1", "/", 
                    RowBox[{"(", 
                    RowBox[{"Global`M", "*", 
                    RowBox[{
                    RowBox[{"\[Tau]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "[", "Global`a", "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "[", "Global`a", "]"}], 
                    "/", "Global`M"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "[", "Global`a", "]"}], 
                    "/", "Global`M"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", 
                    ")"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", 
                    RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
                 ";"}]}], "]"}], ";", "\n", "\t\t", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"mixing", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
                RowBox[{
                 RowBox[{"\[Omega]m\[Tau]sm", "=", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"\[Omega]lmnfunction", "[", 
                    RowBox[{
                    "lm", ",", "mm", ",", "n", ",", "Mfv", ",", "af", ",", 
                    RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
                    RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", "spinweight"}], 
                    ",", 
                    RowBox[{
                    "\"\<Interpolate\[Omega]\[Tau]\>\"", "->", "intws"}], ",", 
                    RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "maxspin"}], ",", 
                    RowBox[{
                    "\"\<CounterRotating\>\"", "->", "counterrotating"}], ",", 
                    RowBox[{"\"\<N89Data\>\"", "->", "data89"}], ",", 
                    RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}]}], "]"}],
                     ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "tones"}], "}"}]}], "]"}]}], ";", "\n", 
                 "\t\t", 
                 RowBox[{"\[Omega]m", "=", 
                  RowBox[{
                   RowBox[{"\[Omega]m\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "/", 
                   "Global`M"}]}], ";", "\n", "\t\t", 
                 RowBox[{"\[Tau]sm", "=", 
                  RowBox[{
                   RowBox[{"\[Omega]m\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "*", 
                   "Global`M"}]}], ";", "\n", "\t\t", 
                 RowBox[{"ansatz", "=", 
                  RowBox[{"ansatz", "+", 
                   RowBox[{"Sum", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "@", "reim"}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<xm\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<xm\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<ym\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}]}]}]}], 
                    "]"}], ";", 
                    RowBox[{"x", " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Tau]sm", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", 
                    ")"}]}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", 
                    RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], 
                    "]"}]}]}]}]}], "]"}], ";"}]}], "\t", "\n", "\t", "]"}], 
           ";"}], "\n", "\t", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{"qualfactorQ", ",", "\n", "\t", 
             RowBox[{
              RowBox[{"re", "=", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}], " ", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfact", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}]}], ")"}]}], "]"}], 
                  RowBox[{"Cos", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Phi]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}],
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", 
                   RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
              ";", "\n", "\t", 
              RowBox[{"im", "=", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}], " ", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfact", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}]}], ")"}]}], "]"}], 
                  RowBox[{"Sin", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Phi]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}],
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", 
                   RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
              ";", "\n", "\n", "\t\t", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"mixing", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t\t", 
                RowBox[{
                 RowBox[{"\[Omega]m\[Tau]sm", "=", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"\[Omega]lmnfunction", "[", 
                    RowBox[{
                    "lm", ",", "mm", ",", "n", ",", "Mfv", ",", "af", ",", 
                    RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
                    RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", "spinweight"}], 
                    ",", 
                    RowBox[{
                    "\"\<Interpolate\[Omega]\[Tau]\>\"", "->", "intws"}], ",", 
                    RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "maxspin"}], ",", 
                    RowBox[{
                    "\"\<CounterRotating\>\"", "->", "counterrotating"}], ",", 
                    RowBox[{"\"\<N89Data\>\"", "->", "data89"}], ",", 
                    RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}]}], "]"}],
                     ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "tones"}], "}"}]}], "]"}]}], ";", "\n", 
                 "\t\t\t", 
                 RowBox[{"\[Omega]m", "=", 
                  RowBox[{
                   RowBox[{"\[Omega]m\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "/", 
                   "Global`M"}]}], ";", "\n", "\t\t\t", 
                 RowBox[{"\[Tau]sm", "=", 
                  RowBox[{
                   RowBox[{"\[Omega]m\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "*", 
                   "Global`M"}]}], ";", "\n", "\t\t\t", 
                 RowBox[{"qfactm", "=", 
                  RowBox[{"\[Omega]m", "*", "\[Tau]sm"}]}], ";", "\n", 
                 "\t\t\t", 
                 RowBox[{"rem", "=", 
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}], " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "/", "Global`M"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfactm", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}]}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", ")"}]}],
                     ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", 
                    RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
                 ";", "\n", "\t\t\t", 
                 RowBox[{"imm", "=", 
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}], " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "/", "Global`M"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfactm", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}]}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", ")"}]}],
                     ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", 
                    RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
                 ";"}], "\n", "\t\t\t", ",", "\n", "\t\t\t", 
                RowBox[{
                 RowBox[{"rem", "=", "0"}], ";", "\n", "\t\t\t", 
                 RowBox[{"imm", "=", "0"}], ";"}]}], "\n", "\t\t\t", "]"}], 
              ";"}], "\n", "\t", ",", "\n", "\t", 
             RowBox[{
              RowBox[{"re", "=", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}], " ", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"Global`M", "*", 
                    RowBox[{"\[Tau]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}], "]"}], 
                  RowBox[{"Cos", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "/", "Global`M"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Phi]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}],
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", 
                   RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
              ";", "\n", "\t", 
              RowBox[{"im", "=", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}], " ", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"Global`M", "*", 
                    RowBox[{"\[Tau]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}]}],
                     ")"}]}], "]"}], 
                  RowBox[{"Sin", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "/", "Global`M"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Phi]\>\"", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}]}], "]"}]}],
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", 
                   RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
              ";", "\n", "\n", "\t\t", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"mixing", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t\t", 
                RowBox[{
                 RowBox[{"\[Omega]m\[Tau]sm", "=", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"\[Omega]lmnfunction", "[", 
                    RowBox[{
                    "lm", ",", "mm", ",", "n", ",", "Mfv", ",", "af", ",", 
                    RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
                    RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", "spinweight"}], 
                    ",", 
                    RowBox[{
                    "\"\<Interpolate\[Omega]\[Tau]\>\"", "->", "intws"}], ",", 
                    RowBox[{"\"\<MaxSpin\>\"", "\[Rule]", "maxspin"}], ",", 
                    RowBox[{
                    "\"\<CounterRotating\>\"", "->", "counterrotating"}], ",", 
                    RowBox[{"\"\<N89Data\>\"", "->", "data89"}], ",", 
                    RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}]}], "]"}],
                     ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "tones"}], "}"}]}], "]"}]}], ";", "\n", 
                 "\t\t\t", 
                 RowBox[{"\[Omega]m", "=", 
                  RowBox[{
                   RowBox[{"\[Omega]m\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "/", 
                   "Global`M"}]}], ";", "\n", "\t\t\t", 
                 RowBox[{"\[Tau]sm", "=", 
                  RowBox[{
                   RowBox[{"\[Omega]m\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "*", 
                   "Global`M"}]}], ";", "\n", "\t\t\t", 
                 RowBox[{"rem", "=", 
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}], " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Tau]sm", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", ")"}]}],
                     ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", 
                    RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
                 ";", "\n", "\t\t\t", 
                 RowBox[{"imm", "=", 
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", 
                    RowBox[{"tones", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], "]"}]}], "]"}], " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Tau]sm", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", ")"}]}],
                     ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", 
                    RowBox[{"Length", "@", "\[Omega]s"}]}], "}"}]}], "]"}]}], 
                 ";"}], "\n", "\t\t\t", ",", "\n", "\t\t\t", 
                RowBox[{
                 RowBox[{"rem", "=", "0"}], ";", "\n", "\t\t\t", 
                 RowBox[{"imm", "=", "0"}], ";"}]}], "\n", "\t\t\t", "]"}], 
              ";"}]}], "\n", "      ", "]"}], ";", "\n", 
           RowBox[{"ampansatz", "=", 
            RowBox[{"Sqrt", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"re", "+", "rem"}], ")"}], "^", "2"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"im", "+", "imm"}], ")"}], "^", "2"}]}], "]"}]}], ";",
            "\n", 
           RowBox[{"phaseansatz", "=", 
            RowBox[{"ArcTan", "[", 
             RowBox[{"im", "/", "re"}], "]"}]}], ";", "\n", 
           RowBox[{"ansatz", "=", 
            RowBox[{"{", 
             RowBox[{"ampansatz", ",", "phaseansatz"}], "}"}]}], ";"}]}], 
         "\n", "]"}], ";", "\n", "\n", 
        RowBox[{"modto0", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "tones"}], "}"}]}], "]"}], ",", 
           "fit\[Alpha]"}], "]"}]}], ";", "\n", 
        RowBox[{"modto0", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"ToExpression", "[", 
            RowBox[{"\"\<\[Alpha]\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"modto0", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}]}], ";", "\n", 
        RowBox[{"ansatz", "=", 
         RowBox[{"ansatz", "/.", 
          RowBox[{"(", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"modto0", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "->", "0"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}], ")"}]}]}],
         ";", "\n", "\n", 
        RowBox[{"modto0", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "tones"}], "}"}]}], "]"}], ",", "fit\[Tau]"}],
           "]"}]}], ";", "\n", 
        RowBox[{"modto0", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"ToExpression", "[", 
            RowBox[{"\"\<\[Beta]\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"modto0", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}]}], ";", "\n", 
        RowBox[{"ansatz", "=", 
         RowBox[{"ansatz", "/.", 
          RowBox[{"(", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"modto0", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "->", "0"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}], ")"}]}]}],
         ";"}]}], "\n", "]"}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{"ex\[Omega]val", ",", 
       RowBox[{"{", 
        RowBox[{"ansatz", ",", "var"}], "}"}], ",", "ansatz"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\n"}], "Code",
 CellChangeTimes->{{3.771677386705565*^9, 3.771677432575967*^9}, {
   3.771677478692521*^9, 3.7716776974786987`*^9}, {3.771677749156809*^9, 
   3.771677749245604*^9}, {3.771678368242831*^9, 3.77167855802042*^9}, {
   3.7719072251494093`*^9, 3.771907227456575*^9}, {3.7719072710256453`*^9, 
   3.771907398091879*^9}, {3.771907458458599*^9, 3.771907471104031*^9}, {
   3.771907535295508*^9, 3.771907567230341*^9}, {3.771907597432748*^9, 
   3.771907629986505*^9}, {3.77190871277954*^9, 3.771908761390111*^9}, {
   3.771908813523059*^9, 3.7719089729431467`*^9}, {3.771909004206633*^9, 
   3.77190900469588*^9}, {3.771909058496481*^9, 3.771909075189431*^9}, {
   3.771909162367087*^9, 3.7719093135594387`*^9}, {3.7719093472737703`*^9, 
   3.7719094536444597`*^9}, {3.771909485309827*^9, 3.7719096216321917`*^9}, {
   3.771911525736096*^9, 3.771911555269594*^9}, {3.771911592383946*^9, 
   3.771911650727923*^9}, {3.7719119344490023`*^9, 3.771911934634461*^9}, {
   3.772193444179907*^9, 3.7721934684908667`*^9}, 3.7721935063709593`*^9, {
   3.7721935368526163`*^9, 3.77219366166796*^9}, {3.77219642009752*^9, 
   3.772196501577361*^9}, {3.772196556744199*^9, 3.7721965582919827`*^9}, {
   3.772196623495311*^9, 3.772196703653275*^9}, {3.772196842685261*^9, 
   3.772196859406479*^9}, {3.772196988080412*^9, 3.7721970025950603`*^9}, {
   3.7722478303251*^9, 3.772247831532436*^9}, {3.77658033668747*^9, 
   3.776580348028509*^9}, {3.7765809639728327`*^9, 3.77658097177113*^9}, {
   3.776581457080768*^9, 3.776581475487019*^9}, {3.776581515046463*^9, 
   3.77658160150498*^9}, {3.7765817333625803`*^9, 3.7765817752553797`*^9}, {
   3.7765860616001368`*^9, 3.776586064674204*^9}, {3.776586100742178*^9, 
   3.776586185337967*^9}, {3.776586259954899*^9, 3.776586260329609*^9}, {
   3.776586308985792*^9, 3.776586326416067*^9}, {3.776586370893306*^9, 
   3.7765863790338497`*^9}, {3.7765864409394817`*^9, 3.776586462208321*^9}, {
   3.776586494448669*^9, 3.776586550379714*^9}, {3.776588773375059*^9, 
   3.776588777468933*^9}, {3.778555556406411*^9, 3.778555568824278*^9}, {
   3.778565526517099*^9, 3.778565530554241*^9}, {3.7785655639133472`*^9, 
   3.7785656183907623`*^9}, {3.778565653049898*^9, 3.7785657064928303`*^9}, {
   3.778565785975872*^9, 3.7785657961721077`*^9}, {3.778565857608344*^9, 
   3.778565859731264*^9}, 3.77856591349852*^9, {3.778566191886526*^9, 
   3.778566193930477*^9}, 3.778566246778599*^9, {3.778566363118126*^9, 
   3.77856640048003*^9}, {3.778566501309498*^9, 3.778566501907134*^9}, {
   3.778567075366261*^9, 3.7785670782516212`*^9}, {3.784027275521529*^9, 
   3.7840273848540783`*^9}, {3.784027466674209*^9, 3.7840276726788597`*^9}, {
   3.784027744249055*^9, 3.784027770048777*^9}, {3.784027807926426*^9, 
   3.7840278173359623`*^9}, {3.784027960944667*^9, 3.784028054211288*^9}, {
   3.7840280871565647`*^9, 3.7840281001470327`*^9}, {3.7840344337639017`*^9, 
   3.784034529470811*^9}, {3.784034583373845*^9, 3.784034630941607*^9}, {
   3.784037500320373*^9, 3.78403752221579*^9}, {3.784037556624576*^9, 
   3.784037655409525*^9}, {3.784037695864181*^9, 3.7840377491643267`*^9}, {
   3.784037826395269*^9, 3.784037838389056*^9}, {3.785135168481369*^9, 
   3.785135188672686*^9}, {3.785135370031146*^9, 3.785135632797415*^9}, {
   3.785135704427512*^9, 3.785135709699354*^9}, {3.7851358102358313`*^9, 
   3.785135865344125*^9}, {3.7851360843385277`*^9, 3.7851361456991663`*^9}, {
   3.785136185872944*^9, 3.785136191845982*^9}, {3.785140798343335*^9, 
   3.785140803112817*^9}, {3.785140833533779*^9, 3.785140839360903*^9}, {
   3.7851408796427526`*^9, 3.7851408919338703`*^9}, {3.7851409237996197`*^9, 
   3.785141030146646*^9}, {3.785141183125049*^9, 3.785141196189204*^9}, {
   3.785141236134383*^9, 3.7851412547365723`*^9}, {3.785742317087573*^9, 
   3.7857423818009644`*^9}, {3.788588900081777*^9, 3.788588922583219*^9}, {
   3.788588977524485*^9, 3.78858899232054*^9}, {3.788592700140904*^9, 
   3.788592829761201*^9}, {3.78859288245713*^9, 3.788592886045624*^9}, {
   3.788592986457713*^9, 3.788593032023745*^9}, {3.788593174304693*^9, 
   3.788593193410795*^9}, {3.788593249525272*^9, 3.788593249845934*^9}, {
   3.799117023811561*^9, 3.7991170620045013`*^9}, {3.799117327168158*^9, 
   3.799117328720833*^9}, {3.799117528607526*^9, 3.799117625219865*^9}, {
   3.799117723391061*^9, 3.799117729813736*^9}, {3.799117808069282*^9, 
   3.7991178319953527`*^9}, 3.799117913918251*^9, {3.7991179442970963`*^9, 
   3.799117946897843*^9}, {3.799117988695221*^9, 3.799118002060157*^9}, {
   3.799118164806386*^9, 3.799118171828588*^9}, {3.799121555953467*^9, 
   3.799121605765253*^9}, {3.799121810634165*^9, 3.799121812345255*^9}, {
   3.799121879641095*^9, 3.799121918333335*^9}, {3.799122036271903*^9, 
   3.799122041022492*^9}, {3.800075376244379*^9, 3.80007540453275*^9}, {
   3.800075443434237*^9, 3.800075445045846*^9}, {3.800076115854972*^9, 
   3.800076140880919*^9}, {3.80008068851781*^9, 3.800080746362953*^9}, {
   3.800080780024949*^9, 3.8000808514481983`*^9}, {3.800081341480514*^9, 
   3.8000814602083263`*^9}, {3.800081492076582*^9, 3.800081681089995*^9}, {
   3.800088960496607*^9, 3.80008897437778*^9}, {3.800089225155568*^9, 
   3.800089231743319*^9}, {3.800089309267664*^9, 3.8000893111631317`*^9}, {
   3.8000894233429127`*^9, 3.800089424068041*^9}, {3.800089457010537*^9, 
   3.8000894734082737`*^9}, {3.800089572498385*^9, 3.8000895831367807`*^9}, {
   3.801737957626946*^9, 3.8017379597162943`*^9}, {3.801738012779354*^9, 
   3.80173802464705*^9}, {3.801739109616179*^9, 3.801739221531708*^9}, {
   3.801739285111473*^9, 3.801739285449147*^9}, {3.801740139168417*^9, 
   3.801740144052185*^9}, {3.8017407725520267`*^9, 3.801740775814953*^9}, {
   3.801741595419806*^9, 3.801741597233294*^9}, {3.8017468656624393`*^9, 
   3.80174696744168*^9}, {3.801747025323736*^9, 3.8017470256524277`*^9}, {
   3.8017470985073423`*^9, 3.801747175088347*^9}, {3.8017473785993977`*^9, 
   3.8017474534034758`*^9}, {3.8057835678296623`*^9, 3.805783673927775*^9}, {
   3.8057882499228983`*^9, 3.8057883341224403`*^9}, {3.806229012257544*^9, 
   3.8062290177658453`*^9}, {3.8062291054136*^9, 3.806229106187914*^9}, {
   3.8062292820267353`*^9, 3.806229296404862*^9}, {3.807268512225749*^9, 
   3.807268522600391*^9}, {3.807269213535187*^9, 3.807269226045611*^9}, {
   3.807269429492523*^9, 3.807269431318523*^9}, {3.8088212236914597`*^9, 
   3.8088212391468067`*^9}, {3.808821364825102*^9, 3.80882143586415*^9}, {
   3.808821466219727*^9, 3.8088214819409637`*^9}, {3.808821526448926*^9, 
   3.808821568875683*^9}, {3.8088216179918833`*^9, 3.8088216679578533`*^9}, {
   3.808821701826067*^9, 3.8088217996735563`*^9}, {3.808821830344384*^9, 
   3.808821839211246*^9}, {3.82514555105398*^9, 3.8251456557120523`*^9}, {
   3.825164618447744*^9, 3.825164672613965*^9}, {3.825396833774686*^9, 
   3.825396969710759*^9}, {3.8253970054254436`*^9, 3.825397175205484*^9}, {
   3.8253972177303133`*^9, 3.825397259082369*^9}, {3.82539733122583*^9, 
   3.825397394768714*^9}, {3.825397467631097*^9, 3.8253975088462057`*^9}, {
   3.825397599911996*^9, 3.825397748658153*^9}, {3.825397897565084*^9, 
   3.825397933693077*^9}, {3.8253983068556633`*^9, 3.8253983667572947`*^9}, {
   3.8253984580425386`*^9, 3.825398460100862*^9}, {3.825398491252531*^9, 
   3.825398521178473*^9}, {3.825398570174638*^9, 3.8253987669757633`*^9}, {
   3.8253988161715117`*^9, 3.8253990079489193`*^9}, {3.825399939668594*^9, 
   3.8253999442254133`*^9}, {3.825400042521031*^9, 3.8254000660234613`*^9}, {
   3.825400122999864*^9, 3.8254002367239017`*^9}, {3.825400287174089*^9, 
   3.82540038306242*^9}, {3.825400414144122*^9, 3.825400583973804*^9}, {
   3.825400652177821*^9, 3.825400733988244*^9}, {3.8254008673436832`*^9, 
   3.8254008728413057`*^9}, {3.8254009476728354`*^9, 3.825400954377269*^9}, {
   3.825401002260271*^9, 3.825401035816011*^9}, {3.825401134059845*^9, 
   3.8254011385576563`*^9}, {3.825401185333521*^9, 3.8254012035465527`*^9}, {
   3.825401261666608*^9, 3.825401321983444*^9}, {3.825401365291615*^9, 
   3.825401538699884*^9}, {3.825401675681548*^9, 3.825401677704718*^9}, {
   3.8254017304063473`*^9, 3.825401761078395*^9}, {3.825401813013068*^9, 
   3.8254018411148367`*^9}, 3.825402141392293*^9, {3.825488056956582*^9, 
   3.8254881374540873`*^9}, {3.825557876484934*^9, 3.825557884509549*^9}, {
   3.826259182833888*^9, 3.826259211850363*^9}, {3.826274811453203*^9, 
   3.826274890314649*^9}, {3.826275036799522*^9, 3.826275044466963*^9}, {
   3.8262750969537783`*^9, 3.82627513599759*^9}, {3.826275179293552*^9, 
   3.82627518286042*^9}, {3.826275770827922*^9, 3.826276057470931*^9}, {
   3.826276116200651*^9, 3.8262761183765574`*^9}, {3.826276165002527*^9, 
   3.8262761693408327`*^9}, {3.8262762191917553`*^9, 3.82627622877139*^9}, {
   3.826276280478307*^9, 3.826276356516549*^9}, {3.826276399703397*^9, 
   3.826276444628153*^9}, {3.8262765106584044`*^9, 3.826276615035472*^9}, {
   3.8262766454483356`*^9, 3.826276714334495*^9}, {3.8262770010729933`*^9, 
   3.826277020251913*^9}, {3.8262770723419*^9, 3.826277157075285*^9}, {
   3.8262771989659843`*^9, 3.826277201239201*^9}, 3.826277250798209*^9, {
   3.826869242299477*^9, 3.82686936031199*^9}, {3.8268722733052464`*^9, 
   3.8268726170891123`*^9}, {3.8268731969684563`*^9, 3.826873300863327*^9}, {
   3.826873347415588*^9, 3.826873355119112*^9}, {3.826873467699264*^9, 
   3.826873574123024*^9}, {3.826873610983068*^9, 3.8268737811739388`*^9}, {
   3.826873845179574*^9, 3.826873845367339*^9}, {3.8268739817664747`*^9, 
   3.826873988506385*^9}, {3.826874071477187*^9, 3.826874079868012*^9}, {
   3.826874133392405*^9, 3.826874137449203*^9}, {3.8268743383855143`*^9, 
   3.826874339264557*^9}, {3.8268743779977207`*^9, 3.8268743857990503`*^9}, {
   3.826874443474195*^9, 3.8268744771759853`*^9}, {3.826874509986141*^9, 
   3.8268746060944023`*^9}, {3.826874696526334*^9, 3.8268748972383137`*^9}, {
   3.827973067952162*^9, 3.8279732022447643`*^9}, {3.829977300094715*^9, 
   3.829977319371626*^9}, {3.829977372640213*^9, 
   3.829977432890657*^9}},ExpressionUUID->"497c5c2c-74eb-4562-8f69-\
941dcd0056c7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "OvertoneModelV2", "]"}], "=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Options", "[", "\[Omega]lmn", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\<FixExtra\>\"", "\[Rule]", "True"}], ",", 
       RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"\"\<Fit\[Tau]\>\"", "\[Rule]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"\"\<Mode\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}], ",", 
       RowBox[{"\"\<Vary\[Omega]\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<Mixing\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"False", ",", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}], "}"}]}], ",", 
       RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<AmpPhase\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<AmpPhaseShift\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<QualityFactor\>\"", "\[Rule]", "False"}], ",", 
       RowBox[{"\"\<ParameterValues\>\"", "\[Rule]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"\"\<\[Omega]val\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "0.05"}], ",", "0.05"}], "}"}]}], ",", 
       RowBox[{"\"\<Export_\[Omega]val\>\"", "\[Rule]", "False"}]}], "}"}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"OvertoneModelV2", "[", 
   RowBox[{"overtones_", ",", "pars_", ",", "ti_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ansatz", ",", "ampansatz", ",", "amphase", ",", "amphaseshift", ",", 
      "counterrotating", ",", "ex\[Omega]val", ",", "fixetra", ",", 
      "fit\[Alpha]", ",", "fit\[Tau]", ",", "im", ",", "imm", ",", "l", ",", 
      "m", ",", "lm", ",", "modesdata", ",", "modesfile", ",", "mm", ",", 
      "mixing", ",", "mode", ",", "modto0", ",", "parvals", ",", 
      "phaseansatz", ",", "qfact", ",", "qfactm", ",", "qualfactorQ", ",", 
      "re", ",", "reim", ",", "rem", ",", "Global`t", ",", "var", ",", 
      "vary\[Omega]", ",", "x", ",", "xcoeffstr", ",", "y", ",", "ycoeffstr", 
      ",", "\[Tau]s", ",", "\[Tau]sm", ",", "\[Alpha]", ",", "\[Beta]", ",", 
      "\[Omega]m", ",", "\[Omega]s", ",", "\[Omega]m\[Tau]sm", ",", "\[Eta]", 
      ",", "\[Chi]1", ",", "\[Chi]2", ",", "mixmode", ",", "\[Omega]val"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"fixetra", "=", 
      RowBox[{"OptionValue", "[", "\"\<FixExtra\>\"", "]"}]}], ";", "\n", 
     RowBox[{"fit\[Alpha]", "=", 
      RowBox[{"OptionValue", "[", "\"\<Fit\[Alpha]\>\"", "]"}]}], ";", "\n", 
     RowBox[{"fit\[Tau]", "=", 
      RowBox[{"OptionValue", "[", "\"\<Fit\[Tau]\>\"", "]"}]}], ";", "\n", 
     RowBox[{"mode", "=", 
      RowBox[{"OptionValue", "[", "\"\<Mode\>\"", "]"}]}], ";", "\n", 
     RowBox[{"vary\[Omega]", "=", 
      RowBox[{"OptionValue", "[", "\"\<Vary\[Omega]\>\"", "]"}]}], ";", "\n", 
     
     RowBox[{"mixing", "=", 
      RowBox[{"OptionValue", "[", "\"\<Mixing\>\"", "]"}]}], ";", "\n", 
     RowBox[{"reim", "=", 
      RowBox[{"OptionValue", "[", "\"\<ReIm\>\"", "]"}]}], ";", "\n", 
     RowBox[{"amphase", "=", 
      RowBox[{"OptionValue", "[", "\"\<AmpPhase\>\"", "]"}]}], ";", "\n", 
     RowBox[{"amphaseshift", "=", 
      RowBox[{"OptionValue", "[", "\"\<AmpPhaseShift\>\"", "]"}]}], ";", "\n", 
     RowBox[{"parvals", "=", 
      RowBox[{"OptionValue", "[", "\"\<ParameterValues\>\"", "]"}]}], ";", 
     "\n", 
     RowBox[{"\[Omega]val", "=", 
      RowBox[{"OptionValue", "[", "\"\<\[Omega]val\>\"", "]"}]}], ";", "\n", 
     RowBox[{"ex\[Omega]val", "=", 
      RowBox[{"OptionValue", "[", "\"\<Export_\[Omega]val\>\"", "]"}]}], ";", 
     "\n", 
     RowBox[{"modesdata", "=", 
      RowBox[{"OptionValue", "[", "\"\<ModesData\>\"", "]"}]}], ";", "\n", 
     RowBox[{"modesfile", "=", 
      RowBox[{"OptionValue", "[", "\"\<ModesFile\>\"", "]"}]}], ";", "\n", 
     RowBox[{"qualfactorQ", "=", 
      RowBox[{"OptionValue", "[", "\"\<QualityFactor\>\"", "]"}]}], ";", "\n", 
     RowBox[{"counterrotating", "=", 
      RowBox[{"OptionValue", "[", "\"\<CounterRotating\>\"", "]"}]}], ";", 
     "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"lm", ",", "mm"}], "}"}], "=", 
      RowBox[{"mixing", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", "counterrotating"}], ",", 
       RowBox[{
        RowBox[{"xcoeffstr", "=", "\"\<x\>\""}], ";", 
        RowBox[{"ycoeffstr", "=", "\"\<y\>\""}], ";"}], ",", 
       RowBox[{
        RowBox[{"xcoeffstr", "=", "\"\<xc\>\""}], ";", 
        RowBox[{"ycoeffstr", "=", "\"\<yc\>\""}]}]}], "]"}], ";", "\n", "\n", 
     
     RowBox[{"l", "=", 
      RowBox[{"mode", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"m", "=", 
      RowBox[{"mode", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Eta]", ",", "\[Chi]1", ",", "\[Chi]2"}], "}"}], "=", 
      RowBox[{"pars", "[", 
       RowBox[{"[", 
        RowBox[{"1", ";;", "3"}], "]"}], "]"}]}], ";", "\n", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Freqs", "."}], " ", "&"}], " ", "damping", " ", "times", " ",
        "from", " ", "Vitor"}], " ", "*)"}], "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "modesdata"}], "\[Equal]", "0"}], ",", 
       "\[IndentingNewLine]", "\t", 
       RowBox[{
        RowBox[{"\[Omega]s", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Omega]lmn", "[", 
             RowBox[{
             "l", ",", "m", ",", "n", ",", "\[Eta]", ",", "\[Chi]1", ",", 
              "\[Chi]2", ",", 
              RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
              RowBox[{"\"\<CounterRotating\>\"", "->", "counterrotating"}]}], 
             "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}], ";", 
        "\n", "\t", 
        RowBox[{"var", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "7"}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"If", "[", 
         RowBox[{"vary\[Omega]", ",", 
          RowBox[{"\[Omega]s", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"n", ">", "0"}], ",", 
                RowBox[{
                 RowBox[{"var", "[", 
                  RowBox[{"[", "n", "]"}], "]"}], "=", 
                 RowBox[{"RandomReal", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"1", "+", 
                    RowBox[{"\[Omega]val", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"1", "+", 
                    RowBox[{"\[Omega]val", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{"var", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "=", "1"}]}], "]"}], ";", 
              RowBox[{
               RowBox[{"var", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "+", "1"}], "]"}], "]"}], "*", 
               RowBox[{
                RowBox[{"\[Omega]lmn", "[", 
                 RowBox[{
                 "l", ",", "m", ",", "n", ",", "\[Eta]", ",", "\[Chi]1", ",", 
                  "\[Chi]2", ",", 
                  RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
                  RowBox[{
                  "\"\<CounterRotating\>\"", "->", "counterrotating"}]}], 
                 "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
             RowBox[{"{", 
              RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}]}], 
         "]"}], ";", "\n", "\t", 
        RowBox[{"\[Tau]s", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Omega]lmn", "[", 
             RowBox[{
             "l", ",", "m", ",", "n", ",", "\[Eta]", ",", "\[Chi]1", ",", 
              "\[Chi]2", ",", 
              RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
              RowBox[{"\"\<CounterRotating\>\"", "->", "counterrotating"}]}], 
             "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}], ";", 
        "\n", "\t", 
        RowBox[{"qfact", "=", 
         RowBox[{"\[Omega]s", "*", "\[Tau]s"}]}], ";"}], "\n", "\t", ",", 
       "\n", "\t", 
       RowBox[{
        RowBox[{"\[Omega]s", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Omega]lmn", "[", 
             RowBox[{
             "l", ",", "m", ",", "n", ",", "\[Eta]", ",", "\[Chi]1", ",", 
              "\[Chi]2", ",", 
              RowBox[{"\"\<ModesData\>\"", "->", 
               RowBox[{"modesdata", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "+", "1"}], "]"}], "]"}]}], ",", 
              RowBox[{"\"\<CounterRotating\>\"", "->", "counterrotating"}]}], 
             "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}], ";", 
        "\n", "\t", 
        RowBox[{"var", "=", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", "7"}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"If", "[", 
         RowBox[{"vary\[Omega]", ",", 
          RowBox[{"\[Omega]s", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"n", ">", "0"}], ",", 
                RowBox[{
                 RowBox[{"var", "[", 
                  RowBox[{"[", 
                   RowBox[{"n", "+", "1"}], "]"}], "]"}], "=", 
                 RowBox[{"RandomReal", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"1", "+", 
                    RowBox[{"\[Omega]val", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"1", "+", 
                    RowBox[{"\[Omega]val", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{"var", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "=", "1"}]}], "]"}], ";", 
              RowBox[{
               RowBox[{"var", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "+", "1"}], "]"}], "]"}], "*", 
               RowBox[{
                RowBox[{"\[Omega]lmn", "[", 
                 RowBox[{
                 "l", ",", "m", ",", "n", ",", "\[Eta]", ",", "\[Chi]1", ",", 
                  "\[Chi]2", ",", 
                  RowBox[{"\"\<ModesData\>\"", "->", 
                   RowBox[{"modesdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}]}], ",", 
                  RowBox[{
                  "\"\<CounterRotating\>\"", "->", "counterrotating"}]}], 
                 "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
             RowBox[{"{", 
              RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}]}], 
         "]"}], ";", "\n", "\t", 
        RowBox[{"\[Tau]s", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[Omega]lmn", "[", 
             RowBox[{
             "l", ",", "m", ",", "n", ",", "\[Eta]", ",", "\[Chi]1", ",", 
              "\[Chi]2", ",", 
              RowBox[{"\"\<ModesData\>\"", "->", 
               RowBox[{"modesdata", "[", 
                RowBox[{"[", 
                 RowBox[{"n", "+", "1"}], "]"}], "]"}]}], ",", 
              RowBox[{"\"\<CounterRotating\>\"", "->", "counterrotating"}]}], 
             "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}], ";", 
        "\n", "\t", 
        RowBox[{"qfact", "=", 
         RowBox[{"\[Omega]s", "*", "\[Tau]s"}]}], ";"}]}], "\n", "\t", "]"}], 
     ";", "\n", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "@", "amphase"}], ",", "\n", "    ", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{"qualfactorQ", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"ansatz", "=", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"Not", "@", "reim"}], ",", 
                 RowBox[{"x", "=", 
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ",", 
                 RowBox[{"x", "=", 
                  RowBox[{
                   RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], "+", 
                   
                   RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"ycoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], ")"}], 
                    "]"}]}]}]}]}], "]"}], ";", " ", 
               RowBox[{"x", " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfact", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}]}], 
                    ")"}]}]}], ")"}]}], "]"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Cos", "[", 
                   RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                  RowBox[{"I", " ", 
                   RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", 
                 ")"}]}]}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}], 
           ";", "\n", "\t\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"mixing", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
             RowBox[{
              RowBox[{"\[Omega]m\[Tau]sm", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"\[Omega]lmn", "[", 
                  RowBox[{
                  "lm", ",", "mm", ",", "n", ",", "\[Eta]", ",", "\[Chi]1", 
                   ",", "\[Chi]2", ",", 
                   RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
                   RowBox[{
                   "\"\<CounterRotating\>\"", "->", "counterrotating"}]}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}],
               ";", "\n", "\t\t", 
              RowBox[{"\[Omega]m", "=", 
               RowBox[{"\[Omega]m\[Tau]sm", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\n", "\t\t", 
              RowBox[{"\[Tau]sm", "=", 
               RowBox[{"\[Omega]m\[Tau]sm", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", "\n", "\t\t", 
              RowBox[{"qfactm", "=", 
               RowBox[{"\[Omega]m", "*", "\[Tau]sm"}]}], ";", "\n", "\t\t", 
              RowBox[{"ansatz", "=", 
               RowBox[{"ansatz", "+", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "@", "reim"}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<xm\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<xm\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<ym\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}]}]}]}], 
                    "]"}], ";", 
                   RowBox[{"x", " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfactm", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}]}], 
                    ")"}]}]}], ")"}]}], "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", 
                    ")"}]}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], 
                 "]"}]}]}]}]}], "]"}], ";"}], "\n", "\t", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"ansatz", "=", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"Not", "@", "reim"}], ",", 
                 RowBox[{"If", "[", 
                  RowBox[{"amphaseshift", ",", 
                   RowBox[{"x", "=", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}], "*", 
                    RowBox[{"Exp", "[", 
                    RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"ycoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], "]"}]}]}],
                    ",", 
                   RowBox[{"x", "=", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}]}], "]"}], 
                 ",", 
                 RowBox[{"x", "=", 
                  RowBox[{
                   RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], "+", 
                   
                   RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"(", 
                    RowBox[{"ycoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], ")"}], 
                    "]"}]}]}]}]}], "]"}], ";", " ", 
               RowBox[{"x", " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                  RowBox[{"(", 
                   RowBox[{"1", "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Tau]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}]}], 
                    ")"}]}], ")"}]}], "]"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Cos", "[", 
                   RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                  RowBox[{"I", " ", 
                   RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                    " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", 
                 ")"}]}]}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}], 
           ";", "\n", "\t\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"mixing", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t", 
             RowBox[{
              RowBox[{"\[Omega]m\[Tau]sm", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"\[Omega]lmn", "[", 
                  RowBox[{
                  "lm", ",", "mm", ",", "n", ",", "\[Eta]", ",", "\[Chi]1", 
                   ",", "\[Chi]2", ",", 
                   RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
                   RowBox[{
                   "\"\<CounterRotating\>\"", "->", "counterrotating"}]}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}],
               ";", "\n", "\t\t", 
              RowBox[{"\[Omega]m", "=", 
               RowBox[{"\[Omega]m\[Tau]sm", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\n", "\t\t", 
              RowBox[{"\[Tau]sm", "=", 
               RowBox[{"\[Omega]m\[Tau]sm", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", "\n", "\t\t", 
              RowBox[{"ansatz", "=", 
               RowBox[{"ansatz", "+", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "@", "reim"}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<xm\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ",", 
                    RowBox[{"x", "=", 
                    RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<xm\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<ym\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}]}]}]}], 
                    "]"}], ";", 
                   RowBox[{"x", " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], ")"}]}], "]"}], 
                    " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", 
                    ")"}]}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], 
                 "]"}]}]}]}]}], "]"}], ";"}]}], "\t", "\n", "\t", "]"}], 
        ";"}], "\n", "\t", ",", "\n", "\t", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{"qualfactorQ", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"re", "=", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"xcoeffstr", "<>", 
                 RowBox[{"ToString", "[", "n", "]"}]}], "]"}], " ", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{"(", 
                   RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfact", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}]}], 
                    ")"}]}]}], ")"}]}], "]"}], 
               RowBox[{"Cos", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"\[Omega]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                  RowBox[{"(", 
                   RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                  " ", 
                  RowBox[{"(", "Global`t", ")"}]}], "+", 
                 RowBox[{"ToExpression", "[", 
                  RowBox[{"\"\<\[Phi]\>\"", "<>", 
                   RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], "]"}]}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}], 
           ";", "\n", "\t", 
           RowBox[{"im", "=", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"xcoeffstr", "<>", 
                 RowBox[{"ToString", "[", "n", "]"}]}], "]"}], " ", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{"(", 
                   RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfact", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}]}], 
                    ")"}]}]}], ")"}]}], "]"}], 
               RowBox[{"Sin", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"\[Omega]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                  RowBox[{"(", 
                   RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                  " ", 
                  RowBox[{"(", "Global`t", ")"}]}], "+", 
                 RowBox[{"ToExpression", "[", 
                  RowBox[{"\"\<\[Phi]\>\"", "<>", 
                   RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], "]"}]}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}], 
           ";", "\n", "\n", "\t\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"mixing", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"\[Omega]m\[Tau]sm", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"\[Omega]lmn", "[", 
                  RowBox[{
                  "lm", ",", "mm", ",", "n", ",", "\[Eta]", ",", "\[Chi]1", 
                   ",", "\[Chi]2", ",", 
                   RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
                   RowBox[{
                   "\"\<CounterRotating\>\"", "->", "counterrotating"}]}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}],
               ";", "\n", "\t\t\t", 
              RowBox[{"\[Omega]m", "=", 
               RowBox[{"\[Omega]m\[Tau]sm", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
              "\t\t\t", 
              RowBox[{"\[Tau]sm", "=", 
               RowBox[{"\[Omega]m\[Tau]sm", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", "\n", 
              "\t\t\t", 
              RowBox[{"qfactm", "=", 
               RowBox[{"\[Omega]m", "*", "\[Tau]sm"}]}], ";", "\n", "\t\t\t", 
              
              RowBox[{"rem", "=", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}], " ", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfactm", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}]}], 
                    ")"}]}]}], ")"}]}], "]"}], " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", ")"}]}],
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}],
               ";", "\n", "\t\t\t", 
              RowBox[{"imm", "=", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}], " ", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"\[Omega]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                    "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"qfactm", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}]}], 
                    ")"}]}]}], ")"}]}], "]"}], " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", ")"}]}],
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}],
               ";"}], "\n", "\t\t\t", ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"rem", "=", "0"}], ";", "\n", "\t\t\t", 
              RowBox[{"imm", "=", "0"}], ";"}]}], "\n", "\t\t\t", "]"}], 
           ";"}], "\n", "\t", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"re", "=", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"xcoeffstr", "<>", 
                 RowBox[{"ToString", "[", "n", "]"}]}], "]"}], " ", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{"(", 
                   RowBox[{"Global`t", "-", "ti"}], ")"}]}], "/", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"\[Tau]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                   RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}]}], 
                  ")"}]}], "]"}], 
               RowBox[{"Cos", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"\[Omega]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                  RowBox[{"(", 
                   RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                  " ", 
                  RowBox[{"(", "Global`t", ")"}]}], "+", 
                 RowBox[{"ToExpression", "[", 
                  RowBox[{"\"\<\[Phi]\>\"", "<>", 
                   RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], "]"}]}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}], 
           ";", "\n", "\t", 
           RowBox[{"im", "=", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"xcoeffstr", "<>", 
                 RowBox[{"ToString", "[", "n", "]"}]}], "]"}], " ", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{"(", 
                   RowBox[{"Global`t", "-", "ti"}], ")"}]}], "/", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"\[Tau]s", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                   RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Beta]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}]}], 
                  ")"}]}], "]"}], 
               RowBox[{"Sin", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"\[Omega]s", "[", 
                   RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], 
                  RowBox[{"(", 
                   RowBox[{"1", "+", 
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"\"\<\[Alpha]\>\"", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], ")"}], 
                  " ", 
                  RowBox[{"(", "Global`t", ")"}]}], "+", 
                 RowBox[{"ToExpression", "[", 
                  RowBox[{"\"\<\[Phi]\>\"", "<>", 
                   RowBox[{"ToString", "[", "n", "]"}]}], "]"}]}], "]"}]}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}], 
           ";", "\n", "\n", "\t\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"mixing", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"\[Omega]m\[Tau]sm", "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"\[Omega]lmn", "[", 
                  RowBox[{
                  "lm", ",", "mm", ",", "n", ",", "\[Eta]", ",", "\[Chi]1", 
                   ",", "\[Chi]2", ",", 
                   RowBox[{"\"\<ModesFile\>\"", "->", "modesfile"}], ",", 
                   RowBox[{
                   "\"\<CounterRotating\>\"", "->", "counterrotating"}]}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}],
               ";", "\n", "\t\t\t", 
              RowBox[{"\[Omega]m", "=", 
               RowBox[{"\[Omega]m\[Tau]sm", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
              "\t\t\t", 
              RowBox[{"\[Tau]sm", "=", 
               RowBox[{"\[Omega]m\[Tau]sm", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", "\n", 
              "\t\t\t", 
              RowBox[{"rem", "=", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}], " ", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], ")"}]}], "]"}], 
                  " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Cos", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", ")"}]}],
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}],
               ";", "\n", "\t\t\t", 
              RowBox[{"imm", "=", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ToExpression", "[", 
                   RowBox[{"xcoeffstr", "<>", 
                    RowBox[{"ToString", "[", "n", "]"}]}], "]"}], " ", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Global`t", "-", "ti"}], ")"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Tau]sm", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], ")"}]}], "]"}], 
                  " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}], "+", 
                    RowBox[{"I", " ", 
                    RowBox[{"Sin", "[", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]m", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", "+", "1"}], "]"}], "]"}], " ", 
                    RowBox[{"(", "Global`t", ")"}]}], "]"}]}]}], " ", ")"}]}],
                  ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", "0", ",", "overtones"}], "}"}]}], "]"}]}],
               ";"}], "\n", "\t\t\t", ",", "\n", "\t\t\t", 
             RowBox[{
              RowBox[{"rem", "=", "0"}], ";", "\n", "\t\t\t", 
              RowBox[{"imm", "=", "0"}], ";"}]}], "\n", "\t\t\t", "]"}], 
           ";"}]}], "\n", "      ", "]"}], ";", "\n", 
        RowBox[{"ampansatz", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"re", "+", "rem"}], ")"}], "^", "2"}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"im", "+", "imm"}], ")"}], "^", "2"}]}], "]"}]}], ";", 
        "\n", 
        RowBox[{"phaseansatz", "=", 
         RowBox[{"ArcTan", "[", 
          RowBox[{"im", "/", "re"}], "]"}]}], ";", "\n", 
        RowBox[{"ansatz", "=", 
         RowBox[{"{", 
          RowBox[{"ampansatz", ",", "phaseansatz"}], "}"}]}], ";"}]}], "\n", 
      "]"}], ";", "\n", "\n", 
     RowBox[{"modto0", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{"i", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "overtones"}], "}"}]}], "]"}], ",", 
        "fit\[Alpha]"}], "]"}]}], ";", "\n", 
     RowBox[{"modto0", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"\"\<\[Alpha]\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"modto0", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}]}], ";", "\n", 
     RowBox[{"ansatz", "=", 
      RowBox[{"ansatz", "/.", 
       RowBox[{"(", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"modto0", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "->", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}], ")"}]}]}], 
     ";", "\n", "\n", 
     RowBox[{"modto0", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{"i", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", "overtones"}], "}"}]}], "]"}], ",", 
        "fit\[Tau]"}], "]"}]}], ";", "\n", 
     RowBox[{"modto0", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"\"\<\[Beta]\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"modto0", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}]}], ";", "\n", 
     RowBox[{"ansatz", "=", 
      RowBox[{"ansatz", "/.", 
       RowBox[{"(", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"modto0", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "->", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "modto0"}]}], "}"}]}], "]"}], ")"}]}]}], 
     ";", "\n", "\n", 
     RowBox[{"If", "[", 
      RowBox[{"ex\[Omega]val", ",", 
       RowBox[{"{", 
        RowBox[{"ansatz", ",", "var"}], "}"}], ",", "ansatz"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\n"}], "Code",
 CellChangeTimes->{{3.771677386705565*^9, 3.771677432575967*^9}, {
   3.771677478692521*^9, 3.7716776974786987`*^9}, {3.771677749156809*^9, 
   3.771677749245604*^9}, {3.771678368242831*^9, 3.77167855802042*^9}, {
   3.7719072251494093`*^9, 3.771907227456575*^9}, {3.7719072710256453`*^9, 
   3.771907398091879*^9}, {3.771907458458599*^9, 3.771907471104031*^9}, {
   3.771907535295508*^9, 3.771907567230341*^9}, {3.771907597432748*^9, 
   3.771907629986505*^9}, {3.77190871277954*^9, 3.771908761390111*^9}, {
   3.771908813523059*^9, 3.7719089729431467`*^9}, {3.771909004206633*^9, 
   3.77190900469588*^9}, {3.771909058496481*^9, 3.771909075189431*^9}, {
   3.771909162367087*^9, 3.7719093135594387`*^9}, {3.7719093472737703`*^9, 
   3.7719094536444597`*^9}, {3.771909485309827*^9, 3.7719096216321917`*^9}, {
   3.771911525736096*^9, 3.771911555269594*^9}, {3.771911592383946*^9, 
   3.771911650727923*^9}, {3.7719119344490023`*^9, 3.771911934634461*^9}, {
   3.772193444179907*^9, 3.7721934684908667`*^9}, 3.7721935063709593`*^9, {
   3.7721935368526163`*^9, 3.77219366166796*^9}, {3.77219642009752*^9, 
   3.772196501577361*^9}, {3.772196556744199*^9, 3.7721965582919827`*^9}, {
   3.772196623495311*^9, 3.772196703653275*^9}, {3.772196842685261*^9, 
   3.772196859406479*^9}, {3.772196988080412*^9, 3.7721970025950603`*^9}, {
   3.7722478303251*^9, 3.772247831532436*^9}, {3.77658033668747*^9, 
   3.776580348028509*^9}, {3.7765809639728327`*^9, 3.77658097177113*^9}, {
   3.776581457080768*^9, 3.776581475487019*^9}, {3.776581515046463*^9, 
   3.77658160150498*^9}, {3.7765817333625803`*^9, 3.7765817752553797`*^9}, {
   3.7765860616001368`*^9, 3.776586064674204*^9}, {3.776586100742178*^9, 
   3.776586185337967*^9}, {3.776586259954899*^9, 3.776586260329609*^9}, {
   3.776586308985792*^9, 3.776586326416067*^9}, {3.776586370893306*^9, 
   3.7765863790338497`*^9}, {3.7765864409394817`*^9, 3.776586462208321*^9}, {
   3.776586494448669*^9, 3.776586550379714*^9}, {3.776588773375059*^9, 
   3.776588777468933*^9}, {3.778555556406411*^9, 3.778555568824278*^9}, {
   3.778565526517099*^9, 3.778565530554241*^9}, {3.7785655639133472`*^9, 
   3.7785656183907623`*^9}, {3.778565653049898*^9, 3.7785657064928303`*^9}, {
   3.778565785975872*^9, 3.7785657961721077`*^9}, {3.778565857608344*^9, 
   3.778565859731264*^9}, 3.77856591349852*^9, {3.778566191886526*^9, 
   3.778566193930477*^9}, 3.778566246778599*^9, {3.778566363118126*^9, 
   3.77856640048003*^9}, {3.778566501309498*^9, 3.778566501907134*^9}, {
   3.778567075366261*^9, 3.7785670782516212`*^9}, {3.784027275521529*^9, 
   3.7840273848540783`*^9}, {3.784027466674209*^9, 3.7840276726788597`*^9}, {
   3.784027744249055*^9, 3.784027770048777*^9}, {3.784027807926426*^9, 
   3.7840278173359623`*^9}, {3.784027960944667*^9, 3.784028054211288*^9}, {
   3.7840280871565647`*^9, 3.7840281001470327`*^9}, {3.7840344337639017`*^9, 
   3.784034529470811*^9}, {3.784034583373845*^9, 3.784034630941607*^9}, {
   3.784037500320373*^9, 3.78403752221579*^9}, {3.784037556624576*^9, 
   3.784037655409525*^9}, {3.784037695864181*^9, 3.7840377491643267`*^9}, {
   3.784037826395269*^9, 3.784037838389056*^9}, {3.785135168481369*^9, 
   3.785135188672686*^9}, {3.785135370031146*^9, 3.785135632797415*^9}, {
   3.785135704427512*^9, 3.785135709699354*^9}, {3.7851358102358313`*^9, 
   3.785135865344125*^9}, {3.7851360843385277`*^9, 3.7851361456991663`*^9}, {
   3.785136185872944*^9, 3.785136191845982*^9}, {3.785140798343335*^9, 
   3.785140803112817*^9}, {3.785140833533779*^9, 3.785140839360903*^9}, {
   3.7851408796427526`*^9, 3.7851408919338703`*^9}, {3.7851409237996197`*^9, 
   3.785141030146646*^9}, {3.785141183125049*^9, 3.785141196189204*^9}, {
   3.785141236134383*^9, 3.7851412547365723`*^9}, {3.785742317087573*^9, 
   3.7857423818009644`*^9}, {3.788588900081777*^9, 3.788588922583219*^9}, {
   3.788588977524485*^9, 3.78858899232054*^9}, {3.788592700140904*^9, 
   3.788592829761201*^9}, {3.78859288245713*^9, 3.788592886045624*^9}, {
   3.788592986457713*^9, 3.788593032023745*^9}, {3.788593174304693*^9, 
   3.788593193410795*^9}, {3.788593249525272*^9, 3.788593249845934*^9}, {
   3.799117023811561*^9, 3.7991170620045013`*^9}, {3.799117327168158*^9, 
   3.799117328720833*^9}, {3.799117528607526*^9, 3.799117625219865*^9}, {
   3.799117723391061*^9, 3.799117729813736*^9}, {3.799117808069282*^9, 
   3.7991178319953527`*^9}, 3.799117913918251*^9, {3.7991179442970963`*^9, 
   3.799117946897843*^9}, {3.799117988695221*^9, 3.799118002060157*^9}, {
   3.799118164806386*^9, 3.799118171828588*^9}, {3.799121555953467*^9, 
   3.799121605765253*^9}, {3.799121810634165*^9, 3.799121812345255*^9}, {
   3.799121879641095*^9, 3.799121918333335*^9}, {3.799122036271903*^9, 
   3.799122041022492*^9}, {3.800075376244379*^9, 3.80007540453275*^9}, {
   3.800075443434237*^9, 3.800075445045846*^9}, {3.800076115854972*^9, 
   3.800076140880919*^9}, {3.80008068851781*^9, 3.800080746362953*^9}, {
   3.800080780024949*^9, 3.8000808514481983`*^9}, {3.800081341480514*^9, 
   3.8000814602083263`*^9}, {3.800081492076582*^9, 3.800081681089995*^9}, {
   3.800088960496607*^9, 3.80008897437778*^9}, {3.800089225155568*^9, 
   3.800089231743319*^9}, {3.800089309267664*^9, 3.8000893111631317`*^9}, {
   3.8000894233429127`*^9, 3.800089424068041*^9}, {3.800089457010537*^9, 
   3.8000894734082737`*^9}, {3.800089572498385*^9, 3.8000895831367807`*^9}, 
   3.802773665064678*^9, {3.803265134261528*^9, 3.803265243812134*^9}, {
   3.805441479133973*^9, 3.805441565740024*^9}, {3.8054418091147537`*^9, 
   3.805441842465892*^9}, {3.805441895970022*^9, 3.80544193626302*^9}, {
   3.805442073647194*^9, 3.805442143306349*^9}, {3.805442260962514*^9, 
   3.80544228359551*^9}, {3.8268736650311832`*^9, 3.826873670321673*^9}, 
   3.8268744784554873`*^9},ExpressionUUID->"e22e94dc-e455-4145-b44a-\
607019fc3ef9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OvertoneFromReImToComplex", "[", 
    RowBox[{"vars_", ",", "pars_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"parsmod", ",", "itmax", ",", "iters"}], "}"}], ",", "\n", "\n", 
     RowBox[{
      RowBox[{"itmax", "=", 
       RowBox[{
        RowBox[{"Length", "[", "pars", "]"}], "/", "2"}]}], ";", "\n", 
      RowBox[{"iters", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"its", "-", "1"}], ",", 
         RowBox[{"{", 
          RowBox[{"its", ",", "itmax"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"parsmod", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"vars", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"2", "*", "i"}], "+", "1"}], "]"}], "]"}], "\[Rule]", 
          RowBox[{
           RowBox[{"Sqrt", "[", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"pars", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"2", "i"}], "+", "1"}], "]"}], "]"}], "^", "2"}], 
              "+", 
              RowBox[{
               RowBox[{"pars", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"2", "i"}], "+", "2"}], "]"}], "]"}], "^", "2"}]}], 
             ")"}], "]"}], 
           RowBox[{"Exp", "[", 
            RowBox[{"I", " ", 
             RowBox[{"ArcTan", "[", 
              RowBox[{
               RowBox[{"pars", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"2", "i"}], "+", "2"}], "]"}], "]"}], "/", 
               RowBox[{"pars", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"2", "i"}], "+", "1"}], "]"}], "]"}]}], "]"}]}], 
            "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "iters"}], "}"}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.8272865138391*^9, 3.827286582375134*^9}, {
   3.827286617911907*^9, 3.8272868614274817`*^9}, {3.827286931576826*^9, 
   3.827286976704214*^9}, {3.827287009918644*^9, 3.8272870140675*^9}, 
   3.8272871025749693`*^9, {3.827287176338921*^9, 3.827287197821473*^9}, 
   3.827287242476371*^9, {3.82728729149224*^9, 3.8272873652269783`*^9}, {
   3.827287446053527*^9, 3.8272875088240623`*^9}, {3.827287552217951*^9, 
   3.827287611355632*^9}, {3.827287649937313*^9, 3.8272876537916718`*^9}, {
   3.827477728663661*^9, 
   3.827477730346937*^9}},ExpressionUUID->"eb8bd4c9-2671-484c-a8e2-\
20fe64beec38"]
}, Closed]],

Cell[CellGroupData[{

Cell["Ringdown fit", "Subsection",
 CellChangeTimes->{{3.8297979822827673`*^9, 
  3.829797989763818*^9}},ExpressionUUID->"3b2c01eb-ca39-44b8-a326-\
339e7b6dca65"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Options", "[", "RefineBoundaries", "]"}], "=", 
  RowBox[{"Join", "[", 
   RowBox[{
    RowBox[{"Options", "[", "FitRingdown", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"\"\<Tolerance\>\"", "\[Rule]", "0.01"}], "}"}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"RefineBoundaries", "[", 
   RowBox[{"data_", ",", "nmax_", ",", "pars_", ",", "outval_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "amin", ",", "amax", ",", "mmin", ",", "mmax", ",", "ov", ",", "ovi", 
      ",", "out", ",", "parsvars", ",", "posresmin", ",", "res", ",", 
      "resmin", ",", "restab", ",", "resdata", ",", "res2", ",", "tol", ",", 
      "Global`M", ",", "Global`a", ",", "Global`t"}], "}"}], ",", "\n", "\n", 
    
    RowBox[{
     RowBox[{"tol", "=", 
      RowBox[{"OptionsPattern", "[", "\"\<Tolerance\>\"", "]"}]}], ";", "\n", 
     "\n", 
     RowBox[{"amin", "=", 
      RowBox[{
       RowBox[{"pars", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "*", 
       RowBox[{"(", "0.9", ")"}]}]}], ";", "\n", 
     RowBox[{"amax", "=", 
      RowBox[{
       RowBox[{"pars", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "*", 
       RowBox[{"(", "1.1", ")"}]}]}], ";", "\n", 
     RowBox[{"mmin", "=", 
      RowBox[{
       RowBox[{"pars", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "*", 
       RowBox[{"(", "0.9", ")"}]}]}], ";", "\n", 
     RowBox[{"mmax", "=", 
      RowBox[{
       RowBox[{"pars", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "*", 
       RowBox[{"(", "1.1", ")"}]}]}], ";", "\n", 
     RowBox[{"out", "=", "outval"}], ";", "\n", 
     RowBox[{"res2", "=", "1"}], ";", "\n", "\n", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"outval", "\[Equal]", "1"}], " ", "&&", " ", 
        RowBox[{"res2", "\[GreaterEqual]", "tol"}]}], ",", "\n", "\t", 
       RowBox[{
        RowBox[{"ovi", "=", 
         RowBox[{"OvertoneModel", "[", 
          RowBox[{"nmax", ",", 
           RowBox[{"{", 
            RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
           RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{"\"\<Mode\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"2", ",", "2"}], "}"}]}], ",", 
           RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
            RowBox[{"-", "2"}]}], ",", 
           RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}], 
           ",", 
           RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
           RowBox[{"\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}]}],
           "]"}]}], ";", "\n", "\t", 
        RowBox[{"parsvars", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{"(", 
              RowBox[{"\"\<x\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\t", 
        RowBox[{"restab", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{
              RowBox[{"ov", "=", 
               RowBox[{
                RowBox[{"ovi", "/.", 
                 RowBox[{"Global`M", "\[Rule]", "mass"}]}], "/.", 
                RowBox[{"Global`a", "\[Rule]", "spin"}]}]}], ";", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"res", "=", 
               RowBox[{
                RowBox[{"NonlinearModelFit", "[", 
                 RowBox[{
                 "data", ",", "ov", ",", "parsvars", ",", "Global`t"}], "]"}],
                 "[", "\"\<BestFitParameters\>\"", "]"}]}], ";", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"pars", "=", 
               RowBox[{"Norm", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"mass", ",", "spin"}], "}"}], "-", 
                 RowBox[{"{", 
                  RowBox[{"mfa", ",", "af"}], "}"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"resdata", "=", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"data", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"ov", "/.", "res"}], "/.", 
                   RowBox[{"Global`t", "->", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
                "]"}]}], ";", "\[IndentingNewLine]", "\t", 
              RowBox[{"res", "=", 
               RowBox[{"Total", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Re", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                   "2"}], "+", 
                  RowBox[{
                   RowBox[{"Im", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                   "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "\t", 
              RowBox[{"{", 
               RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], 
               "}"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], "}"}]}], 
            "]"}], ",", "1"}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"resmin", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"restab", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Quiet", "[", 
         RowBox[{"posresmin", "=", 
          RowBox[{"Position", "[", 
           RowBox[{"restab", ",", 
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "==", "resmin"}], "&"}], 
              ")"}]}]}], "]"}]}], "]"}], ";", "\n", "\t", 
        RowBox[{"pars", "=", 
         RowBox[{
          RowBox[{"restab", "[", 
           RowBox[{"[", 
            RowBox[{"posresmin", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"res2", "=", "resmin"}], ";", "\n", "\t", 
        RowBox[{"res", "=", 
         RowBox[{"Join", "[", 
          RowBox[{"pars", ",", 
           RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"mmin", ",", "mmax"}], "}"}], ",", 
             RowBox[{"pars", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"amin", ",", "amax"}], "}"}], ",", 
             RowBox[{"pars", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", "\n", 
          "\t\t\t\t", 
          RowBox[{
           RowBox[{"out", "=", "1"}], ";", 
           RowBox[{"Print", "[", 
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{
              "\"\<Parameter estimate touching the boundaries at n = \>\"", "<>", 
               RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
               "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
              "Red"}], "]"}], "]"}]}], ",", "\n", "\t\t\t\t", 
          RowBox[{
           RowBox[{"amin", "=", 
            RowBox[{
             RowBox[{"pars", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"(", "0.99", ")"}]}]}], ";", "\n", "\t\t\t\t", 
           RowBox[{"amax", "=", 
            RowBox[{
             RowBox[{"pars", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"(", "1.01", ")"}]}]}], ";", "\n", "\t\t\t\t", 
           RowBox[{"mmin", "=", 
            RowBox[{
             RowBox[{"pars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"(", "0.99", ")"}]}]}], ";", "\n", "\t\t\t\t", 
           RowBox[{"mmax", "=", 
            RowBox[{
             RowBox[{"pars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"(", "1.01", ")"}]}]}], ";", "\n", "\t\t\t\t", 
           RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}]}], "\n", "]"}], 
     ";"}]}], "\n", "]"}]}]}], "Code",
 CellChangeTimes->{{3.830227923566744*^9, 3.8302279805769672`*^9}, {
  3.830228042196682*^9, 3.830228222473542*^9}, {3.830228374637929*^9, 
  3.830228389705627*^9}, {3.830228464817009*^9, 
  3.830228563931918*^9}},ExpressionUUID->"96a02ee7-7b43-4dee-8fef-\
21d619612c51"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FitRingdown", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<OldFitPars\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}]}], ",", 
     RowBox[{"\"\<w228data\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"\"\<w229data\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"\"\<da\>\"", "\[Rule]", "0.00001"}], ",", 
     RowBox[{"\"\<dm\>\"", "\[Rule]", "0.00001"}], ",", 
     RowBox[{"\"\<OutputGrid\>\"", "\[Rule]", "False"}], ",", 
     RowBox[{"\"\<Boundaries\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"FitRingdownv2", "[", 
   RowBox[{"data_", ",", "nmax_", ",", "truepars_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "Global`a", ",", "Global`M", ",", "Global`t", ",", "af", ",", "amin", 
      ",", "amax", ",", "boundaries", ",", "da", ",", "dm", ",", "mfa", ",", 
      "mmin", ",", "mmax", ",", "oldpars", ",", "oldparsnorm", ",", 
      "oldparsnorf", ",", "out", ",", "outgrid", ",", "ov", ",", "ovi", ",", 
      "pars", ",", "parsvars", ",", "posresmin", ",", "res", ",", "restab", 
      ",", "res2", ",", "resall", ",", "resmin", ",", "resdata", ",", "x", 
      ",", "y", ",", "w228data", ",", "w229data"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"oldpars", "=", 
      RowBox[{"OptionValue", "[", "\"\<OldFitPars\>\"", "]"}]}], ";", "\n", 
     RowBox[{"oldparsnorm", "=", 
      RowBox[{"Norm", "[", 
       RowBox[{
        RowBox[{"oldpars", "/", "truepars"}], "-", "1"}], "]"}]}], ";", "\n", 
     
     RowBox[{"w228data", "=", 
      RowBox[{"OptionValue", "[", "\"\<w228data\>\"", "]"}]}], ";", "\n", 
     RowBox[{"w229data", "=", 
      RowBox[{"OptionValue", "[", "\"\<w229data\>\"", "]"}]}], ";", "\n", 
     RowBox[{"da", "=", 
      RowBox[{"OptionValue", "[", "\"\<da\>\"", "]"}]}], ";", "\n", 
     RowBox[{"dm", "=", 
      RowBox[{"OptionValue", "[", "\"\<dm\>\"", "]"}]}], ";", "\n", 
     RowBox[{"outgrid", "=", 
      RowBox[{"OptionValue", "[", "\"\<OutputGrid\>\"", "]"}]}], ";", "\n", 
     RowBox[{"boundaries", "=", 
      RowBox[{"OptionValue", "[", "\"\<Boundaries\>\"", "]"}]}], ";", "\n", 
     "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"mfa", ",", "af"}], "}"}], "=", "truepars"}], ";", "\n", "\n", 
     
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"nmax", "\[LessEqual]", "2"}], ",", "\n", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", "boundaries"}], "\[Equal]", "0"}], ",", 
          "\n", 
          RowBox[{
           RowBox[{"amin", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"(", "0.8", ")"}]}]}], ";", "\n", 
           RowBox[{"amax", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"(", "1.2", ")"}]}]}], ";", "\n", 
           RowBox[{"mmin", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"(", "0.5", ")"}]}]}], ";", "\n", 
           RowBox[{"mmax", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"(", "1.5", ")"}]}]}], ";"}], ",", "\n", 
          RowBox[{
           RowBox[{"amin", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
           RowBox[{"amax", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", "\n", 
           RowBox[{"mmin", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
           RowBox[{"mmax", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";"}]}], "\n", "]"}], 
        ";", "\n", 
        RowBox[{"Print", "[", "\"\<Using grid algorithm\>\"", "]"}], ";", 
        "\n", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<M bounds: \>\"", ",", 
          RowBox[{"{", 
           RowBox[{"mmin", ",", "mmax"}], "}"}]}], "]"}], ";", "\n", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<a bounds: \>\"", ",", 
          RowBox[{"{", 
           RowBox[{"amin", ",", "amax"}], "}"}]}], "]"}], ";", "\n", 
        RowBox[{"ovi", "=", 
         RowBox[{"OvertoneModel", "[", 
          RowBox[{"nmax", ",", 
           RowBox[{"{", 
            RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
           RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{"\"\<Mode\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"2", ",", "2"}], "}"}]}], ",", 
           RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
            RowBox[{"-", "2"}]}], ",", 
           RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}], 
           ",", 
           RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
           RowBox[{"\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}]}],
           "]"}]}], ";", "\n", "\t", 
        RowBox[{"parsvars", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"ToExpression", "[", 
             RowBox[{"(", 
              RowBox[{"\"\<x\>\"", "<>", 
               RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", "\t", 
        RowBox[{"restab", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
            RowBox[{
             RowBox[{
              RowBox[{"ov", "=", 
               RowBox[{
                RowBox[{"ovi", "/.", 
                 RowBox[{"Global`M", "\[Rule]", "mass"}]}], "/.", 
                RowBox[{"Global`a", "\[Rule]", "spin"}]}]}], ";", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"res", "=", 
               RowBox[{
                RowBox[{"NonlinearModelFit", "[", 
                 RowBox[{
                 "data", ",", "ov", ",", "parsvars", ",", "Global`t"}], "]"}],
                 "[", "\"\<BestFitParameters\>\"", "]"}]}], ";", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"pars", "=", 
               RowBox[{"Norm", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"mass", ",", "spin"}], "}"}], "-", 
                 RowBox[{"{", 
                  RowBox[{"mfa", ",", "af"}], "}"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", "\t", 
              RowBox[{"resdata", "=", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"data", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"ov", "/.", "res"}], "/.", 
                   RowBox[{"Global`t", "->", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
                "]"}]}], ";", "\[IndentingNewLine]", "\t", 
              RowBox[{"res", "=", 
               RowBox[{"Total", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Re", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                   "2"}], "+", 
                  RowBox[{
                   RowBox[{"Im", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                   "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "\t", 
              RowBox[{"{", 
               RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], 
               "}"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], "}"}]}], 
            "]"}], ",", "1"}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"resmin", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"restab", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\t", 
        RowBox[{"Quiet", "[", 
         RowBox[{"posresmin", "=", 
          RowBox[{"Position", "[", 
           RowBox[{"restab", ",", 
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "==", "resmin"}], "&"}], 
              ")"}]}]}], "]"}]}], "]"}], ";", "\n", "\t", 
        RowBox[{"pars", "=", 
         RowBox[{
          RowBox[{"restab", "[", 
           RowBox[{"[", 
            RowBox[{"posresmin", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"res2", "=", "resmin"}], ";", "\n", "\t", 
        RowBox[{"res", "=", 
         RowBox[{"Join", "[", 
          RowBox[{"pars", ",", 
           RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", "\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"mmin", ",", "mmax"}], "}"}], ",", 
             RowBox[{"pars", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"amin", ",", "amax"}], "}"}], ",", 
             RowBox[{"pars", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"out", "=", "1"}], ";", 
           RowBox[{"Print", "[", 
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{
              "\"\<Parameter estimate touching the boundaries at n = \>\"", "<>", 
               RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
               "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
              "Red"}], "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}], "\n", "\n", ",", 
       "\n", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<Using grid algorithm\>\"", "]"}], ";", 
        "\n", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", "boundaries"}], "\[Equal]", "0"}], ",", 
          "\n", 
          RowBox[{
           RowBox[{"amin", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"(", "0.995", ")"}]}]}], ";", "\n", 
           RowBox[{"amax", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"(", "1.005", ")"}]}]}], ";", "\n", 
           RowBox[{"mmin", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"(", "0.995", ")"}]}]}], ";", "\n", 
           RowBox[{"mmax", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"(", "1.005", ")"}]}]}], ";"}], ",", "\n", 
          RowBox[{
           RowBox[{"amin", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
           RowBox[{"amax", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", "\n", 
           RowBox[{"mmin", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
           RowBox[{"mmax", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";"}]}], "\n", "]"}], 
        ";", "\n", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<M bounds: \>\"", ",", 
          RowBox[{"{", 
           RowBox[{"mmin", ",", "mmax"}], "}"}]}], "]"}], ";", "\n", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<a bounds: \>\"", ",", 
          RowBox[{"{", 
           RowBox[{"amin", ",", "amax"}], "}"}]}], "]"}], ";", "\n", 
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{"nmax", "\[LessEqual]", "7"}], ",", "\n", "\t", 
          RowBox[{
           RowBox[{"ovi", "=", 
            RowBox[{"OvertoneModel", "[", 
             RowBox[{"nmax", ",", 
              RowBox[{"{", 
               RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
              RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
               RowBox[{"{", "}"}]}], ",", 
              RowBox[{"\"\<Mode\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"2", ",", "2"}], "}"}]}], ",", 
              RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
               RowBox[{"-", "2"}]}], ",", 
              RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}], 
              ",", 
              RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
              RowBox[{
              "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}]}], 
             "]"}]}], ";", "\n", "\t", 
           RowBox[{"parsvars", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"(", 
                 RowBox[{"\"\<x\>\"", "<>", 
                  RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}],
            ";", "\[IndentingNewLine]", "\t", 
           RowBox[{"restab", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"ov", "=", 
                  RowBox[{
                   RowBox[{"ovi", "/.", 
                    RowBox[{"Global`M", "\[Rule]", "mass"}]}], "/.", 
                   RowBox[{"Global`a", "\[Rule]", "spin"}]}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{
                   RowBox[{"NonlinearModelFit", "[", 
                    RowBox[{
                    "data", ",", "ov", ",", "parsvars", ",", "Global`t"}], 
                    "]"}], "[", "\"\<BestFitParameters\>\"", "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"pars", "=", 
                  RowBox[{"Norm", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"mass", ",", "spin"}], "}"}], "-", 
                    RowBox[{"{", 
                    RowBox[{"mfa", ",", "af"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"resdata", "=", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ov", "/.", "res"}], "/.", 
                    RowBox[{"Global`t", "->", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{"Total", "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Re", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"{", 
                  RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], 
                  "}"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], 
                 "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"resmin", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"Quiet", "[", 
            RowBox[{"posresmin", "=", 
             RowBox[{"Position", "[", 
              RowBox[{"restab", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "==", "resmin"}], "&"}], 
                 ")"}]}]}], "]"}]}], "]"}], ";", "\n", "\t", 
           RowBox[{"pars", "=", 
            RowBox[{
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"posresmin", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"res2", "=", "resmin"}], ";", "\n", "\t", 
           RowBox[{"res", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"pars", ",", 
              RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"mmin", ",", "mmax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"amin", ",", "amax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "1"}], ";", 
              RowBox[{"Print", "[", 
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{
                 "\"\<Parameter estimate touching the boundaries at n = \>\"",
                   "<>", 
                  RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
                  "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
                 "Red"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}], "\n", "\t", 
          ",", "\n", "\t", 
          RowBox[{"nmax", "\[Equal]", "8"}], "\n", "\t", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"ovi", "=", 
            RowBox[{"OvertoneModel", "[", 
             RowBox[{"8", ",", 
              RowBox[{"{", 
               RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
              RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
               RowBox[{"{", "}"}]}], ",", 
              RowBox[{"\"\<Mode\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"2", ",", "2"}], "}"}]}], ",", 
              RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
               RowBox[{"-", "2"}]}], ",", 
              RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}], 
              ",", 
              RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
              RowBox[{"\"\<N89Data\>\"", "\[Rule]", "w228data"}], ",", 
              RowBox[{
              "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}]}], 
             "]"}]}], ";", "\n", "\t", 
           RowBox[{"parsvars", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"(", 
                 RowBox[{"\"\<x\>\"", "<>", 
                  RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}],
            ";", "\[IndentingNewLine]", "\t", 
           RowBox[{"restab", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"ov", "=", 
                  RowBox[{
                   RowBox[{"ovi", "/.", 
                    RowBox[{"Global`M", "\[Rule]", "mass"}]}], "/.", 
                   RowBox[{"Global`a", "\[Rule]", "spin"}]}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{
                   RowBox[{"NonlinearModelFit", "[", 
                    RowBox[{
                    "data", ",", "ov", ",", "parsvars", ",", "Global`t"}], 
                    "]"}], "[", "\"\<BestFitParameters\>\"", "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"pars", "=", 
                  RowBox[{"Norm", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"mass", ",", "spin"}], "}"}], "-", 
                    RowBox[{"{", 
                    RowBox[{"mfa", ",", "af"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"resdata", "=", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ov", "/.", "res"}], "/.", 
                    RowBox[{"Global`t", "->", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{"Total", "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Re", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"{", 
                  RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], 
                  "}"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], 
                 "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"resmin", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"Quiet", "[", 
            RowBox[{"posresmin", "=", 
             RowBox[{"Position", "[", 
              RowBox[{"restab", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "==", "resmin"}], "&"}], 
                 ")"}]}]}], "]"}]}], "]"}], ";", "\n", "\t", 
           RowBox[{"pars", "=", 
            RowBox[{
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"posresmin", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"res2", "=", "resmin"}], ";", "\n", "\t", 
           RowBox[{"res", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"pars", ",", 
              RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"mmin", ",", "mmax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"amin", ",", "amax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "1"}], ";", 
              RowBox[{"Print", "[", 
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{
                 "\"\<Parameter estimate touching the boundaries at n = \>\"",
                   "<>", 
                  RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
                  "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
                 "Red"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}], "\n", "\t", 
          ",", "\n", "\t", 
          RowBox[{"nmax", "\[Equal]", "9"}], "\n", "\t", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"ovi", "=", " ", 
            RowBox[{
             RowBox[{"OvertoneModel", "[", 
              RowBox[{"8", ",", 
               RowBox[{"{", 
                RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
               RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
                RowBox[{"{", "}"}]}], ",", 
               RowBox[{"\"\<Mode\>\"", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"2", ",", "2"}], "}"}]}], ",", 
               RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
                RowBox[{"-", "2"}]}], ",", 
               RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}],
                ",", 
               RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
               RowBox[{"\"\<N89Data\>\"", "\[Rule]", "w228data"}], ",", 
               RowBox[{
               "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}]}], 
              "]"}], "+", "\[IndentingNewLine]", "\t   ", 
             RowBox[{"OvertoneModel", "[", 
              RowBox[{"9", ",", 
               RowBox[{"{", 
                RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
               RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
                RowBox[{"{", "}"}]}], ",", 
               RowBox[{"\"\<Mode\>\"", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"2", ",", "2"}], "}"}]}], ",", 
               RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
                RowBox[{"-", "2"}]}], ",", 
               RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}],
                ",", 
               RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
               RowBox[{"\"\<N89Data\>\"", "\[Rule]", "w229data"}], ",", 
               RowBox[{
               "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}], ",", 
               
               RowBox[{"\"\<Tones\>\"", "\[Rule]", 
                RowBox[{"{", "9", "}"}]}]}], "]"}]}]}], ";", "\n", "\t", 
           RowBox[{"parsvars", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"(", 
                 RowBox[{"\"\<x\>\"", "<>", 
                  RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}],
            ";", "\[IndentingNewLine]", "\t", 
           RowBox[{"restab", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"ov", "=", 
                  RowBox[{
                   RowBox[{"ovi", "/.", 
                    RowBox[{"Global`M", "\[Rule]", "mass"}]}], "/.", 
                   RowBox[{"Global`a", "\[Rule]", "spin"}]}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{
                   RowBox[{"NonlinearModelFit", "[", 
                    RowBox[{
                    "data", ",", "ov", ",", "parsvars", ",", "Global`t"}], 
                    "]"}], "[", "\"\<BestFitParameters\>\"", "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"pars", "=", 
                  RowBox[{"Norm", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"mass", ",", "spin"}], "}"}], "-", 
                    RowBox[{"{", 
                    RowBox[{"mfa", ",", "af"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"resdata", "=", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ov", "/.", "res"}], "/.", 
                    RowBox[{"Global`t", "->", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{"Total", "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Re", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"{", 
                  RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], 
                  "}"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], 
                 "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"resmin", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"Quiet", "[", 
            RowBox[{"posresmin", "=", 
             RowBox[{"Position", "[", 
              RowBox[{"restab", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "==", "resmin"}], "&"}], 
                 ")"}]}]}], "]"}]}], "]"}], ";", "\n", "\t", 
           RowBox[{"pars", "=", 
            RowBox[{
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"posresmin", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"res2", "=", "resmin"}], ";", "\n", "\t", 
           RowBox[{"res", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"pars", ",", 
              RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"mmin", ",", "mmax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"amin", ",", "amax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "1"}], ";", 
              RowBox[{"Print", "[", 
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{
                 "\"\<Parameter estimate touching the boundaries at n = \>\"",
                   "<>", 
                  RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
                  "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
                 "Red"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}], "\n", "\t", 
          ",", "\n", "\t", 
          RowBox[{"nmax", ">", "9"}], "\n", "\t", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"ovi", "=", " ", 
            RowBox[{
             RowBox[{"OvertoneModel", "[", 
              RowBox[{"8", ",", 
               RowBox[{"{", 
                RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
               RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
                RowBox[{"{", "}"}]}], ",", 
               RowBox[{"\"\<Mode\>\"", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"2", ",", "2"}], "}"}]}], ",", 
               RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
                RowBox[{"-", "2"}]}], ",", 
               RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}],
                ",", 
               RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
               RowBox[{"\"\<N89Data\>\"", "\[Rule]", "w228data"}], ",", 
               RowBox[{
               "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}]}], 
              "]"}], "+", "\[IndentingNewLine]", "\t   ", 
             RowBox[{"OvertoneModel", "[", 
              RowBox[{"9", ",", 
               RowBox[{"{", 
                RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
               RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
                RowBox[{"{", "}"}]}], ",", 
               RowBox[{"\"\<Mode\>\"", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"2", ",", "2"}], "}"}]}], ",", 
               RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
                RowBox[{"-", "2"}]}], ",", 
               RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}],
                ",", 
               RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
               RowBox[{"\"\<N89Data\>\"", "\[Rule]", "w229data"}], ",", 
               RowBox[{
               "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}], ",", 
               
               RowBox[{"\"\<Tones\>\"", "\[Rule]", 
                RowBox[{"{", "9", "}"}]}]}], "]"}]}]}], ";", "\n", "\t", 
           RowBox[{"ovi", " ", "=", " ", 
            RowBox[{"ovi", " ", "+", 
             RowBox[{"(", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{"OvertoneModel", "[", 
                 RowBox[{"n", ",", 
                  RowBox[{"{", 
                   RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
                  RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
                   RowBox[{"{", "}"}]}], ",", 
                  RowBox[{"\"\<Mode\>\"", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{"2", ",", "2"}], "}"}]}], ",", 
                  RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
                   RowBox[{"-", "2"}]}], ",", 
                  RowBox[{
                  "\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}], ",", 
                  RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
                  RowBox[{
                  "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}], 
                  ",", 
                  RowBox[{"\"\<Tones\>\"", "\[Rule]", 
                   RowBox[{"{", "n", "}"}]}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", ",", "10", ",", "nmax"}], "}"}]}], "]"}], 
              ")"}]}]}], ";", "\n", "\t", 
           RowBox[{"parsvars", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"(", 
                 RowBox[{"\"\<x\>\"", "<>", 
                  RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}],
            ";", "\[IndentingNewLine]", "\t", 
           RowBox[{"restab", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"ov", "=", 
                  RowBox[{
                   RowBox[{"ovi", "/.", 
                    RowBox[{"Global`M", "\[Rule]", "mass"}]}], "/.", 
                   RowBox[{"Global`a", "\[Rule]", "spin"}]}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{
                   RowBox[{"NonlinearModelFit", "[", 
                    RowBox[{
                    "data", ",", "ov", ",", "parsvars", ",", "Global`t"}], 
                    "]"}], "[", "\"\<BestFitParameters\>\"", "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"pars", "=", 
                  RowBox[{"Norm", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"mass", ",", "spin"}], "}"}], "-", 
                    RowBox[{"{", 
                    RowBox[{"mfa", ",", "af"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"resdata", "=", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ov", "/.", "res"}], "/.", 
                    RowBox[{"Global`t", "->", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{"Total", "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Re", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"{", 
                  RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], 
                  "}"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], 
                 "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"resmin", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"Quiet", "[", 
            RowBox[{"posresmin", "=", 
             RowBox[{"Position", "[", 
              RowBox[{"restab", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "==", "resmin"}], "&"}], 
                 ")"}]}]}], "]"}]}], "]"}], ";", "\n", "\t", 
           RowBox[{"pars", "=", 
            RowBox[{
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"posresmin", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"res2", "=", "resmin"}], ";", "\n", "\t", 
           RowBox[{"res", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"pars", ",", 
              RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"mmin", ",", "mmax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"amin", ",", "amax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "1"}], ";", 
              RowBox[{"Print", "[", 
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{
                 "\"\<Parameter estimate touching the boundaries at n = \>\"",
                   "<>", 
                  RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
                  "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
                 "Red"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}]}], "\n", "]"}],
         ";"}]}], "]"}], ";", "\n", "\n", 
     RowBox[{"(*", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"oldparsnorm", "\[GreaterEqual]", " ", "0.00125"}], " ", "&&",
          " ", 
         RowBox[{"nmax", "<", "5"}]}], ",", " ", 
        RowBox[{"Join", "[", 
         RowBox[{"res", ",", 
          RowBox[{"{", "out", "}"}]}], "]"}], ",", "True", ",", 
        RowBox[{"If", "[", 
         RowBox[{"outgrid", ",", 
          RowBox[{"Join", "[", 
           RowBox[{"res", ",", 
            RowBox[{"{", "out", "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"{", "restab", "}"}], "}"}]}], "]"}], ",", 
          RowBox[{"Join", "[", 
           RowBox[{"res", ",", 
            RowBox[{"{", "out", "}"}]}], "]"}]}], "]"}]}], "]"}], "*)"}], 
     "\n", 
     RowBox[{"If", "[", 
      RowBox[{"outgrid", ",", 
       RowBox[{"Join", "[", 
        RowBox[{"res", ",", 
         RowBox[{"{", "out", "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"{", "restab", "}"}], "}"}]}], "]"}], ",", 
       RowBox[{"Join", "[", 
        RowBox[{"res", ",", 
         RowBox[{"{", "out", "}"}]}], "]"}]}], "]"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.829795151717819*^9, 3.82979535533125*^9}, {
   3.829795624763452*^9, 3.829795761854959*^9}, {3.829795796755527*^9, 
   3.829795797781239*^9}, {3.829795935468842*^9, 3.82979596375159*^9}, {
   3.829796063659121*^9, 3.829796292160178*^9}, {3.8297964106350117`*^9, 
   3.829796652418686*^9}, {3.8297966838741503`*^9, 3.8297967755082703`*^9}, {
   3.829796828809277*^9, 3.829797159776266*^9}, {3.829797214138565*^9, 
   3.8297972733767853`*^9}, {3.82979730473289*^9, 3.829797387162142*^9}, {
   3.829797426638636*^9, 3.829797505688274*^9}, {3.829797543337813*^9, 
   3.829797573023447*^9}, {3.82979778108792*^9, 3.829797789335741*^9}, {
   3.829797834875762*^9, 3.829797926374855*^9}, {3.82979821790244*^9, 
   3.829798310451235*^9}, 3.8297983944954777`*^9, {3.8297984837110863`*^9, 
   3.829798487670486*^9}, {3.8297985517142067`*^9, 3.8297985535033283`*^9}, 
   3.8297985960774612`*^9, {3.829798664295636*^9, 3.829798667786428*^9}, {
   3.829798714439015*^9, 3.8297987618772573`*^9}, {3.8297996351755047`*^9, 
   3.8297996410512543`*^9}, {3.829799845185315*^9, 3.829799874694036*^9}, {
   3.829799924573017*^9, 3.829799928084923*^9}, {3.829799983650694*^9, 
   3.8298000141202803`*^9}, {3.8298004205287657`*^9, 3.829800458997541*^9}, {
   3.829801072385017*^9, 3.829801163351886*^9}, {3.8298012551352253`*^9, 
   3.829801266500272*^9}, {3.829801354659181*^9, 3.829801360276985*^9}, {
   3.829801416490614*^9, 3.829801419438122*^9}, {3.829801466973069*^9, 
   3.829801477950055*^9}, {3.82980151362551*^9, 3.829801516202326*^9}, {
   3.829801560905869*^9, 3.829801564746935*^9}, {3.829801647560013*^9, 
   3.829801656795576*^9}, {3.82980171817939*^9, 3.829801719839511*^9}, {
   3.829801764509062*^9, 3.829801766563431*^9}, {3.829801825630772*^9, 
   3.8298018293375187`*^9}, {3.8298018743622932`*^9, 
   3.8298019464206047`*^9}, {3.82980206776527*^9, 3.829802109794353*^9}, {
   3.829802143853406*^9, 3.829802146938305*^9}, {3.829802257473068*^9, 
   3.8298022609480658`*^9}, {3.8298023808622427`*^9, 3.829802384217052*^9}, {
   3.829802911761827*^9, 3.8298029334151993`*^9}, 3.829803107312368*^9, {
   3.829803236254857*^9, 3.829803247529263*^9}, {3.8298032943914213`*^9, 
   3.829803446468729*^9}, {3.829803528381343*^9, 3.829803541434257*^9}, {
   3.8298035788962173`*^9, 3.829803579086892*^9}, {3.829803629648423*^9, 
   3.8298036327921877`*^9}, {3.829803807319075*^9, 3.8298038676283283`*^9}, {
   3.82980390754274*^9, 3.829803908199774*^9}, {3.829803947548326*^9, 
   3.829803948693696*^9}, {3.829804073135352*^9, 3.829804079853216*^9}, {
   3.829804229176856*^9, 3.8298043161682262`*^9}, {3.82980454558638*^9, 
   3.829804546878955*^9}, {3.829804680899149*^9, 3.829804690229598*^9}, {
   3.829805691306633*^9, 3.829805715195068*^9}, {3.82980582388442*^9, 
   3.829805840597286*^9}, {3.8298992060425577`*^9, 3.829899212980274*^9}, {
   3.829899970479845*^9, 3.829899970582829*^9}, {3.8299000582895107`*^9, 
   3.829900060587331*^9}, {3.829900281682353*^9, 3.8299002817420607`*^9}, {
   3.829901058786983*^9, 3.829901059645993*^9}, {3.8299023301683083`*^9, 
   3.829902337052291*^9}, {3.8299673053575773`*^9, 3.8299673311007633`*^9}, {
   3.829968275038653*^9, 3.8299683762763233`*^9}, {3.829968414809895*^9, 
   3.829968415657271*^9}, {3.829968457540099*^9, 3.829968461607525*^9}, {
   3.829968967287836*^9, 3.829968969415331*^9}, {3.829969063951148*^9, 
   3.829969075770522*^9}, {3.8299706633590918`*^9, 3.829970665296535*^9}, {
   3.829982182279601*^9, 3.829982261711389*^9}, {3.829982352396055*^9, 
   3.829982356948909*^9}, {3.830047611338173*^9, 3.830047635838286*^9}, {
   3.8300477205182457`*^9, 3.830047786461525*^9}, {3.83004783760919*^9, 
   3.830047840296794*^9}, {3.830047879827512*^9, 3.83004788506286*^9}, {
   3.8300479371230087`*^9, 3.830047942214422*^9}, {3.8300480093810263`*^9, 
   3.8300480355289373`*^9}, {3.830048141434511*^9, 3.830048142861143*^9}, {
   3.8300482135704937`*^9, 3.830048216121708*^9}, {3.83004836373337*^9, 
   3.8300483700469933`*^9}, {3.830069857348377*^9, 3.830069860067284*^9}, {
   3.8300699788772793`*^9, 3.830069982551334*^9}, 3.830070402725329*^9, 
   3.830075552329269*^9, {3.830075908486326*^9, 3.830075908593164*^9}, {
   3.830075958386108*^9, 3.830075962730847*^9}, {3.830228637855836*^9, 
   3.830228638145393*^9}},ExpressionUUID->"01a7a614-2116-49c7-8c69-\
d231c88986bf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FitRingdown", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<OldFitPars\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}]}], ",", 
     RowBox[{"\"\<w228data\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"\"\<w229data\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"\"\<da\>\"", "\[Rule]", "0.00001"}], ",", 
     RowBox[{"\"\<dm\>\"", "\[Rule]", "0.00001"}], ",", 
     RowBox[{"\"\<OutputGrid\>\"", "\[Rule]", "False"}], ",", 
     RowBox[{"\"\<Boundaries\>\"", "\[Rule]", 
      RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"FitRingdown", "[", 
   RowBox[{"data_", ",", "nmax_", ",", "truepars_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "Global`a", ",", "Global`M", ",", "Global`t", ",", "af", ",", "amin", 
      ",", "amax", ",", "boundaries", ",", "da", ",", "dm", ",", "mfa", ",", 
      "mmin", ",", "mmax", ",", "oldpars", ",", "oldparsnorm", ",", 
      "oldparsnorf", ",", "out", ",", "outgrid", ",", "ov", ",", "ovi", ",", 
      "pars", ",", "parsvars", ",", "posresmin", ",", "res", ",", "restab", 
      ",", "res2", ",", "resall", ",", "resmin", ",", "resdata", ",", "x", 
      ",", "y", ",", "w228data", ",", "w229data"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"oldpars", "=", 
      RowBox[{"OptionValue", "[", "\"\<OldFitPars\>\"", "]"}]}], ";", "\n", 
     RowBox[{"oldparsnorm", "=", 
      RowBox[{"Norm", "[", 
       RowBox[{
        RowBox[{"oldpars", "/", "truepars"}], "-", "1"}], "]"}]}], ";", "\n", 
     
     RowBox[{"w228data", "=", 
      RowBox[{"OptionValue", "[", "\"\<w228data\>\"", "]"}]}], ";", "\n", 
     RowBox[{"w229data", "=", 
      RowBox[{"OptionValue", "[", "\"\<w229data\>\"", "]"}]}], ";", "\n", 
     RowBox[{"da", "=", 
      RowBox[{"OptionValue", "[", "\"\<da\>\"", "]"}]}], ";", "\n", 
     RowBox[{"dm", "=", 
      RowBox[{"OptionValue", "[", "\"\<dm\>\"", "]"}]}], ";", "\n", 
     RowBox[{"outgrid", "=", 
      RowBox[{"OptionValue", "[", "\"\<OutputGrid\>\"", "]"}]}], ";", "\n", 
     RowBox[{"boundaries", "=", 
      RowBox[{"OptionValue", "[", "\"\<Boundaries\>\"", "]"}]}], ";", "\n", 
     "\n", 
     RowBox[{"restab", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\n", "\t", 
         RowBox[{
          RowBox[{
           RowBox[{"pars", "=", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], "\[IndentingNewLine]", "\t", 
              "res"}], "=", "0"}]}], ";", "\[IndentingNewLine]", "\t", 
           RowBox[{"{", 
            RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], "}"}]}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}], ",", 
          
          RowBox[{"{", 
           RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], "}"}]}], 
         "]"}], ",", "1"}], "]"}]}], ";", "\n", "\n", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"mfa", ",", "af"}], "}"}], "=", "truepars"}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"oldparsnorm", "\[GreaterEqual]", " ", "0.00125"}], " ", "&&",
         " ", 
        RowBox[{"nmax", "<", "5"}]}], ",", "\n", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<Using fitting algorithm\>\"", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ov", "=", 
         RowBox[{"OvertoneModel", "[", 
          RowBox[{"nmax", ",", 
           RowBox[{"{", 
            RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
           RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{"\"\<Mode\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"2", ",", "2"}], "}"}]}], ",", 
           RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
            RowBox[{"-", "2"}]}], ",", 
           RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}], 
           ",", 
           RowBox[{"\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}], 
           ",", 
           RowBox[{"\"\<ReIm\>\"", "\[Rule]", "True"}]}], "]"}]}], ";", "\n", 
        
        RowBox[{"parsvars", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ToExpression", "[", 
               RowBox[{"(", 
                RowBox[{"\"\<x\>\"", "<>", 
                 RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
              RowBox[{"ToExpression", "[", 
               RowBox[{"(", 
                RowBox[{"\"\<y\>\"", "<>", 
                 RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}]}], "}"}],
             ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}], 
        ";", "\n", 
        RowBox[{"parsvars", "=", 
         RowBox[{"Join", "[", 
          RowBox[{"parsvars", ",", 
           RowBox[{"{", 
            RowBox[{"Global`M", ",", "Global`a"}], "}"}]}], "]"}]}], ";", 
        "\n", 
        RowBox[{"resall", "=", 
         RowBox[{"CNMinimize", "[", 
          RowBox[{
           RowBox[{"data", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "ov", ",", 
           "parsvars", ",", 
           RowBox[{"{", 
            RowBox[{"Global`t", ",", 
             RowBox[{"data", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"\"\<Bounds\>\"", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
              "0.7", "\[LessEqual]", " ", "Global`M", "\[LessEqual]", " ", 
               "1.5"}], ",", 
              RowBox[{
              "0.", "\[LessEqual]", " ", "Global`a", "\[LessEqual]", " ", 
               "0.99"}]}], "}"}]}], ",", 
           RowBox[{"Method", "\[Rule]", "\"\<NelderMead\>\""}], ",", 
           RowBox[{"MaxIterations", "\[Rule]", "100000"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pars", "=", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Global`M", ",", "Global`a"}], "}"}], "/.", 
          RowBox[{"resall", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"resdata", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"data", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"ov", "/.", 
              RowBox[{"resall", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "/.", 
             RowBox[{"Global`t", "->", 
              RowBox[{"data", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"res2", "=", 
         RowBox[{"Total", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Re", "[", 
              RowBox[{
               RowBox[{"resdata", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
               RowBox[{"data", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", "2"}],
             "+", 
            RowBox[{
             RowBox[{"Im", "[", 
              RowBox[{
               RowBox[{"resdata", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
               RowBox[{"data", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
             "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"res", "=", 
         RowBox[{"Join", "[", 
          RowBox[{"pars", ",", 
           RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0.7", ",", "1.5"}], "}"}], ",", 
             RowBox[{"pars", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0.99"}], "}"}], ",", 
             RowBox[{"pars", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"out", "=", "1"}], ";", 
           RowBox[{"Print", "[", 
            RowBox[{"Style", "[", 
             RowBox[{
              RowBox[{
              "\"\<Parameter estimate touching the boundaries at n = \>\"", "<>", 
               RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
               "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
              "Red"}], "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}], "\n", ",", "\n", 
       
       RowBox[{
        RowBox[{"Print", "[", "\"\<Using grid algorithm\>\"", "]"}], ";", 
        "\n", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", "boundaries"}], "\[Equal]", "0"}], ",", 
          "\n", 
          RowBox[{
           RowBox[{"amin", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"(", "0.995", ")"}]}]}], ";", "\n", 
           RowBox[{"amax", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"(", "1.005", ")"}]}]}], ";", "\n", 
           RowBox[{"mmin", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"(", "0.995", ")"}]}]}], ";", "\n", 
           RowBox[{"mmax", "=", 
            RowBox[{
             RowBox[{"oldpars", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"(", "1.005", ")"}]}]}], ";"}], ",", "\n", 
          RowBox[{
           RowBox[{"amin", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
           RowBox[{"amax", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"2", ",", "2"}], "]"}], "]"}]}], ";", "\n", 
           RowBox[{"mmin", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\n", 
           RowBox[{"mmax", "=", 
            RowBox[{"boundaries", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ";"}]}], "\n", "]"}], 
        ";", "\n", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<M bounds: \>\"", ",", 
          RowBox[{"{", 
           RowBox[{"mmin", ",", "mmax"}], "}"}]}], "]"}], ";", "\n", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<a bounds: \>\"", ",", 
          RowBox[{"{", 
           RowBox[{"amin", ",", "amax"}], "}"}]}], "]"}], ";", "\n", "\n", 
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{"nmax", "\[LessEqual]", "7"}], ",", "\n", "\t", 
          RowBox[{
           RowBox[{"ovi", "=", 
            RowBox[{"OvertoneModel", "[", 
             RowBox[{"nmax", ",", 
              RowBox[{"{", 
               RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
              RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
               RowBox[{"{", "}"}]}], ",", 
              RowBox[{"\"\<Mode\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"2", ",", "2"}], "}"}]}], ",", 
              RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
               RowBox[{"-", "2"}]}], ",", 
              RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}], 
              ",", 
              RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
              RowBox[{
              "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}]}], 
             "]"}]}], ";", "\n", "\t", 
           RowBox[{"parsvars", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"(", 
                 RowBox[{"\"\<x\>\"", "<>", 
                  RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}],
            ";", "\[IndentingNewLine]", "\t", 
           RowBox[{"restab", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"ov", "=", 
                  RowBox[{
                   RowBox[{"ovi", "/.", 
                    RowBox[{"Global`M", "\[Rule]", "mass"}]}], "/.", 
                   RowBox[{"Global`a", "\[Rule]", "spin"}]}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{
                   RowBox[{"NonlinearModelFit", "[", 
                    RowBox[{
                    "data", ",", "ov", ",", "parsvars", ",", "Global`t"}], 
                    "]"}], "[", "\"\<BestFitParameters\>\"", "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"pars", "=", 
                  RowBox[{"Norm", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"mass", ",", "spin"}], "}"}], "-", 
                    RowBox[{"{", 
                    RowBox[{"mfa", ",", "af"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"resdata", "=", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ov", "/.", "res"}], "/.", 
                    RowBox[{"Global`t", "->", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{"Total", "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Re", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"{", 
                  RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], 
                  "}"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], 
                 "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"resmin", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"Quiet", "[", 
            RowBox[{"posresmin", "=", 
             RowBox[{"Position", "[", 
              RowBox[{"restab", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "==", "resmin"}], "&"}], 
                 ")"}]}]}], "]"}]}], "]"}], ";", "\n", "\t", 
           RowBox[{"pars", "=", 
            RowBox[{
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"posresmin", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"res2", "=", "resmin"}], ";", "\n", "\t", 
           RowBox[{"res", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"pars", ",", 
              RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"mmin", ",", "mmax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"amin", ",", "amax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "1"}], ";", 
              RowBox[{"Print", "[", 
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{
                 "\"\<Parameter estimate touching the boundaries at n = \>\"",
                   "<>", 
                  RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
                  "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
                 "Red"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}], "\n", "\t", 
          ",", "\n", "\t", 
          RowBox[{"nmax", "\[Equal]", "8"}], "\n", "\t", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"ovi", "=", 
            RowBox[{"OvertoneModel", "[", 
             RowBox[{"8", ",", 
              RowBox[{"{", 
               RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
              RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
               RowBox[{"{", "}"}]}], ",", 
              RowBox[{"\"\<Mode\>\"", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"2", ",", "2"}], "}"}]}], ",", 
              RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
               RowBox[{"-", "2"}]}], ",", 
              RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}], 
              ",", 
              RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
              RowBox[{"\"\<N89Data\>\"", "\[Rule]", "w228data"}], ",", 
              RowBox[{
              "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}]}], 
             "]"}]}], ";", "\n", "\t", 
           RowBox[{"parsvars", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"(", 
                 RowBox[{"\"\<x\>\"", "<>", 
                  RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}],
            ";", "\[IndentingNewLine]", "\t", 
           RowBox[{"restab", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"ov", "=", 
                  RowBox[{
                   RowBox[{"ovi", "/.", 
                    RowBox[{"Global`M", "\[Rule]", "mass"}]}], "/.", 
                   RowBox[{"Global`a", "\[Rule]", "spin"}]}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{
                   RowBox[{"NonlinearModelFit", "[", 
                    RowBox[{
                    "data", ",", "ov", ",", "parsvars", ",", "Global`t"}], 
                    "]"}], "[", "\"\<BestFitParameters\>\"", "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"pars", "=", 
                  RowBox[{"Norm", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"mass", ",", "spin"}], "}"}], "-", 
                    RowBox[{"{", 
                    RowBox[{"mfa", ",", "af"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"resdata", "=", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ov", "/.", "res"}], "/.", 
                    RowBox[{"Global`t", "->", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{"Total", "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Re", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"{", 
                  RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], 
                  "}"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], 
                 "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"resmin", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"Quiet", "[", 
            RowBox[{"posresmin", "=", 
             RowBox[{"Position", "[", 
              RowBox[{"restab", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "==", "resmin"}], "&"}], 
                 ")"}]}]}], "]"}]}], "]"}], ";", "\n", "\t", 
           RowBox[{"pars", "=", 
            RowBox[{
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"posresmin", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"res2", "=", "resmin"}], ";", "\n", "\t", 
           RowBox[{"res", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"pars", ",", 
              RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"mmin", ",", "mmax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"amin", ",", "amax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "1"}], ";", 
              RowBox[{"Print", "[", 
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{
                 "\"\<Parameter estimate touching the boundaries at n = \>\"",
                   "<>", 
                  RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
                  "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
                 "Red"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}], "\n", "\t", 
          ",", "\n", "\t", 
          RowBox[{"nmax", "\[Equal]", "9"}], "\n", "\t", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"ovi", "=", " ", 
            RowBox[{
             RowBox[{"OvertoneModel", "[", 
              RowBox[{"8", ",", 
               RowBox[{"{", 
                RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
               RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
                RowBox[{"{", "}"}]}], ",", 
               RowBox[{"\"\<Mode\>\"", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"2", ",", "2"}], "}"}]}], ",", 
               RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
                RowBox[{"-", "2"}]}], ",", 
               RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}],
                ",", 
               RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
               RowBox[{"\"\<N89Data\>\"", "\[Rule]", "w228data"}], ",", 
               RowBox[{
               "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}]}], 
              "]"}], "+", "\[IndentingNewLine]", "\t   ", 
             RowBox[{"OvertoneModel", "[", 
              RowBox[{"9", ",", 
               RowBox[{"{", 
                RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
               RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
                RowBox[{"{", "}"}]}], ",", 
               RowBox[{"\"\<Mode\>\"", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"2", ",", "2"}], "}"}]}], ",", 
               RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
                RowBox[{"-", "2"}]}], ",", 
               RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}],
                ",", 
               RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
               RowBox[{"\"\<N89Data\>\"", "\[Rule]", "w229data"}], ",", 
               RowBox[{
               "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}], ",", 
               
               RowBox[{"\"\<Tones\>\"", "\[Rule]", 
                RowBox[{"{", "9", "}"}]}]}], "]"}]}]}], ";", "\n", "\t", 
           RowBox[{"parsvars", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"(", 
                 RowBox[{"\"\<x\>\"", "<>", 
                  RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}],
            ";", "\[IndentingNewLine]", "\t", 
           RowBox[{"restab", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"ov", "=", 
                  RowBox[{
                   RowBox[{"ovi", "/.", 
                    RowBox[{"Global`M", "\[Rule]", "mass"}]}], "/.", 
                   RowBox[{"Global`a", "\[Rule]", "spin"}]}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{
                   RowBox[{"NonlinearModelFit", "[", 
                    RowBox[{
                    "data", ",", "ov", ",", "parsvars", ",", "Global`t"}], 
                    "]"}], "[", "\"\<BestFitParameters\>\"", "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"pars", "=", 
                  RowBox[{"Norm", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"mass", ",", "spin"}], "}"}], "-", 
                    RowBox[{"{", 
                    RowBox[{"mfa", ",", "af"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"resdata", "=", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ov", "/.", "res"}], "/.", 
                    RowBox[{"Global`t", "->", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{"Total", "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Re", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"{", 
                  RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], 
                  "}"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], 
                 "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"resmin", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"Quiet", "[", 
            RowBox[{"posresmin", "=", 
             RowBox[{"Position", "[", 
              RowBox[{"restab", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "==", "resmin"}], "&"}], 
                 ")"}]}]}], "]"}]}], "]"}], ";", "\n", "\t", 
           RowBox[{"pars", "=", 
            RowBox[{
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"posresmin", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"res2", "=", "resmin"}], ";", "\n", "\t", 
           RowBox[{"res", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"pars", ",", 
              RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"mmin", ",", "mmax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"amin", ",", "amax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "1"}], ";", 
              RowBox[{"Print", "[", 
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{
                 "\"\<Parameter estimate touching the boundaries at n = \>\"",
                   "<>", 
                  RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
                  "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
                 "Red"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}], "\n", "\t", 
          ",", "\n", "\t", 
          RowBox[{"nmax", ">", "9"}], "\n", "\t", ",", "\n", "\t", 
          RowBox[{
           RowBox[{"ovi", "=", " ", 
            RowBox[{
             RowBox[{"OvertoneModel", "[", 
              RowBox[{"8", ",", 
               RowBox[{"{", 
                RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
               RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
                RowBox[{"{", "}"}]}], ",", 
               RowBox[{"\"\<Mode\>\"", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"2", ",", "2"}], "}"}]}], ",", 
               RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
                RowBox[{"-", "2"}]}], ",", 
               RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}],
                ",", 
               RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
               RowBox[{"\"\<N89Data\>\"", "\[Rule]", "w228data"}], ",", 
               RowBox[{
               "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}]}], 
              "]"}], "+", "\[IndentingNewLine]", "\t   ", 
             RowBox[{"OvertoneModel", "[", 
              RowBox[{"9", ",", 
               RowBox[{"{", 
                RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
               RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
                RowBox[{"{", "}"}]}], ",", 
               RowBox[{"\"\<Mode\>\"", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"2", ",", "2"}], "}"}]}], ",", 
               RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
                RowBox[{"-", "2"}]}], ",", 
               RowBox[{"\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}],
                ",", 
               RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
               RowBox[{"\"\<N89Data\>\"", "\[Rule]", "w229data"}], ",", 
               RowBox[{
               "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}], ",", 
               
               RowBox[{"\"\<Tones\>\"", "\[Rule]", 
                RowBox[{"{", "9", "}"}]}]}], "]"}]}]}], ";", "\n", "\t", 
           RowBox[{"ovi", " ", "=", " ", 
            RowBox[{"ovi", " ", "+", 
             RowBox[{"(", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{"OvertoneModel", "[", 
                 RowBox[{"n", ",", 
                  RowBox[{"{", 
                   RowBox[{"mfa", ",", "af"}], "}"}], ",", "0", ",", 
                  RowBox[{"\"\<Fit\[Alpha]\>\"", "\[Rule]", 
                   RowBox[{"{", "}"}]}], ",", 
                  RowBox[{"\"\<Mode\>\"", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{"2", ",", "2"}], "}"}]}], ",", 
                  RowBox[{"\"\<SpinWeight\>\"", "\[Rule]", 
                   RowBox[{"-", "2"}]}], ",", 
                  RowBox[{
                  "\"\<\[Omega]lmnFunction\>\"", "->", "\[Omega]lmnPy"}], ",", 
                  RowBox[{"\"\<ReIm\>\"", "\[Rule]", "False"}], ",", 
                  RowBox[{
                  "\"\<Interpolate\[Omega]\[Tau]\>\"", "\[Rule]", "True"}], 
                  ",", 
                  RowBox[{"\"\<Tones\>\"", "\[Rule]", 
                   RowBox[{"{", "n", "}"}]}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", ",", "10", ",", "nmax"}], "}"}]}], "]"}], 
              ")"}]}]}], ";", "\n", "\t", 
           RowBox[{"parsvars", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"ToExpression", "[", 
                RowBox[{"(", 
                 RowBox[{"\"\<x\>\"", "<>", 
                  RowBox[{"ToString", "[", "n", "]"}]}], ")"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "0", ",", "nmax"}], "}"}]}], "]"}], "]"}]}],
            ";", "\[IndentingNewLine]", "\t", 
           RowBox[{"restab", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"ov", "=", 
                  RowBox[{
                   RowBox[{"ovi", "/.", 
                    RowBox[{"Global`M", "\[Rule]", "mass"}]}], "/.", 
                   RowBox[{"Global`a", "\[Rule]", "spin"}]}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{
                   RowBox[{"NonlinearModelFit", "[", 
                    RowBox[{
                    "data", ",", "ov", ",", "parsvars", ",", "Global`t"}], 
                    "]"}], "[", "\"\<BestFitParameters\>\"", "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"pars", "=", 
                  RowBox[{"Norm", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"mass", ",", "spin"}], "}"}], "-", 
                    RowBox[{"{", 
                    RowBox[{"mfa", ",", "af"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", "\t", 
                 RowBox[{"resdata", "=", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ov", "/.", "res"}], "/.", 
                    RowBox[{"Global`t", "->", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], "}"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"res", "=", 
                  RowBox[{"Total", "@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Re", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}], "+", 
                    RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    RowBox[{"resdata", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", 
                    "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", "\t", 
                 RowBox[{"{", 
                  RowBox[{"mass", ",", "spin", ",", "res", ",", "pars"}], 
                  "}"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"mass", ",", "mmin", ",", "mmax", ",", "dm"}], "}"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"spin", ",", "amin", ",", "amax", ",", "da"}], 
                 "}"}]}], "]"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"resmin", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "3"}], "]"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\t", 
           RowBox[{"Quiet", "[", 
            RowBox[{"posresmin", "=", 
             RowBox[{"Position", "[", 
              RowBox[{"restab", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "==", "resmin"}], "&"}], 
                 ")"}]}]}], "]"}]}], "]"}], ";", "\n", "\t", 
           RowBox[{"pars", "=", 
            RowBox[{
             RowBox[{"restab", "[", 
              RowBox[{"[", 
               RowBox[{"posresmin", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", "2"}], "]"}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"res2", "=", "resmin"}], ";", "\n", "\t", 
           RowBox[{"res", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"pars", ",", 
              RowBox[{"{", "res2", "}"}]}], "]"}]}], ";", "\n", "\t", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"mmin", ",", "mmax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "||", 
              RowBox[{"MemberQ", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"amin", ",", "amax"}], "}"}], ",", 
                RowBox[{"pars", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "1"}], ";", 
              RowBox[{"Print", "[", 
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{
                 "\"\<Parameter estimate touching the boundaries at n = \>\"",
                   "<>", 
                  RowBox[{"ToString", "[", "nmax", "]"}], "<>", 
                  "\"\<. Consider to broaden the boundaries.\>\""}], ",", 
                 "Red"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"out", "=", "0"}], ";"}]}], "]"}], ";"}]}], "\n", "]"}],
         ";"}]}], "]"}], ";", "\n", "\n", 
     RowBox[{"Which", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"oldparsnorm", "\[GreaterEqual]", " ", "0.00125"}], " ", "&&",
         " ", 
        RowBox[{"nmax", "<", "5"}]}], ",", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"res", ",", 
         RowBox[{"{", "out", "}"}]}], "]"}], ",", "True", ",", 
       RowBox[{"If", "[", 
        RowBox[{"outgrid", ",", 
         RowBox[{"Join", "[", 
          RowBox[{"res", ",", 
           RowBox[{"{", "out", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"{", "restab", "}"}], "}"}]}], "]"}], ",", 
         RowBox[{"Join", "[", 
          RowBox[{"res", ",", 
           RowBox[{"{", "out", "}"}]}], "]"}]}], "]"}]}], "]"}]}]}], "\n", 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.829795151717819*^9, 3.82979535533125*^9}, {
   3.829795624763452*^9, 3.829795761854959*^9}, {3.829795796755527*^9, 
   3.829795797781239*^9}, {3.829795935468842*^9, 3.82979596375159*^9}, {
   3.829796063659121*^9, 3.829796292160178*^9}, {3.8297964106350117`*^9, 
   3.829796652418686*^9}, {3.8297966838741503`*^9, 3.8297967755082703`*^9}, {
   3.829796828809277*^9, 3.829797159776266*^9}, {3.829797214138565*^9, 
   3.8297972733767853`*^9}, {3.82979730473289*^9, 3.829797387162142*^9}, {
   3.829797426638636*^9, 3.829797505688274*^9}, {3.829797543337813*^9, 
   3.829797573023447*^9}, {3.82979778108792*^9, 3.829797789335741*^9}, {
   3.829797834875762*^9, 3.829797926374855*^9}, {3.82979821790244*^9, 
   3.829798310451235*^9}, 3.8297983944954777`*^9, {3.8297984837110863`*^9, 
   3.829798487670486*^9}, {3.8297985517142067`*^9, 3.8297985535033283`*^9}, 
   3.8297985960774612`*^9, {3.829798664295636*^9, 3.829798667786428*^9}, {
   3.829798714439015*^9, 3.8297987618772573`*^9}, {3.8297996351755047`*^9, 
   3.8297996410512543`*^9}, {3.829799845185315*^9, 3.829799874694036*^9}, {
   3.829799924573017*^9, 3.829799928084923*^9}, {3.829799983650694*^9, 
   3.8298000141202803`*^9}, {3.8298004205287657`*^9, 3.829800458997541*^9}, {
   3.829801072385017*^9, 3.829801163351886*^9}, {3.8298012551352253`*^9, 
   3.829801266500272*^9}, {3.829801354659181*^9, 3.829801360276985*^9}, {
   3.829801416490614*^9, 3.829801419438122*^9}, {3.829801466973069*^9, 
   3.829801477950055*^9}, {3.82980151362551*^9, 3.829801516202326*^9}, {
   3.829801560905869*^9, 3.829801564746935*^9}, {3.829801647560013*^9, 
   3.829801656795576*^9}, {3.82980171817939*^9, 3.829801719839511*^9}, {
   3.829801764509062*^9, 3.829801766563431*^9}, {3.829801825630772*^9, 
   3.8298018293375187`*^9}, {3.8298018743622932`*^9, 
   3.8298019464206047`*^9}, {3.82980206776527*^9, 3.829802109794353*^9}, {
   3.829802143853406*^9, 3.829802146938305*^9}, {3.829802257473068*^9, 
   3.8298022609480658`*^9}, {3.8298023808622427`*^9, 3.829802384217052*^9}, {
   3.829802911761827*^9, 3.8298029334151993`*^9}, 3.829803107312368*^9, {
   3.829803236254857*^9, 3.829803247529263*^9}, {3.8298032943914213`*^9, 
   3.829803446468729*^9}, {3.829803528381343*^9, 3.829803541434257*^9}, {
   3.8298035788962173`*^9, 3.829803579086892*^9}, {3.829803629648423*^9, 
   3.8298036327921877`*^9}, {3.829803807319075*^9, 3.8298038676283283`*^9}, {
   3.82980390754274*^9, 3.829803908199774*^9}, {3.829803947548326*^9, 
   3.829803948693696*^9}, {3.829804073135352*^9, 3.829804079853216*^9}, {
   3.829804229176856*^9, 3.8298043161682262`*^9}, {3.82980454558638*^9, 
   3.829804546878955*^9}, {3.829804680899149*^9, 3.829804690229598*^9}, {
   3.829805691306633*^9, 3.829805715195068*^9}, {3.82980582388442*^9, 
   3.829805840597286*^9}, {3.8298992060425577`*^9, 3.829899212980274*^9}, {
   3.829899970479845*^9, 3.829899970582829*^9}, {3.8299000582895107`*^9, 
   3.829900060587331*^9}, {3.829900281682353*^9, 3.8299002817420607`*^9}, {
   3.829901058786983*^9, 3.829901059645993*^9}, {3.8299023301683083`*^9, 
   3.829902337052291*^9}, {3.8299673053575773`*^9, 3.8299673311007633`*^9}, {
   3.829968275038653*^9, 3.8299683762763233`*^9}, {3.829968414809895*^9, 
   3.829968415657271*^9}, {3.829968457540099*^9, 3.829968461607525*^9}, {
   3.829968967287836*^9, 3.829968969415331*^9}, {3.829969063951148*^9, 
   3.829969075770522*^9}, {3.8299706633590918`*^9, 3.829970665296535*^9}, {
   3.829982182279601*^9, 3.829982261711389*^9}, {3.829982352396055*^9, 
   3.829982356948909*^9}, {3.830047585260672*^9, 3.830047586539856*^9}, {
   3.830228642335013*^9, 3.83022864638517*^9}, {3.8302286916125727`*^9, 
   3.8302286945507917`*^9}, {3.830228746486011*^9, 
   3.8302288174872017`*^9}},ExpressionUUID->"5023ea2b-257c-4bb8-b6a2-\
9d130a052cc0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["AIC,BIC, PValue", "Subsection",
 CellChangeTimes->{{3.785048243361456*^9, 
  3.7850482482750387`*^9}},ExpressionUUID->"3fb109b0-2e0f-4e1e-a4da-\
311a2f2e096d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "AICcRes", "]"}], "=", 
   RowBox[{"Options", "[", "AICcRes", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"AICcRes", "[", 
   RowBox[{"res_", ",", "coeff_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "err", ",", "n", ",", "newfit", ",", "bracketedvars", ",", "ress", ",", 
      "weigths"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"err", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"n", "=", 
      RowBox[{"Length", "@", "res"}]}], ";", "\n", 
     RowBox[{"ress", "=", 
      RowBox[{"Total", "[", 
       RowBox[{"err", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Abs", "[", 
           StyleBox["res", "Code"], 
           StyleBox["]", "Code"]}], ")"}], "^", "2"}]}], "]"}]}], ";", "\n", 
     RowBox[{"n", " ", "+", " ", 
      RowBox[{"n", " ", 
       RowBox[{"Log", "[", 
        RowBox[{"2", "\[Pi]"}], "]"}]}], "+", 
      RowBox[{"n", " ", 
       RowBox[{"Log", "[", 
        RowBox[{"ress", "/", "n"}], "]"}]}], "+", 
      FractionBox[
       RowBox[{"2", "*", "coeff", 
        RowBox[{"(", 
         RowBox[{"coeff", "+", "1"}], ")"}], " "}], 
       RowBox[{"n", " ", "-", " ", "coeff", " ", "-", "1"}]]}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.684235123940609*^9, 3.684235178622861*^9}, {
   3.6842352304450693`*^9, 3.684235266801034*^9}, {3.6842357209981833`*^9, 
   3.684235721420925*^9}, {3.6842358004206553`*^9, 3.684235829618177*^9}, {
   3.684235871562796*^9, 3.684235953109355*^9}, {3.6842359930084677`*^9, 
   3.68423600045492*^9}, {3.684236046190096*^9, 3.684236136607703*^9}, {
   3.684236230675322*^9, 3.6842363351919537`*^9}, {3.6842363978154163`*^9, 
   3.684236597490655*^9}, {3.684237002736021*^9, 3.684237003142733*^9}, {
   3.684237052308125*^9, 3.6842370616346483`*^9}, {3.684237563942689*^9, 
   3.684237626100822*^9}, {3.684237832420291*^9, 3.684237874906782*^9}, {
   3.778390463654558*^9, 3.778390511054487*^9}, {3.778390544683858*^9, 
   3.778390549680479*^9}, {3.77839066811514*^9, 3.778390685263955*^9}, {
   3.778391716414667*^9, 3.7783917695790033`*^9}, {3.77891899937022*^9, 
   3.778919008973011*^9}, 3.778921364633644*^9, 3.778924393733334*^9, {
   3.7789244317694817`*^9, 3.778924436818432*^9}, {3.7991208774828587`*^9, 
   3.799120878619252*^9}, 3.823315347473312*^9, 3.823316089687662*^9, {
   3.823316131577354*^9, 
   3.8233161404304132`*^9}},ExpressionUUID->"7d702440-ce11-4f2f-a3fd-\
860210f78382"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "BICRes", "]"}], "=", 
   RowBox[{"Options", "[", "AICcRes", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"BICRes", "[", 
   RowBox[{"res_", ",", "coeff_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "err", ",", "fact1", ",", "fact2", ",", "n", ",", "newfit", ",", 
      "bracketedvars", ",", "ress", ",", "weigths"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"err", "=", "1"}], ";", "\[IndentingNewLine]", 
     RowBox[{"n", "=", 
      RowBox[{"Length", "@", "res"}]}], ";", "\n", 
     RowBox[{"ress", "=", 
      RowBox[{"Total", "[", 
       RowBox[{"err", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Abs", "[", 
           StyleBox["res", "Code"], 
           StyleBox["]", "Code"]}], ")"}], "^", "2"}]}], "]"}]}], ";", "\n", 
     RowBox[{"n", " ", "+", " ", 
      RowBox[{"n", " ", 
       RowBox[{"Log", "[", 
        RowBox[{"2", "\[Pi]"}], "]"}]}], "+", 
      RowBox[{"n", " ", 
       RowBox[{"Log", "[", 
        RowBox[{"ress", "/", "n"}], "]"}]}], "+", 
      RowBox[{
       RowBox[{"Log", "[", "n", "]"}], 
       RowBox[{"(", 
        RowBox[{"coeff", "+", "1"}], ")"}]}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.684235123940609*^9, 3.684235178622861*^9}, {
   3.6842352304450693`*^9, 3.684235266801034*^9}, {3.6842357209981833`*^9, 
   3.684235721420925*^9}, {3.6842358004206553`*^9, 3.684235829618177*^9}, {
   3.684235871562796*^9, 3.684235953109355*^9}, {3.6842359930084677`*^9, 
   3.68423600045492*^9}, {3.684236046190096*^9, 3.684236136607703*^9}, {
   3.684236230675322*^9, 3.6842363351919537`*^9}, {3.6842363978154163`*^9, 
   3.684236597490655*^9}, {3.684237002736021*^9, 3.684237003142733*^9}, {
   3.684237052308125*^9, 3.6842370616346483`*^9}, {3.684237563942689*^9, 
   3.684237626100822*^9}, {3.684237832420291*^9, 3.684237874906782*^9}, {
   3.778390463654558*^9, 3.778390511054487*^9}, {3.778390544683858*^9, 
   3.778390549680479*^9}, {3.77839066811514*^9, 3.778390685263955*^9}, {
   3.778391716414667*^9, 3.7783917695790033`*^9}, {3.77891899937022*^9, 
   3.778919008973011*^9}, {3.7789192361692877`*^9, 3.778919242750613*^9}, {
   3.778919293657011*^9, 3.7789192947423*^9}, {3.778919868815625*^9, 
   3.778919947193172*^9}, {3.778920001593031*^9, 3.7789200018414392`*^9}, {
   3.778921044343191*^9, 3.7789210576462603`*^9}, {3.778921143854371*^9, 
   3.778921144927823*^9}, {3.778921344987707*^9, 3.778921347063178*^9}, {
   3.778924392256567*^9, 3.778924429472744*^9}, {3.778924579590026*^9, 
   3.778924601567306*^9}, {3.778924645350624*^9, 3.7789246674167833`*^9}, 
   3.799120895846953*^9, {3.8000775279579363`*^9, 3.8000775281291723`*^9}, {
   3.823316105628648*^9, 
   3.823316121421175*^9}},ExpressionUUID->"6a85250f-5ba5-40dd-bedb-\
945dda498b2a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "PValueTest", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<IRoot\>\"", "\[Rule]", "10"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PValueTest", "[", 
   RowBox[{"dfnum_", ",", "dfden_", ",", "signl_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"xmax", ",", "iroot"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"iroot", "=", 
      RowBox[{"OptionValue", "[", "\"\<IRoot\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"xmax", "/.", 
      RowBox[{"FindRoot", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{"PDF", "[", 
            RowBox[{
             RowBox[{"FRatioDistribution", "[", 
              RowBox[{"dfnum", ",", "dfden"}], "]"}], ",", "x"}], "]"}], ",", 
           
           RowBox[{"{", 
            RowBox[{"x", ",", "0", ",", "xmax"}], "}"}]}], "]"}], "\[Equal]", 
         
         RowBox[{"1", "-", "signl"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"xmax", ",", "iroot"}], "}"}]}], "]"}]}]}]}], 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.778993361891452*^9, 3.778993440441951*^9}, {
  3.778993491640397*^9, 3.778993500693678*^9}, {3.778993679624543*^9, 
  3.77899367996894*^9}, {3.778993763369728*^9, 3.778993854199657*^9}, {
  3.778994067826223*^9, 3.7789941443716707`*^9}},
 CellLabel->"In[98]:=",ExpressionUUID->"dedb7461-041a-428c-ba62-81c1dfe604f2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Hessian", "Subsection",
 CellChangeTimes->{{3.802757124788665*^9, 
  3.802757126851701*^9}},ExpressionUUID->"b61aad9d-e98e-437e-a004-\
cd413d8c988d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HessianH", "[", 
   RowBox[{"f_", ",", 
    RowBox[{"t_List", "?", "VectorQ"}]}], "]"}], ":=", 
  RowBox[{"D", "[", 
   RowBox[{"f", ",", 
    RowBox[{"{", 
     RowBox[{"t", ",", "2"}], "}"}]}], "]"}]}]], "Code",
 CellLabel->
  "In[1212]:=",ExpressionUUID->"13ac9a81-9d77-4f4b-af91-eab343cd4c48"]
}, Closed]],

Cell[CellGroupData[{

Cell["CovarianceMatrix", "Subsection",
 CellChangeTimes->{{3.802757124788665*^9, 3.802757126851701*^9}, {
  3.80275721922922*^9, 
  3.802757223544718*^9}},ExpressionUUID->"dba93d7b-960f-45f3-b934-\
e70e75787766"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "CovarianceMatrix", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<Tolerance\>\"", "\[Rule]", 
     RowBox[{"10", "^", 
      RowBox[{"(", 
       RowBox[{"-", "32"}], ")"}]}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"CovarianceMatrix", "[", 
   RowBox[{"res_", ",", "pars_", ",", "truepars_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "length", ",", "hessian", ",", "tol", ",", "resreim", ",", "Xx", ",", 
      "Xxre", ",", "Xxim"}], "}"}], ",", "\n", "\n", 
    RowBox[{
     RowBox[{"tol", "=", 
      RowBox[{"OptionValue", "[", "\"\<Tolerance\>\"", "]"}]}], ";", "\n", 
     RowBox[{"length", "=", 
      RowBox[{"Length", "@", "res"}]}], ";", "\n", 
     RowBox[{"Xxre", "=", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"ComplexExpand", "/@", 
          RowBox[{"Re", "[", "res", "]"}]}], ")"}], "^", "2"}], "]"}]}], ";", 
     "\n", 
     RowBox[{"Xxim", "=", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"ComplexExpand", "/@", 
          RowBox[{"Im", "[", "res", "]"}]}], ")"}], "^", "2"}], "]"}]}], ";", 
     "\n", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Xx", "=", 
        RowBox[{"Total", "[", 
         RowBox[{
          RowBox[{"Xxre", "^", "2"}], "+", 
          RowBox[{"Xxim", "^", "2"}]}], "]"}]}], ";"}], "*)"}], "\n", 
     RowBox[{"hessian", "=", 
      RowBox[{
       RowBox[{"Rationalize", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"HessianH", "[", 
           RowBox[{
            RowBox[{"Log", "[", "Xxre", "]"}], ",", "pars"}], "]"}], "/.", 
          "truepars"}], ",", "tol"}], "]"}], "+", 
       RowBox[{"Rationalize", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"HessianH", "[", 
           RowBox[{
            RowBox[{"Log", "[", "Xxim", "]"}], ",", "pars"}], "]"}], "/.", 
          "truepars"}], ",", "tol"}], "]"}]}]}], ";", "\n", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"2", " ", 
         RowBox[{"Inverse", "[", "hessian", "]"}]}], ")"}], "/", 
       RowBox[{"(", 
        RowBox[{"length", "-", 
         RowBox[{"Length", "@", "pars"}]}], ")"}]}], "*", "1."}]}]}], 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.827561640821619*^9, 3.8275616438058653`*^9}, {
   3.827561675941565*^9, 3.827561721218945*^9}, {3.8275618232709427`*^9, 
   3.827561833153376*^9}, {3.827561867601123*^9, 3.827561931904295*^9}, {
   3.82756199221276*^9, 3.827562015119063*^9}, {3.82756217708571*^9, 
   3.827562248348362*^9}, {3.827562396817027*^9, 3.827562407988686*^9}, {
   3.8275624604775248`*^9, 3.827562494974729*^9}, 3.827563847952742*^9},
 CellLabel->
  "In[2806]:=",ExpressionUUID->"7537f657-25b6-48d1-a353-49b3b67ca0c0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fisher Matrix", "Subsection",
 CellChangeTimes->{{3.802757124788665*^9, 3.802757126851701*^9}, {
  3.80275721922922*^9, 3.802757223544718*^9}, {3.827561226444631*^9, 
  3.82756122752232*^9}},ExpressionUUID->"c7ab2675-b8fa-49b3-8be9-\
d76cf195c71b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FisherMatrix", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<Times\>\"", "\[Rule]", 
     RowBox[{"{", "}"}]}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"FisherMatrix", "[", 
   RowBox[{"f_", ",", 
    RowBox[{"par_List", "?", "VectorQ"}], ",", 
    RowBox[{"truepars_List", "?", "VectorQ"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "derre", ",", "derim", ",", "fm", ",", "fmim", ",", "fmre", ",", "fre", 
      ",", "fim", ",", "times"}], "}"}], ",", "\n", "\n", 
    RowBox[{
     RowBox[{"times", "=", 
      RowBox[{"OptionValue", "[", "\"\<Times\>\"", "]"}]}], ";", "\n", 
     RowBox[{"fre", "=", 
      RowBox[{"ComplexExpand", "[", 
       RowBox[{"Re", "[", "f", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"fim", "=", 
      RowBox[{"ComplexExpand", "[", 
       RowBox[{"Im", "[", "f", "]"}], "]"}]}], ";", "\n", 
     "\[IndentingNewLine]", 
     RowBox[{"derre", "=", 
      RowBox[{"D", "[", 
       RowBox[{"fre", ",", 
        RowBox[{"{", 
         RowBox[{"par", ",", "1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fmre", "=", 
      RowBox[{"Outer", "[", 
       RowBox[{"Times", ",", "derre", ",", "derre"}], "]"}]}], ";", "\n", 
     "\n", 
     RowBox[{"derim", "=", 
      RowBox[{"D", "[", 
       RowBox[{"fim", ",", 
        RowBox[{"{", 
         RowBox[{"par", ",", "1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fmim", "=", 
      RowBox[{"Outer", "[", 
       RowBox[{"Times", ",", "derim", ",", "derim"}], "]"}]}], ";", "\n", 
     "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "times"}], "\[NotEqual]", "0"}], ",", "\n", 
       RowBox[{
        RowBox[{"fm", "=", 
         RowBox[{"2", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"fmre", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "/.", 
                RowBox[{"t", "->", "times"}]}], "/.", "truepars"}], "]"}], 
             "+", 
             RowBox[{"Total", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"fmim", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], "/.", 
                RowBox[{"t", "->", "times"}]}], "/.", "truepars"}], "]"}]}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "@", "par"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"Length", "@", "par"}]}], "}"}]}], "]"}]}]}], ";"}]}], 
      "]"}], ";", "\n", "\n", 
     RowBox[{"2", "*", 
      RowBox[{
       RowBox[{"Inverse", "[", "fm", "]"}], "/", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Length", "@", "times"}], "-", 
         RowBox[{"Length", "@", "par"}]}], ")"}]}], "*", "1."}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.827555859712697*^9, 3.8275559733725157`*^9}, {
   3.827556117177678*^9, 3.827556117768808*^9}, 3.827556148292111*^9, {
   3.827556318980529*^9, 3.827556332501766*^9}, {3.82755636487707*^9, 
   3.827556642427915*^9}, {3.827556677461554*^9, 3.827556679899683*^9}, {
   3.827556734989442*^9, 3.827556743335623*^9}, {3.8275568205053596`*^9, 
   3.827556992854287*^9}, {3.827557033868394*^9, 3.827557121716181*^9}, {
   3.8275572850224133`*^9, 3.827557347287478*^9}, {3.827557527764318*^9, 
   3.827557632062366*^9}, {3.8275577064862967`*^9, 3.827557807351696*^9}, {
   3.8275578386213093`*^9, 3.8275578540495996`*^9}, {3.8275578992699738`*^9, 
   3.8275580265568123`*^9}, {3.827558063118853*^9, 3.827558099585601*^9}, {
   3.827562597627738*^9, 3.827562601607093*^9}, {3.827563696807526*^9, 
   3.827563737902831*^9}, {3.827563794763934*^9, 3.8275638033155327`*^9}},
 CellLabel->
  "In[2802]:=",ExpressionUUID->"bf228923-5976-475f-a5dd-a7fe054bc1b4"]
}, Closed]],

Cell[CellGroupData[{

Cell["CovarianceMatrix from Likelihood", "Subsection",
 CellChangeTimes->{{3.827472058020046*^9, 
  3.827472065155109*^9}},ExpressionUUID->"1b53d0ad-d029-4178-8006-\
e180da31053b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CovarianceMatrixFromLikelihood", "[", "data_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "cnorm", ",", "datan", ",", "datanfreq", ",", "datain", ",", "dom", ",", 
      "kdist", ",", "vars", ",", "varsdom"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"datain", "=", 
      RowBox[{"Interpolation", "@", "data"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dom", "=", 
      RowBox[{"InterpolationDomain", "[", "datain", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"datan", "=", "data"}], ";", "\[IndentingNewLine]", 
     RowBox[{"vars", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"\"\<x\>\"", "<>", 
          RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{
           RowBox[{"Length", "@", 
            RowBox[{"data", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "-", "1"}]}], "}"}]}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"varsdom", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{"\"\<x\>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}]}], "]"}], ",", 
          RowBox[{"dom", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"dom", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "vars"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\n", 
     RowBox[{"cnorm", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"NIntegrate", "[", 
         RowBox[{
          RowBox[{"datain", "@@", "vars"}], ",", "##"}], "]"}], "&"}], "@@", 
       "varsdom"}]}], ";", "\n", 
     RowBox[{
      RowBox[{"datan", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{"-", "1"}]}], "]"}], "]"}], "=", 
      RowBox[{
       RowBox[{"datan", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"-", "1"}]}], "]"}], "]"}], "/", "cnorm"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"datanfreq", "=", 
      RowBox[{
       RowBox[{"datan", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"1", ";;", 
           RowBox[{"-", "2"}]}]}], "]"}], "]"}], 
       RowBox[{"datan", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"kdist", "=", 
      RowBox[{"KernelMixtureDistribution", "[", "datanfreq", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"2", " ", 
      RowBox[{"Covariance", "[", "kdist", "]"}]}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.827469564564189*^9, 3.8274697215727177`*^9}, {
   3.8274713774744368`*^9, 3.8274715928069973`*^9}, {3.827471634435511*^9, 
   3.8274717191042767`*^9}, {3.827471810053816*^9, 3.827471919664874*^9}, {
   3.827471974560907*^9, 3.827471999949286*^9}, {3.827472068877118*^9, 
   3.827472075737906*^9}, 3.827552947931313*^9, {3.827559603869341*^9, 
   3.827559634042197*^9}, {3.82755967664104*^9, 3.827559677204485*^9}, {
   3.827822611773356*^9, 
   3.8278226156537037`*^9}},ExpressionUUID->"c820acf3-75e6-4f7d-b4c0-\
c079d1b1a54b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["CorrelationMatrix", "Subsection",
 CellChangeTimes->{{3.802757124788665*^9, 3.802757126851701*^9}, {
  3.80275721922922*^9, 3.802757223544718*^9}, {3.8027668558212442`*^9, 
  3.802766860241334*^9}},ExpressionUUID->"a9bc9d33-bdba-47c7-be28-\
d07298294e0f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "CorrelationMatrix", "]"}], "=", 
   RowBox[{"Options", "[", "CovarianceMatrix", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"CorrelationMatrix", "[", 
   RowBox[{"res2_", ",", "pars_", ",", "truepars_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "Ds", ",", "Dsi", ",", "covmat", ",", "length", ",", "hessian", ",", 
      "tol", ",", "Xx"}], "}"}], ",", "\n", "\n", 
    RowBox[{
     RowBox[{"tol", "=", 
      RowBox[{"OptionValue", "[", "\"\<Tolerance\>\"", "]"}]}], ";", "\n", 
     "\n", 
     RowBox[{"covmat", "=", 
      RowBox[{"CovarianceMatrix", "[", 
       RowBox[{"res2", ",", "pars", ",", "truepars"}], "]"}]}], ";", "\n", 
     RowBox[{"Ds", "=", 
      RowBox[{"Rationalize", "[", 
       RowBox[{
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{"Diagonal", "[", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"Re", "@", "covmat"}], "]"}], "]"}], "]"}], ",", "tol"}], 
       "]"}]}], ";", "\n", 
     RowBox[{"Dsi", "=", 
      RowBox[{"Inverse", "[", "Ds", "]"}]}], ";", "\n", "\n", 
     RowBox[{"Dsi", ".", "covmat", ".", "Dsi"}]}]}], "\n", "]"}]}]}], "Code",
 CellChangeTimes->{{3.802757290050189*^9, 3.802757353192521*^9}, {
  3.802757385445712*^9, 3.802757411931959*^9}, {3.8027656834313602`*^9, 
  3.8027658382638407`*^9}, {3.80276587030466*^9, 3.802765876862022*^9}, {
  3.8027659607872257`*^9, 3.8027661142159157`*^9}, {3.802769072592805*^9, 
  3.8027690765913773`*^9}, {3.802769206917276*^9, 3.802769207228895*^9}, {
  3.827286381532948*^9, 3.827286428141796*^9}, {3.827289162739324*^9, 
  3.827289165152698*^9}},ExpressionUUID->"6bab5000-e2f8-427a-ba11-\
1204ddbefb7f"]
}, Closed]],

Cell[CellGroupData[{

Cell["Likelihood", "Subsection",
 CellChangeTimes->{{3.802757124788665*^9, 3.802757126851701*^9}, {
  3.80275721922922*^9, 3.802757223544718*^9}, {3.8027668558212442`*^9, 
  3.802766860241334*^9}, {3.8032657855617037`*^9, 
  3.8032657882922363`*^9}},ExpressionUUID->"12c8876a-c64d-4290-8878-\
8eb3e5701ba2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LogLikelihoodDist", "[", 
   RowBox[{"data_", ",", "ansatz_", ",", "vars_", ",", "x_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "ansatzlist", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ansatzlist", "=", 
      RowBox[{
       RowBox[{"ansatz", "/.", "vars"}], "/.", 
       RowBox[{"x", "->", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"-", 
      RowBox[{"Total", "[", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Re", "[", 
           RowBox[{"ansatzlist", "-", 
            RowBox[{"data", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", "2"}], 
         "+", 
         RowBox[{
          RowBox[{"Im", "[", 
           RowBox[{"ansatzlist", "-", 
            RowBox[{"data", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}], "^", "2"}]}], 
        ")"}], "]"}]}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.80326588158187*^9, 3.803265900398424*^9}, {
   3.80326594384317*^9, 3.803265976645152*^9}, {3.803266029498752*^9, 
   3.803266046171425*^9}, 3.8032663623440313`*^9, {3.8032664185243607`*^9, 
   3.8032664239708*^9}, 
   3.803266515100753*^9},ExpressionUUID->"72d8e435-9512-41f3-b3e3-\
fabb20494140"]
}, Closed]],

Cell[CellGroupData[{

Cell["ComputeFitBands", "Subsection",
 CellChangeTimes->{{3.803794084771727*^9, 
  3.803794088912798*^9}},ExpressionUUID->"dee804bd-b0af-49a8-b409-\
454c7f6d8710"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ComputeFitBands", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"\"\<ConfidenceLevel\>\"", "\[Rule]", "0.9"}], "}"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"ComputeFitBands", "[", 
   RowBox[{"data_", ",", "ansatz_", ",", "vars_", ",", "pars_", ",", 
    RowBox[{
     RowBox[{"OptionsPattern", "[", "]"}], ";"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "ansatzv", ",", "colevel", ",", "covmat", ",", "dvec", ",", "lower", ",",
       "res", ",", "resce", ",", "resre", ",", "resim", ",", "times", ",", 
      "tval", ",", "Xx", ",", "upper", ",", "a1"}], "}"}], ",", "\n", "\n", 
    RowBox[{
     RowBox[{"colevel", "=", 
      RowBox[{"OptionValue", "[", "\"\<ConfidenceLevel\>\"", "]"}]}], ";", 
     "\n", 
     RowBox[{"tval", "=", 
      RowBox[{
       RowBox[{"StudentTCI", "[", 
        RowBox[{"0", ",", "1", ",", 
         RowBox[{"Length", "@", "vars"}], ",", 
         RowBox[{"ConfidenceLevel", "\[Rule]", "colevel"}]}], "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\n", 
     RowBox[{"res", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"ansatz", "/.", 
         RowBox[{"t", "\[Rule]", 
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], ")"}], "-", 
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], ";", "\n", "\n", 
     RowBox[{"resce", "=", 
      RowBox[{"ComplexExpand", "@", 
       RowBox[{"Total", "[", "res", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(", 
      RowBox[{"resre", "=", 
       RowBox[{"Simplify", "[", 
        RowBox[{
         RowBox[{"Re", "[", 
          RowBox[{"ComplexExpand", "[", "resce", "]"}], "]"}], ",", 
         RowBox[{"Element", "[", 
          RowBox[{"vars", ",", "Reals"}], "]"}]}], "]"}]}], ")"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(", 
      RowBox[{"resim", "=", 
       RowBox[{"Simplify", "[", 
        RowBox[{
         RowBox[{"Im", "[", 
          RowBox[{"ComplexExpand", "[", "resce", "]"}], "]"}], ",", 
         RowBox[{"Element", "[", 
          RowBox[{"vars", ",", "Reals"}], "]"}]}], "]"}]}], ")"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Xx", "=", 
      RowBox[{
       RowBox[{"resre", "^", "2"}], "+", 
       RowBox[{"resim", "^", "2"}]}]}], ";", "\n", "\n", 
     RowBox[{"covmat", "=", 
      RowBox[{"CovarianceMatrix", "[", 
       RowBox[{"Xx", ",", 
        RowBox[{"Length", "@", "res"}], ",", "vars", ",", "pars"}], "]"}]}], 
     ";", "\n", 
     RowBox[{"times", "=", 
      RowBox[{"data", "[", 
       RowBox[{"[", 
        RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", "\n", "\n", 
     RowBox[{"lower", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"times", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"ansatzv", "=", 
            RowBox[{"ansatz", "/.", 
             RowBox[{"t", "\[Rule]", 
              RowBox[{"times", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}]}], ";", 
           RowBox[{"dvec", "=", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{"ansatzv", ",", 
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"Length", "@", "vars"}]}], "}"}]}], "]"}], "/.", 
             "pars"}]}], ";", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"ansatzv", "/.", "pars"}], ")"}], "-", 
            RowBox[{"tval", " ", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"dvec", ".", "covmat", ".", "dvec"}], "]"}]}]}]}]}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "times"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"upper", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"times", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"ansatzv", "=", 
            RowBox[{"ansatz", "/.", 
             RowBox[{"t", "\[Rule]", 
              RowBox[{"times", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}]}], ";", 
           RowBox[{"dvec", "=", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"D", "[", 
                RowBox[{"ansatzv", ",", 
                 RowBox[{"vars", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"Length", "@", "vars"}]}], "}"}]}], "]"}], "/.", 
             "pars"}]}], ";", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"ansatzv", "/.", "pars"}], ")"}], "+", 
            RowBox[{"tval", " ", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"dvec", ".", "covmat", ".", "dvec"}], "]"}]}]}]}]}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "times"}]}], "}"}]}], "]"}]}], ";", "\n", 
     RowBox[{"{", 
      RowBox[{"lower", ",", "upper"}], "}"}]}]}], "\n", "]"}]}]}], "Code",
 CellChangeTimes->{{3.8037958673712273`*^9, 3.803795897737733*^9}, {
   3.803797318419023*^9, 3.803797342571529*^9}, {3.8037982144198027`*^9, 
   3.8037982410650873`*^9}, {3.803798271238851*^9, 3.8037982810199957`*^9}, {
   3.8037989443273*^9, 3.803798946863171*^9}, {3.803798984831874*^9, 
   3.803798987396311*^9}, 3.803799415565712*^9},
 CellLabel->
  "In[124]:=",ExpressionUUID->"c9bab878-fbe8-4b7f-8c22-214c6b0dddbd"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section",ExpressionUUID->"f1741b14-531a-4442-958b-fde3bfdb7b10"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Code",
 InitializationCell->True,
 CellLabel->
  "In[100]:=",ExpressionUUID->"c8870d35-e01d-4f7c-b081-273dc39f3a98"]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{Full, Full},
WindowMargins->{{0, Automatic}, {-71, Automatic}},
FrontEndVersion->"12.1 for Mac OS X x86 (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"956b2d33-ec88-4e3e-884d-1f1e744b3471"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 235, 4, 98, "Title",ExpressionUUID->"412e446d-949d-4a39-ab8f-2e74aab963be"],
Cell[660, 21, 263, 4, 45, "Subtitle",ExpressionUUID->"03c7a68d-9296-477d-858e-f28f41a96ef7"],
Cell[926, 27, 368, 7, 31, "Subsubtitle",ExpressionUUID->"1dd49449-a8ac-466f-9155-195dee63ff9f"],
Cell[CellGroupData[{
Cell[1319, 38, 381, 6, 32, "Item",ExpressionUUID->"5790c103-deb7-4616-bb6c-3201fb52dcfe"],
Cell[1703, 46, 336, 5, 32, "Item",ExpressionUUID->"44de3030-71f6-405b-999e-75aa76f5f611"]
}, Open  ]],
Cell[2054, 54, 178, 2, 35, "Text",ExpressionUUID->"9611da95-c63f-4174-ad5e-d05a8caf1d44"],
Cell[2235, 58, 217, 4, 35, "Text",ExpressionUUID->"d61a9f74-a8b4-4661-9a96-0aec3ba57e56"],
Cell[CellGroupData[{
Cell[2477, 66, 215, 4, 30, "Input",ExpressionUUID->"a1f69d5a-b9e3-4ac3-bb4b-3dd65921ebf2"],
Cell[2695, 72, 217, 4, 34, "Output",ExpressionUUID->"e52ecc04-dd93-44fa-bf04-eba729865c06"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2949, 81, 158, 3, 67, "Section",ExpressionUUID->"d1f4fc7b-0fc3-4dfa-87e1-5cab3334f1ef"],
Cell[3110, 86, 860, 15, 72, "Code",ExpressionUUID->"73646baf-e1d8-48be-b891-b1d31c1d0092"],
Cell[3973, 103, 554, 12, 72, "Code",ExpressionUUID->"828ec0b2-1cf2-4758-bcca-85b82aa6f9c9"]
}, Closed]],
Cell[CellGroupData[{
Cell[4564, 120, 156, 3, 53, "Section",ExpressionUUID->"62bc7e4c-e5f8-44b8-8aaf-b650c91c7ebe"],
Cell[CellGroupData[{
Cell[4745, 127, 11481, 254, 908, "Code",ExpressionUUID->"efab591e-4b89-4ab2-bcfe-eef66d3d6303"],
Cell[16229, 383, 327, 5, 34, "Output",ExpressionUUID->"0be03423-29ca-4271-846a-5cb15f96b4ee"]
}, Closed]],
Cell[CellGroupData[{
Cell[16593, 393, 220, 3, 46, "Code",ExpressionUUID->"ee552dc2-de40-46d1-94d7-658affe7b6fa"],
Cell[16816, 398, 170, 2, 34, "Output",ExpressionUUID->"bf129224-bf14-4b14-aa95-527577db3c7e"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[17035, 406, 352, 6, 67, "Section",ExpressionUUID->"ce20086e-e551-498e-b1a1-dd3723b02cc4"],
Cell[CellGroupData[{
Cell[17412, 416, 215, 4, 54, "Subsection",ExpressionUUID->"964e5ea4-c776-451f-948b-bb9802afe3ef"],
Cell[17630, 422, 2905, 79, 281, "Code",ExpressionUUID->"acd9a80b-e291-43b4-8ff4-1cf9230d8178"]
}, Closed]],
Cell[CellGroupData[{
Cell[20572, 506, 220, 4, 38, "Subsection",ExpressionUUID->"356b8483-9e89-4e97-a126-f1f283137492"],
Cell[20795, 512, 649, 17, 72, "Code",ExpressionUUID->"1d7c374f-07e5-4e30-96cb-5384d03c28d7"],
Cell[21447, 531, 2048, 55, 357, "Code",ExpressionUUID->"44421514-cbe3-43d9-a22a-ae2f79f87679"],
Cell[23498, 588, 3015, 87, 224, "Code",ExpressionUUID->"2c5ed9b6-4222-400a-b38f-6974d610d5ff"],
Cell[26516, 677, 1318, 33, 300, "Code",ExpressionUUID->"4d6816fc-0043-4b06-b78b-bf0c073e819b"],
Cell[27837, 712, 2461, 66, 262, "Code",ExpressionUUID->"eb6e4d3b-ad4a-48e6-bb7d-c0810255f29d"],
Cell[30301, 780, 1025, 28, 167, "Code",ExpressionUUID->"f6f26bfb-56ea-4ac2-93fe-b97ba55f21e4"],
Cell[31329, 810, 1552, 47, 110, "Code",ExpressionUUID->"e92bdec3-aab4-44bb-9eb8-e8593dedbc5d",
 InitializationCell->True],
Cell[32884, 859, 420, 11, 52, "Code",ExpressionUUID->"468673e1-1d1a-410f-9fbc-3a840631d046"],
Cell[33307, 872, 245, 5, 52, "Code",ExpressionUUID->"66e2ce9e-8bca-4f1a-be52-019a85583e21"],
Cell[33555, 879, 305, 7, 52, "Code",ExpressionUUID->"eb24db11-1413-4288-bb86-fd01706cab41"],
Cell[33863, 888, 3740, 98, 547, "Code",ExpressionUUID->"e0b2f90b-4851-4681-a707-93dfa51b950f"],
Cell[37606, 988, 1138, 30, 243, "Code",ExpressionUUID->"bc53afdf-e943-48c2-86c7-f6061351661a"],
Cell[38747, 1020, 837, 22, 205, "Code",ExpressionUUID->"85473fd6-6758-42ab-b08c-9603b15a8b4c"],
Cell[39587, 1044, 1259, 37, 129, "Code",ExpressionUUID->"e7ae596b-deb7-4f84-9610-9a11170e29df"],
Cell[40849, 1083, 276, 6, 52, "Code",ExpressionUUID->"ac162a9f-c8ea-4b77-b9dd-33728f284915"],
Cell[41128, 1091, 482, 12, 52, "Code",ExpressionUUID->"a7650f1d-49ea-409d-b201-4e28f33d8f17"],
Cell[41613, 1105, 1004, 30, 91, "Code",ExpressionUUID->"3c2acbf4-48c7-465c-8286-93552b4d3531"],
Cell[42620, 1137, 3621, 117, 224, "Code",ExpressionUUID->"1410a7ff-128b-4a76-b41a-a0f54f55ac65"]
}, Closed]],
Cell[CellGroupData[{
Cell[46278, 1259, 181, 3, 38, "Subsection",ExpressionUUID->"c6bb24a7-12f8-4cda-bce0-4aa336c33174"],
Cell[46462, 1264, 3948, 98, 376, "Code",ExpressionUUID->"5de50ab8-e5be-4535-9354-434de2836834"]
}, Closed]],
Cell[CellGroupData[{
Cell[50447, 1367, 229, 4, 38, "Subsection",ExpressionUUID->"306aaf72-c2ea-46d3-b394-84934dd4014f"],
Cell[50679, 1373, 8563, 210, 775, "Code",ExpressionUUID->"c03ad841-0c13-4803-9638-d5c9b3a75ca4"],
Cell[59245, 1585, 6690, 178, 965, "Code",ExpressionUUID->"924831b0-9d8f-411c-aba6-db1145813b58"],
Cell[65938, 1765, 55814, 1360, 5905, "Code",ExpressionUUID->"53efc507-6a18-4eaf-b317-b615cf672bde"]
}, Closed]],
Cell[CellGroupData[{
Cell[121789, 3130, 497, 7, 38, "Subsection",ExpressionUUID->"f2291a02-b823-4df6-a581-4fcde9b9eb4e"],
Cell[122289, 3139, 9335, 203, 699, "Code",ExpressionUUID->"5a08c030-5e82-443d-af9e-2ce257b388db"],
Cell[131627, 3344, 28498, 594, 1497, "Code",ExpressionUUID->"92ed1598-7cbd-49f8-9f2d-8d923833e10d"]
}, Closed]],
Cell[CellGroupData[{
Cell[160162, 3943, 487, 7, 38, "Subsection",ExpressionUUID->"4969b6f9-be82-4f3e-abc6-45d648828266"],
Cell[160652, 3952, 4454, 121, 186, "Code",ExpressionUUID->"eda9a3bd-b2dd-4fe8-9fcb-bd728e8a287d"],
Cell[165109, 4075, 12341, 336, 224, "Code",ExpressionUUID->"7c11673b-6e54-49ee-822b-64e19a8a50a6"]
}, Closed]],
Cell[CellGroupData[{
Cell[177487, 4416, 223, 4, 38, "Subsection",ExpressionUUID->"150df7a9-0598-4dbe-b33a-3a640381122d"],
Cell[177713, 4422, 3204, 90, 129, "Code",ExpressionUUID->"2877951a-c369-4327-8c85-f23d758101fd"]
}, Closed]],
Cell[CellGroupData[{
Cell[180954, 4517, 267, 4, 38, "Subsection",ExpressionUUID->"ef40d02e-f487-40e1-b6da-592e7b6c3f02"],
Cell[181224, 4523, 3379, 82, 243, "Code",ExpressionUUID->"cb69a25b-ca49-41e1-ac39-61c32a4d9fb6"],
Cell[184606, 4607, 88509, 1893, 2751, "Code",ExpressionUUID->"497c5c2c-74eb-4562-8f69-941dcd0056c7"],
Cell[273118, 6502, 56777, 1268, 2048, "Code",ExpressionUUID->"e22e94dc-e455-4145-b44a-607019fc3ef9"],
Cell[329898, 7772, 2661, 69, 148, "Code",ExpressionUUID->"eb8bd4c9-2671-484c-a8e2-20fe64beec38"]
}, Closed]],
Cell[CellGroupData[{
Cell[332596, 7846, 162, 3, 38, "Subsection",ExpressionUUID->"3b2c01eb-ca39-44b8-a326-339e7b6dca65"],
Cell[332761, 7851, 9767, 238, 718, "Code",ExpressionUUID->"96a02ee7-7b43-4dee-8fef-21d619612c51"],
Cell[342531, 8091, 51794, 1160, 2599, "Code",ExpressionUUID->"01a7a614-2116-49c7-8c69-d231c88986bf"],
Cell[394328, 9253, 48678, 1095, 2314, "Code",ExpressionUUID->"5023ea2b-257c-4bb8-b6a2-9d130a052cc0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[443043, 10353, 165, 3, 54, "Subsection",ExpressionUUID->"3fb109b0-2e0f-4e1e-a4da-311a2f2e096d"],
Cell[443211, 10358, 2570, 56, 218, "Code",ExpressionUUID->"7d702440-ce11-4f2f-a3fd-860210f78382"],
Cell[445784, 10416, 2881, 61, 167, "Code",ExpressionUUID->"6a85250f-5ba5-40dd-bedb-945dda498b2a"],
Cell[448668, 10479, 1566, 41, 110, "Code",ExpressionUUID->"dedb7461-041a-428c-ba62-81c1dfe604f2"]
}, Closed]],
Cell[CellGroupData[{
Cell[450271, 10525, 155, 3, 38, "Subsection",ExpressionUUID->"b61aad9d-e98e-437e-a004-cd413d8c988d"],
Cell[450429, 10530, 332, 10, 52, "Code",ExpressionUUID->"13ac9a81-9d77-4f4b-af91-eab343cd4c48"]
}, Closed]],
Cell[CellGroupData[{
Cell[450798, 10545, 212, 4, 38, "Subsection",ExpressionUUID->"dba93d7b-960f-45f3-b934-e70e75787766"],
Cell[451013, 10551, 2875, 77, 243, "Code",ExpressionUUID->"7537f657-25b6-48d1-a353-49b3b67ca0c0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[453925, 10633, 254, 4, 54, "Subsection",ExpressionUUID->"c7ab2675-b8fa-49b3-8be9-d76cf195c71b"],
Cell[454182, 10639, 4132, 103, 376, "Code",ExpressionUUID->"bf228923-5976-475f-a5dd-a7fe054bc1b4"]
}, Closed]],
Cell[CellGroupData[{
Cell[458351, 10747, 180, 3, 38, "Subsection",ExpressionUUID->"1b53d0ad-d029-4178-8006-e180da31053b"],
Cell[458534, 10752, 3586, 92, 357, "Code",ExpressionUUID->"c820acf3-75e6-4f7d-b4c0-c079d1b1a54b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[462157, 10849, 261, 4, 54, "Subsection",ExpressionUUID->"a9bc9d33-bdba-47c7-be28-d07298294e0f"],
Cell[462421, 10855, 1771, 40, 243, "Code",ExpressionUUID->"6bab5000-e2f8-427a-ba11-1204ddbefb7f"]
}, Closed]],
Cell[CellGroupData[{
Cell[464229, 10900, 307, 5, 38, "Subsection",ExpressionUUID->"12c8876a-c64d-4290-8878-8eb3e5701ba2"],
Cell[464539, 10907, 1443, 39, 91, "Code",ExpressionUUID->"72d8e435-9512-41f3-b3e3-fabb20494140"]
}, Closed]],
Cell[CellGroupData[{
Cell[466019, 10951, 163, 3, 38, "Subsection",ExpressionUUID->"dee804bd-b0af-49a8-b409-454c7f6d8710"],
Cell[466185, 10956, 5880, 154, 395, "Code",ExpressionUUID->"c9bab878-fbe8-4b7f-8c22-214c6b0dddbd"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[472114, 11116, 85, 0, 67, "Section",ExpressionUUID->"f1741b14-531a-4442-958b-fde3bfdb7b10"],
Cell[472202, 11118, 257, 7, 72, "Code",ExpressionUUID->"c8870d35-e01d-4f7c-b081-273dc39f3a98",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
}
]
*)

